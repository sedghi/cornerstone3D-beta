{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 0b2131d1c2cca19e2faf","webpack:///./externalModules.js","webpack:///./imageLoader/internal/index.js","webpack:///./shared/getMinMax.js","webpack:///./imageLoader/wadors/metaData/getValue.js","webpack:///./imageLoader/wadouri/parseImageId.js","webpack:///./imageLoader/wadors/metaDataManager.js","webpack:///./imageLoader/internal/options.js","webpack:///./imageLoader/createImage.js","webpack:///./imageLoader/wadouri/dataSetCacheManager.js","webpack:///./version.js","webpack:///./imageLoader/colorSpaceConverters/index.js","webpack:///./imageLoader/wadouri/index.js","webpack:///./imageLoader/wadouri/metaData/index.js","webpack:///./imageLoader/wadouri/metaData/getImagePixelModule.js","webpack:///./imageLoader/wadouri/metaData/getLUTs.js","webpack:///./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js","webpack:///./imageLoader/wadouri/metaData/getNumberValues.js","webpack:///./imageLoader/wadors/index.js","webpack:///./imageLoader/wadors/metaData/index.js","webpack:///./imageLoader/wadors/metaData/getNumberValue.js","webpack:///./imageLoader/wadors/metaData/getNumberValues.js","webpack:///./imageLoader/wadors/findIndexOfString.js","webpack:///./imageLoader/wadors/getPixelData.js","webpack:///./imageLoader/wadors/loadImage.js","webpack:///./imageLoader/getImageFrame.js","webpack:///./imageLoader/decodeImageFrame.js","webpack:///./imageLoader/webWorkerManager.js","webpack:///./imageLoader/decodeJPEGBaseline8BitColor.js","webpack:///./imageLoader/isColorImage.js","webpack:///./imageLoader/convertColorSpace.js","webpack:///./imageLoader/isJPEGBaseline8BitColor.js","webpack:///./imageLoader/wadouri/fileManager.js","webpack:///./imageLoader/wadouri/getEncapsulatedImageFrame.js","webpack:///./imageLoader/wadouri/getUncompressedImageFrame.js","webpack:///./imageLoader/wadouri/unpackBinaryFrame.js","webpack:///./imageLoader/wadouri/loadFileRequest.js","webpack:///./imageLoader/wadouri/loadImage.js","webpack:///./imageLoader/index.js","webpack:///./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js","webpack:///./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js","webpack:///./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js","webpack:///./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js","webpack:///./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js","webpack:///./imageLoader/wadouri/metaData/metaDataProvider.js","webpack:///external {\"commonjs\":\"jquery\",\"commonjs2\":\"jquery\",\"amd\":\"jquery\",\"root\":\"$\"}","webpack:///external {\"commonjs\":\"dicom-parser\",\"commonjs2\":\"dicom-parser\",\"amd\":\"dicom-parser\",\"root\":\"dicomParser\"}","webpack:///./imageLoader/registerLoaders.js","webpack:///./imageLoader/wadors/metaData/getNumberString.js","webpack:///./imageLoader/wadors/metaData/metaDataProvider.js","webpack:///./imageLoader/internal/xhrRequest.js","webpack:///./imageLoader/wadors/register.js","webpack:///./imageLoader/wadouri/getPixelData.js","webpack:///./imageLoader/wadouri/register.js","webpack:///./imageLoader/configure.js"],"names":["dicomParser","cornerstone","external","cs","$","internal","xhrRequest","setOptions","getOptions","getMinMax","storedPixelData","min","max","storedPixel","numPixels","length","index","Math","getValue","element","defaultValue","Value","parseImageId","imageId","firstColonIndex","indexOf","url","substring","frameIndex","frame","frameStr","substr","parseInt","scheme","imageIds","add","metadata","get","remove","undefined","purge","options","beforeSend","imageCreated","strict","newOptions","lastImageIdDrawn","isModalityLUTForDisplay","sopClassUid","setPixelDataType","imageFrame","bitsAllocated","pixelRepresentation","pixelData","Uint16Array","Int16Array","Uint8Array","createImage","transferSyntax","canvas","document","createElement","decodePromise","Promise","resolve","reject","then","imagePlaneModule","metaData","voiLutModule","modalityLutModule","sopCommonModule","isColorImage","photometricInterpretation","height","rows","width","columns","context","getContext","imageData","createImageData","data","minMax","smallestPixelValue","largestPixelValue","image","color","columnPixelSpacing","pixelSpacing","intercept","rescaleIntercept","invert","minPixelValue","maxPixelValue","render","rowPixelSpacing","sizeInBytes","slope","rescaleSlope","windowCenter","windowWidth","decodeTimeInMS","getPixelData","renderColorImage","getCanvas","putImageData","renderGrayscaleImage","modalityLUTSequence","sopClassUID","modalityLUT","voiLUTSequence","voiLUT","maxVoi","minVoi","loadedDataSets","promises","isLoaded","uri","dataSet","load","loadRequest","cacheCount","loadDICOMPromise","promise","dicomPart10AsArrayBuffer","byteArray","parseDicom","error","unload","default","getImagePixelModule","getLUTs","getModalityLUTOutputPixelRepresentation","getNumberValues","metaDataProvider","dataSetCacheManager","fileManager","getEncapsulatedImageFrame","getUncompressedImageFrame","loadFileRequest","loadImageFromPromise","getLoaderForScheme","loadImage","unpackBinaryFrame","register","getLutDescriptor","tag","elements","uint16","getLutData","lutDataSet","lutDescriptor","lut","lutData","numLutEntries","i","dataOffset","populatePaletteColorLut","imagePixelModule","x00281101","redPaletteColorLookupTableDescriptor","greenPaletteColorLookupTableDescriptor","bluePaletteColorLookupTableDescriptor","redPaletteColorLookupTableData","greenPaletteColorLookupTableData","bluePaletteColorLookupTableData","populateSmallestLargestPixelValues","int16","samplesPerPixel","string","bitsStored","highBit","planarConfiguration","pixelAspectRatio","getLUT","numLUTEntries","firstValueMapped","numBitsPerEntry","id","lutSequence","items","luts","push","getMinStoredPixelValue","floatString","minStoredPixelValue","minModalityLutValue","x00283000","minimumLength","values","valueAsString","split","parseFloat","getNumberString","getNumberValue","findIndexOfString","metaDataManager","value","checkToken","token","endIndex","stringToUint8Array","str","uint","j","charCodeAt","offset","findBoundary","header","findContentType","trim","uint8ArrayToString","String","fromCharCode","mediaType","headers","accept","loadPromise","imageFrameAsArrayBuffer","response","tokenIndex","Error","boundary","contentType","getTransferSyntaxForContentType","start","Date","getTime","deferred","Deferred","result","imagePromise","end","loadTimeInMS","reason","getImageFrame","addDecodeTask","priority","transferList","transferPixelData","buffer","addTask","decodeImageFrame","nextTaskId","tasks","webWorkers","defaultConfig","maxWebWorkers","navigator","hardwareConcurrency","startWebWorkersOnDemand","webWorkerPath","webWorkerTaskPaths","taskConfiguration","decodeTask","loadCodecsOnStartup","initializeCodecsOnStartup","codecsPath","usePDFJS","config","statistics","numWebWorkers","numTasksQueued","numTasksExecuting","numTasksCompleted","totalTaskTimeInMS","totalTimeDelayedInMS","startTaskOnWebWorker","status","task","shift","added","worker","postMessage","taskType","workerIndex","spawnWebWorker","handleMessageFromWorker","msg","Worker","addEventListener","initialize","configObject","loadWebWorkerTask","sourcePath","taskConfig","Object","assign","taskId","splice","setTaskPriority","cancelTask","getStatistics","arrayBufferToString","binaryToString","apply","Array","prototype","slice","binary","decodeURIComponent","escape","_error","URIError","decodeJPEGBaseline8BitColor","imgBlob","Blob","type","fileReader","FileReader","readAsBinaryString","readAsArrayBuffer","onload","img","Image","drawImage","getImageData","onerror","src","window","btoa","e","photoMetricInterpretation","convertColorSpace","convertRGB","rgbaBuffer","convertYBRFull","isJPEGBaseline8BitColor","files","file","fileIndex","framesAreFragmented","numberOfFrames","intString","pixelDataElement","x7fe00010","fragments","basicOffsetTable","readEncapsulatedImageFrame","createJPEGBasicOffsetTable","readEncapsulatedPixelDataFromFragments","pixelDataOffset","pixelsPerFrame","frameOffset","isBitSet","byte","bitPos","bytePos","floor","parsedImageId","target","addDecache","decache","dataSetPromise","sharedCacheKey","loadEnd","totalTimeInMS","loadImageFromDataSet","loader","rgbIndex","rgbaIndex","rIndex","gIndex","bIndex","ybrIndex","y","cb","cr","yIndex","cbIndex","crIndex","palIndex","rData","gData","bData","len","modality","seriesInstanceUID","seriesNumber","studyInstanceUID","seriesDate","parseDA","seriesTime","parseTM","patientAge","patientSize","patientWeight","imageOrientationPatient","imagePositionPatient","sliceThickness","sliceLocation","frameOfReferenceUID","rescaleType","modalityLUTOutputPixelRepresentation","x00283010","sopInstanceUID","radiopharmaceuticalInfo","x00540016","firstRadiopharmaceuticalInfoDataSet","radiopharmaceuticalStartTime","radionuclideTotalDose","radionuclideHalfLife","registerLoaders","params","xhr","XMLHttpRequest","open","responseType","keys","forEach","key","setRequestHeader","onloadstart","event","eventData","events","trigger","customEvent","CustomEvent","detail","dispatchEvent","onloadend","onreadystatechange","readyState","onprogress","oProgress","loaded","total","percentComplete","lengthComputable","round","send","registerImageLoader","addProvider","encapsulatedPixelData","configure"],"mappings":"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","file":"cornerstoneWADOImageLoader.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"), require(\"dicom-parser\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstoneWADOImageLoader\", [\"jquery\", \"dicom-parser\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstoneWADOImageLoader\"] = factory(require(\"jquery\"), require(\"dicom-parser\"));\n\telse\n\t\troot[\"cornerstoneWADOImageLoader\"] = factory(root[\"$\"], root[\"dicomParser\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_46__, __WEBPACK_EXTERNAL_MODULE_47__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 39);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0b2131d1c2cca19e2faf","import $ from 'jquery';\nimport * as dicomParser from 'dicom-parser';\nimport registerLoaders from './imageLoader/registerLoaders.js';\n\nlet cornerstone;\n\nconst external = {\n  set cornerstone (cs) {\n    cornerstone = cs;\n\n    registerLoaders(cornerstone);\n  },\n  get cornerstone () {\n    return cornerstone;\n  }\n};\n\nexport { $, dicomParser, external };\n\n\n\n// WEBPACK FOOTER //\n// ./externalModules.js","import { default as xhrRequest } from './xhrRequest.js';\nimport { setOptions, getOptions } from './options.js';\n\nconst internal = {\n  xhrRequest,\n  setOptions,\n  getOptions\n};\n\nexport { setOptions, getOptions, xhrRequest, internal };\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/index.js","function getMinMax (storedPixelData) {\n  // we always calculate the min max values since they are not always\n  // present in DICOM and we don't want to trust them anyway as cornerstone\n  // depends on us providing reliable values for these\n  let min = storedPixelData[0];\n  let max = storedPixelData[0];\n  let storedPixel;\n  const numPixels = storedPixelData.length;\n\n  for (let index = 1; index < numPixels; index++) {\n    storedPixel = storedPixelData[index];\n    min = Math.min(min, storedPixel);\n    max = Math.max(max, storedPixel);\n  }\n\n  return {\n    min,\n    max\n  };\n}\n\nexport default getMinMax;\n\n\n\n// WEBPACK FOOTER //\n// ./shared/getMinMax.js","\n\n/**\n * Returns the raw value\n *\n * @param element - The javascript object for the specified element in the metadata\n * @param [index] - the index of the value in a multi-valued element, default is 0\n * @param [defaultValue] - The default value to return if the element does not exist\n * @returns {*}\n */\nfunction getValue (element, index, defaultValue) {\n  index = index || 0;\n  if (!element) {\n    return defaultValue;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return defaultValue;\n  }\n  // make sure we have the specified index\n  if (element.Value.length <= index) {\n    return defaultValue;\n  }\n\n  return element.Value[index];\n}\n\nexport default getValue;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getValue.js","function parseImageId (imageId) {\n  // build a url by parsing out the url scheme and frame index from the imageId\n  const firstColonIndex = imageId.indexOf(':');\n  let url = imageId.substring(firstColonIndex + 1);\n  const frameIndex = url.indexOf('frame=');\n  let frame;\n\n  if (frameIndex !== -1) {\n    const frameStr = url.substr(frameIndex + 6);\n\n    frame = parseInt(frameStr, 10);\n    url = url.substr(0, frameIndex - 1);\n  }\n\n  return {\n    scheme: imageId.substr(0, firstColonIndex),\n    url,\n    frame\n  };\n}\n\nexport default parseImageId;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/parseImageId.js","\n\nlet imageIds = [];\n\nfunction add (imageId, metadata) {\n  imageIds[imageId] = metadata;\n}\n\nfunction get (imageId) {\n  return imageIds[imageId];\n}\n\nfunction remove (imageId) {\n  imageIds[imageId] = undefined;\n}\n\nfunction purge () {\n  imageIds = [];\n}\n\nexport default {\n  add,\n  get,\n  remove,\n  purge\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaDataManager.js","let options = {\n  // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\n  beforeSend (/* xhr */) {\n  },\n  // callback allowing modification of newly created image objects\n  imageCreated (/* image */) {\n  },\n  strict: false\n};\n\nexport function setOptions (newOptions) {\n  options = newOptions;\n}\n\nexport function getOptions () {\n  return options;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/options.js","import { external } from '../externalModules.js';\nimport getImageFrame from './getImageFrame.js';\nimport decodeImageFrame from './decodeImageFrame.js';\nimport isColorImageFn from './isColorImage.js';\nimport convertColorSpace from './convertColorSpace.js';\nimport getMinMax from '../shared/getMinMax.js';\nimport isJPEGBaseline8BitColor from './isJPEGBaseline8BitColor.js';\n\nlet lastImageIdDrawn = '';\n\nfunction isModalityLUTForDisplay (sopClassUid) {\n  // special case for XA and XRF\n  // https://groups.google.com/forum/#!searchin/comp.protocols.dicom/Modality$20LUT$20XA/comp.protocols.dicom/UBxhOZ2anJ0/D0R_QP8V2wIJ\n  return sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.1' && // XA\n         sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.2.1'; // XRF\n}\n\n/**\n * Helper function to set pixel data to the right typed array.  This is needed because web workers\n * can transfer array buffers but not typed arrays\n * @param imageFrame\n */\nfunction setPixelDataType (imageFrame) {\n  if (imageFrame.bitsAllocated === 16) {\n    if (imageFrame.pixelRepresentation === 0) {\n      imageFrame.pixelData = new Uint16Array(imageFrame.pixelData);\n    } else {\n      imageFrame.pixelData = new Int16Array(imageFrame.pixelData);\n    }\n  } else {\n    imageFrame.pixelData = new Uint8Array(imageFrame.pixelData);\n  }\n}\n\nfunction createImage (imageId, pixelData, transferSyntax, options) {\n  const cornerstone = external.cornerstone;\n  const canvas = document.createElement('canvas');\n  const imageFrame = getImageFrame(imageId);\n  const decodePromise = decodeImageFrame(imageFrame, transferSyntax, pixelData, canvas, options);\n\n  return new Promise((resolve, reject) => {\n    decodePromise.then(function (imageFrame) {\n      const imagePlaneModule = cornerstone.metaData.get('imagePlaneModule', imageId) || {};\n      const voiLutModule = cornerstone.metaData.get('voiLutModule', imageId) || {};\n      const modalityLutModule = cornerstone.metaData.get('modalityLutModule', imageId) || {};\n      const sopCommonModule = cornerstone.metaData.get('sopCommonModule', imageId) || {};\n      const isColorImage = isColorImageFn(imageFrame.photometricInterpretation);\n\n      // JPEGBaseline (8 bits) is already returning the pixel data in the right format (rgba)\n      // because it's using a canvas to load and decode images.\n      if (!isJPEGBaseline8BitColor(imageFrame, transferSyntax)) {\n        setPixelDataType(imageFrame);\n\n        // convert color space\n        if (isColorImage) {\n          // setup the canvas context\n          canvas.height = imageFrame.rows;\n          canvas.width = imageFrame.columns;\n\n          const context = canvas.getContext('2d');\n          const imageData = context.createImageData(imageFrame.columns, imageFrame.rows);\n\n          convertColorSpace(imageFrame, imageData);\n          imageFrame.imageData = imageData;\n          imageFrame.pixelData = imageData.data;\n\n          // calculate smallest and largest PixelValue of the converted pixelData\n          const minMax = getMinMax(imageFrame.pixelData);\n\n          imageFrame.smallestPixelValue = minMax.min;\n          imageFrame.largestPixelValue = minMax.max;\n        }\n      }\n\n      const image = {\n        imageId,\n        color: isColorImage,\n        columnPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[1] : undefined,\n        columns: imageFrame.columns,\n        height: imageFrame.rows,\n        intercept: modalityLutModule.rescaleIntercept ? modalityLutModule.rescaleIntercept : 0,\n        invert: imageFrame.photometricInterpretation === 'MONOCHROME1',\n        minPixelValue: imageFrame.smallestPixelValue,\n        maxPixelValue: imageFrame.largestPixelValue,\n        render: undefined, // set below\n        rowPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[0] : undefined,\n        rows: imageFrame.rows,\n        sizeInBytes: imageFrame.pixelData.length,\n        slope: modalityLutModule.rescaleSlope ? modalityLutModule.rescaleSlope : 1,\n        width: imageFrame.columns,\n        windowCenter: voiLutModule.windowCenter ? voiLutModule.windowCenter[0] : undefined,\n        windowWidth: voiLutModule.windowWidth ? voiLutModule.windowWidth[0] : undefined,\n        decodeTimeInMS: imageFrame.decodeTimeInMS\n      };\n\n      // add function to return pixel data\n      image.getPixelData = () => imageFrame.pixelData;\n\n      // Setup the renderer\n      if (image.color) {\n        image.render = cornerstone.renderColorImage;\n        image.getCanvas = function () {\n          if (lastImageIdDrawn === imageId) {\n            return canvas;\n          }\n\n          canvas.height = image.rows;\n          canvas.width = image.columns;\n          const context = canvas.getContext('2d');\n\n          context.putImageData(imageFrame.imageData, 0, 0);\n          lastImageIdDrawn = imageId;\n\n          return canvas;\n        };\n\n      } else {\n        image.render = cornerstone.renderGrayscaleImage;\n      }\n\n      // Modality LUT\n      if (modalityLutModule.modalityLUTSequence &&\n        modalityLutModule.modalityLUTSequence.length > 0 &&\n        isModalityLUTForDisplay(sopCommonModule.sopClassUID)) {\n        image.modalityLUT = modalityLutModule.modalityLUTSequence[0];\n      }\n\n      // VOI LUT\n      if (voiLutModule.voiLUTSequence &&\n        voiLutModule.voiLUTSequence.length > 0) {\n        image.voiLUT = voiLutModule.voiLUTSequence[0];\n      }\n\n      // set the ww/wc to cover the dynamic range of the image if no values are supplied\n      if (image.windowCenter === undefined || image.windowWidth === undefined) {\n        if (image.color) {\n          image.windowWidth = 255;\n          image.windowCenter = 128;\n        } else {\n          const maxVoi = image.maxPixelValue * image.slope + image.intercept;\n          const minVoi = image.minPixelValue * image.slope + image.intercept;\n\n          image.windowWidth = maxVoi - minVoi;\n          image.windowCenter = (maxVoi + minVoi) / 2;\n        }\n      }\n      resolve(image);\n    }, reject);\n  });\n}\n\nexport default createImage;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/createImage.js","import { dicomParser } from '../../externalModules.js';\nimport { xhrRequest } from '../internal/index.js';\n\n/**\n * This object supports loading of DICOM P10 dataset from a uri and caching it so it can be accessed\n * by the caller.  This allows a caller to access the datasets without having to go through cornerstone's\n * image loader mechanism.  One reason a caller may need to do this is to determine the number of frames\n * in a multiframe sop instance so it can create the imageId's correctly.\n */\nlet loadedDataSets = {};\nlet promises = {};\n\n// returns true if the wadouri for the specified index has been loaded\nfunction isLoaded (uri) {\n  return loadedDataSets[uri] !== undefined;\n}\n\nfunction get (uri) {\n  if (!loadedDataSets[uri]) {\n    return;\n  }\n\n  return loadedDataSets[uri].dataSet;\n}\n\n\n// loads the dicom dataset from the wadouri sp\nfunction load (uri, loadRequest = xhrRequest, imageId) {\n  // if already loaded return it right away\n  if (loadedDataSets[uri]) {\n    // console.log('using loaded dataset ' + uri);\n    return new Promise((resolve) => {\n      loadedDataSets[uri].cacheCount++;\n      resolve(loadedDataSets[uri].dataSet);\n    });\n  }\n\n  // if we are currently loading this uri, return its promise\n  if (promises[uri]) {\n    // console.log('returning existing load promise for ' + uri);\n    return promises[uri];\n  }\n\n  // This uri is not loaded or being loaded, load it via an xhrRequest\n  const loadDICOMPromise = loadRequest(uri, imageId);\n\n  // handle success and failure of the XHR request load\n  const promise = new Promise((resolve, reject) => {\n    loadDICOMPromise.then(function (dicomPart10AsArrayBuffer/* , xhr*/) {\n      const byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\n\n      // Reject the promise if parsing the dicom file fails\n      let dataSet;\n\n      try {\n        dataSet = dicomParser.parseDicom(byteArray);\n      } catch (error) {\n        return reject(error);\n      }\n\n      loadedDataSets[uri] = {\n        dataSet,\n        cacheCount: 1\n      };\n\n      resolve(dataSet);\n    }, reject).then(() => {\n      // Remove the promise regardless of success or failure\n      delete promises[uri];\n    });\n  });\n\n  promises[uri] = promise;\n\n  return promise;\n}\n\n// remove the cached/loaded dicom dataset for the specified wadouri to free up memory\nfunction unload (uri) {\n  // console.log('unload for ' + uri);\n  if (loadedDataSets[uri]) {\n    loadedDataSets[uri].cacheCount--;\n    if (loadedDataSets[uri].cacheCount === 0) {\n      // console.log('removing loaded dataset for ' + uri);\n      delete loadedDataSets[uri];\n    }\n  }\n}\n\n// removes all cached datasets from memory\nfunction purge () {\n  loadedDataSets = {};\n  promises = {};\n}\n\nexport default {\n  isLoaded,\n  load,\n  unload,\n  purge,\n  get\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/dataSetCacheManager.js","export default '1.0.1';\n\n\n\n// WEBPACK FOOTER //\n// ./version.js","export { default as convertRGBColorByPixel } from './convertRGBColorByPixel.js';\nexport { default as convertRGBColorByPlane } from './convertRGBColorByPlane.js';\nexport { default as convertYBRFullByPixel } from './convertYBRFullByPixel.js';\nexport { default as convertYBRFullByPlane } from './convertYBRFullByPlane.js';\nexport { default as convertPALETTECOLOR } from './convertPALETTECOLOR.js';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/index.js","import { getImagePixelModule,\n  getLUTs,\n  getModalityLUTOutputPixelRepresentation,\n  getNumberValues,\n  metaDataProvider } from './metaData/index.js';\n\nimport dataSetCacheManager from './dataSetCacheManager.js';\nimport fileManager from './fileManager.js';\nimport getEncapsulatedImageFrame from './getEncapsulatedImageFrame.js';\nimport getUncompressedImageFrame from './getUncompressedImageFrame.js';\nimport loadFileRequest from './loadFileRequest.js';\nimport { loadImageFromPromise,\n  getLoaderForScheme,\n  loadImage } from './loadImage.js';\nimport parseImageId from './parseImageId.js';\nimport unpackBinaryFrame from './unpackBinaryFrame.js';\nimport register from './register.js';\n\nconst metaData = {\n  getImagePixelModule,\n  getLUTs,\n  getModalityLUTOutputPixelRepresentation,\n  getNumberValues,\n  metaDataProvider\n};\n\nexport default {\n  metaData,\n  dataSetCacheManager,\n  fileManager,\n  getEncapsulatedImageFrame,\n  getUncompressedImageFrame,\n  loadFileRequest,\n  loadImageFromPromise,\n  getLoaderForScheme,\n  loadImage,\n  parseImageId,\n  unpackBinaryFrame,\n  register\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/index.js","export { default as getImagePixelModule } from './getImagePixelModule.js';\nexport { default as getLUTs } from './getLUTs.js';\nexport { default as getModalityLUTOutputPixelRepresentation } from './getModalityLUTOutputPixelRepresentation.js';\nexport { default as getNumberValues } from './getNumberValues.js';\nexport { default as metaDataProvider } from './metaDataProvider.js';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/index.js","function getLutDescriptor (dataSet, tag) {\n  if (!dataSet.elements[tag] || dataSet.elements[tag].length !== 6) {\n    return;\n  }\n\n  return [dataSet.uint16(tag, 0), dataSet.uint16(tag, 1), dataSet.uint16(tag, 2)];\n}\n\nfunction getLutData (lutDataSet, tag, lutDescriptor) {\n  const lut = [];\n  const lutData = lutDataSet.elements[tag];\n\n  // The first Palette Color Lookup Table Descriptor value is the number of entries in the lookup table.\n  // When the number of table entries is equal to 2ˆ16 then this value shall be 0.\n  // See http://dicom.nema.org/MEDICAL/DICOM/current/output/chtml/part03/sect_C.7.6.3.html#sect_C.7.6.3.1.5\n  const numLutEntries = lutDescriptor[0] || 65536;\n\n  for (let i = 0; i < numLutEntries; i++) {\n    // Output range is always unsigned\n    if (lutDescriptor[2] === 16) {\n      lut[i] = lutDataSet.uint16(tag, i);\n    } else {\n      lut[i] = lutDataSet.byteArray[i + lutData.dataOffset];\n    }\n  }\n\n  return lut;\n}\n\nfunction populatePaletteColorLut (dataSet, imagePixelModule) {\n  // return immediately if photometric interpretation is not PALETTE COLOR or no palette lut elements\n  if (imagePixelModule.photometricInterpretation !== 'PALETTE COLOR' || !dataSet.elements.x00281101) {\n    return;\n  }\n  imagePixelModule.redPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281101');\n  imagePixelModule.greenPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281102');\n  imagePixelModule.bluePaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281103');\n\n  imagePixelModule.redPaletteColorLookupTableData = getLutData(dataSet, 'x00281201', imagePixelModule.redPaletteColorLookupTableDescriptor);\n  imagePixelModule.greenPaletteColorLookupTableData = getLutData(dataSet, 'x00281202', imagePixelModule.greenPaletteColorLookupTableDescriptor);\n  imagePixelModule.bluePaletteColorLookupTableData = getLutData(dataSet, 'x00281203', imagePixelModule.bluePaletteColorLookupTableDescriptor);\n}\n\nfunction populateSmallestLargestPixelValues (dataSet, imagePixelModule) {\n  const pixelRepresentation = dataSet.uint16('x00280103');\n\n  if (pixelRepresentation === 0) {\n    imagePixelModule.smallestPixelValue = dataSet.uint16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.uint16('x00280107');\n  } else {\n    imagePixelModule.smallestPixelValue = dataSet.int16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.int16('x00280107');\n  }\n}\n\nfunction getImagePixelModule (dataSet) {\n  const imagePixelModule = {\n    samplesPerPixel: dataSet.uint16('x00280002'),\n    photometricInterpretation: dataSet.string('x00280004'),\n    rows: dataSet.uint16('x00280010'),\n    columns: dataSet.uint16('x00280011'),\n    bitsAllocated: dataSet.uint16('x00280100'),\n    bitsStored: dataSet.uint16('x00280101'),\n    highBit: dataSet.uint16('x00280102'),\n    pixelRepresentation: dataSet.uint16('x00280103'),\n    planarConfiguration: dataSet.uint16('x00280006'),\n    pixelAspectRatio: dataSet.string('x00280034')\n  };\n\n  populateSmallestLargestPixelValues(dataSet, imagePixelModule);\n  populatePaletteColorLut(dataSet, imagePixelModule);\n\n  return imagePixelModule;\n}\n\nexport default getImagePixelModule;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getImagePixelModule.js","function getLUT (pixelRepresentation, lutDataSet) {\n  let numLUTEntries = lutDataSet.uint16('x00283002', 0);\n\n  if (numLUTEntries === 0) {\n    numLUTEntries = 65535;\n  }\n  let firstValueMapped = 0;\n\n  if (pixelRepresentation === 0) {\n    firstValueMapped = lutDataSet.uint16('x00283002', 1);\n  } else {\n    firstValueMapped = lutDataSet.int16('x00283002', 1);\n  }\n  const numBitsPerEntry = lutDataSet.uint16('x00283002', 2);\n  // console.log('LUT(', numLUTEntries, ',', firstValueMapped, ',', numBitsPerEntry, ')');\n  const lut = {\n    id: '1',\n    firstValueMapped,\n    numBitsPerEntry,\n    lut: []\n  };\n\n  // console.log(\"minValue=\", minValue, \"; maxValue=\", maxValue);\n  for (let i = 0; i < numLUTEntries; i++) {\n    if (pixelRepresentation === 0) {\n      lut.lut[i] = lutDataSet.uint16('x00283006', i);\n    } else {\n      lut.lut[i] = lutDataSet.int16('x00283006', i);\n    }\n  }\n\n  return lut;\n}\n\n\nfunction getLUTs (pixelRepresentation, lutSequence) {\n  if (!lutSequence || !lutSequence.items.length) {\n    return;\n  }\n  const luts = [];\n\n  for (let i = 0; i < lutSequence.items.length; i++) {\n    const lutDataSet = lutSequence.items[i].dataSet;\n    const lut = getLUT(pixelRepresentation, lutDataSet);\n\n    if (lut) {\n      luts.push(lut);\n    }\n  }\n\n  return luts;\n}\n\nexport default getLUTs;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getLUTs.js","/* eslint no-bitwise: 0 */\n\nfunction getMinStoredPixelValue (dataSet) {\n  const pixelRepresentation = dataSet.uint16('x00280103');\n  const bitsStored = dataSet.uint16('x00280101');\n\n  if (pixelRepresentation === 0) {\n    return 0;\n  }\n\n  return -1 << (bitsStored - 1);\n}\n\n// 0 = unsigned / US, 1 = signed / SS\nfunction getModalityLUTOutputPixelRepresentation (dataSet) {\n\n  // CT SOP Classes are always signed\n  const sopClassUID = dataSet.string('x00080016');\n\n  if (sopClassUID === '1.2.840.10008.5.1.4.1.1.2' ||\n    sopClassUID === '1.2.840.10008.5.1.4.1.1.2.1') {\n    return 1;\n  }\n\n  // if rescale intercept and rescale slope are present, pass the minimum stored\n  // pixel value through them to see if we get a signed output range\n  const rescaleIntercept = dataSet.floatString('x00281052');\n  const rescaleSlope = dataSet.floatString('x00281053');\n\n  if (rescaleIntercept !== undefined && rescaleSlope !== undefined) {\n    const minStoredPixelValue = getMinStoredPixelValue(dataSet); //\n    const minModalityLutValue = minStoredPixelValue * rescaleSlope + rescaleIntercept;\n\n    if (minModalityLutValue < 0) {\n      return 1;\n    }\n\n    return 0;\n\n  }\n\n  // Output of non linear modality lut is always unsigned\n  if (dataSet.elements.x00283000 && dataSet.elements.x00283000.length > 0) {\n    return 0;\n  }\n\n  // If no modality lut transform, output is same as pixel representation\n  return dataSet.uint16('x00280103');\n}\n\nexport default getModalityLUTOutputPixelRepresentation;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js","function getNumberValues (dataSet, tag, minimumLength) {\n  const values = [];\n  const valueAsString = dataSet.string(tag);\n\n  if (!valueAsString) {\n    return;\n  }\n  const split = valueAsString.split('\\\\');\n\n  if (minimumLength && split.length < minimumLength) {\n    return;\n  }\n  for (let i = 0; i < split.length; i++) {\n    values.push(parseFloat(split[i]));\n  }\n\n  return values;\n}\n\nexport default getNumberValues;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getNumberValues.js","import { getNumberString,\n  getNumberValue,\n  getNumberValues,\n  getValue,\n  metaDataProvider } from './metaData/index.js';\n\nimport findIndexOfString from './findIndexOfString.js';\nimport getPixelData from './getPixelData.js';\nimport metaDataManager from './metaDataManager.js';\nimport loadImage from './loadImage.js';\nimport register from './register.js';\n\nconst metaData = {\n  getNumberString,\n  getNumberValue,\n  getNumberValues,\n  getValue,\n  metaDataProvider\n};\n\nexport default {\n  metaData,\n  findIndexOfString,\n  getPixelData,\n  loadImage,\n  metaDataManager,\n  register\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/index.js","export { default as getNumberString } from './getNumberString.js';\nexport { default as getNumberValue } from './getNumberValue.js';\nexport { default as getNumberValues } from './getNumberValues.js';\nexport { default as getValue } from './getValue.js';\nexport { default as metaDataProvider } from './metaDataProvider.js';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/index.js","import getValue from './getValue.js';\n\nfunction getNumberValue (element, index) {\n  const value = getValue(element, index);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\n\nexport default getNumberValue;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberValue.js","\n\n/**\n * Returns the values as an array of javascript numbers\n *\n * @param element - The javascript object for the specified element in the metadata\n * @param [minimumLength] - the minimum number of values\n * @returns {*}\n */\nfunction getNumberValues (element, minimumLength) {\n  if (!element) {\n    return;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return;\n  }\n  // make sure we have the expected length\n  if (minimumLength && element.Value.length < minimumLength) {\n    return;\n  }\n\n  const values = [];\n\n  for (let i = 0; i < element.Value.length; i++) {\n    values.push(parseFloat(element.Value[i]));\n  }\n\n  return values;\n}\n\nexport default getNumberValues;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberValues.js","function checkToken (token, data, dataOffset) {\n\n  if (dataOffset + token.length > data.length) {\n    return false;\n  }\n\n  let endIndex = dataOffset;\n\n  for (let i = 0; i < token.length; i++) {\n    if (token[i] !== data[endIndex++]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction stringToUint8Array (str) {\n  const uint = new Uint8Array(str.length);\n\n  for (let i = 0, j = str.length; i < j; i++) {\n    uint[i] = str.charCodeAt(i);\n  }\n\n  return uint;\n}\n\nfunction findIndexOfString (data, str, offset) {\n\n  offset = offset || 0;\n\n  const token = stringToUint8Array(str);\n\n  for (let i = offset; i < data.length; i++) {\n    if (token[0] === data[i]) {\n      // console.log('match @', i);\n      if (checkToken(token, data, i)) {\n        return i;\n      }\n    }\n  }\n\n  return -1;\n}\nexport default findIndexOfString;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/findIndexOfString.js","import { xhrRequest } from '../internal/index.js';\nimport findIndexOfString from './findIndexOfString.js';\n\nfunction findBoundary (header) {\n  for (let i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 2) === '--') {\n      return header[i];\n    }\n  }\n}\n\nfunction findContentType (header) {\n  for (let i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 13) === 'Content-Type:') {\n      return header[i].substr(13).trim();\n    }\n  }\n}\n\nfunction uint8ArrayToString (data, offset, length) {\n  offset = offset || 0;\n  length = length || data.length - offset;\n  let str = '';\n\n  for (let i = offset; i < offset + length; i++) {\n    str += String.fromCharCode(data[i]);\n  }\n\n  return str;\n}\n\nfunction getPixelData (uri, imageId, mediaType = 'application/octet-stream') {\n  const headers = {\n    accept: mediaType\n  };\n\n  return new Promise((resolve, reject) => {\n    const loadPromise = xhrRequest(uri, imageId, headers);\n\n    loadPromise.then(function (imageFrameAsArrayBuffer/* , xhr*/) {\n\n      // request succeeded, Parse the multi-part mime response\n      const response = new Uint8Array(imageFrameAsArrayBuffer);\n\n      // First look for the multipart mime header\n      const tokenIndex = findIndexOfString(response, '\\r\\n\\r\\n');\n\n      if (tokenIndex === -1) {\n        reject(new Error('invalid response - no multipart mime header'));\n      }\n      const header = uint8ArrayToString(response, 0, tokenIndex);\n      // Now find the boundary  marker\n      const split = header.split('\\r\\n');\n      const boundary = findBoundary(split);\n\n      if (!boundary) {\n        reject(new Error('invalid response - no boundary marker'));\n      }\n      const offset = tokenIndex + 4; // skip over the \\r\\n\\r\\n\n\n      // find the terminal boundary marker\n      const endIndex = findIndexOfString(response, boundary, offset);\n\n      if (endIndex === -1) {\n        reject(new Error('invalid response - terminating boundary not found'));\n      }\n\n      // Remove \\r\\n from the length\n      const length = endIndex - offset - 2;\n\n      // return the info for this pixel data\n      resolve({\n        contentType: findContentType(split),\n        imageFrame: {\n          pixelData: new Uint8Array(imageFrameAsArrayBuffer, offset, length)\n        }\n      });\n    });\n  });\n}\n\nexport default getPixelData;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/getPixelData.js","import { $ } from '../../externalModules.js';\nimport metaDataManager from './metaDataManager.js';\nimport getPixelData from './getPixelData.js';\nimport createImage from '../createImage.js';\n\nfunction getTransferSyntaxForContentType (/* contentType */) {\n  return '1.2.840.10008.1.2'; // hard code to ILE for now\n}\n\nfunction loadImage (imageId, options) {\n  const start = new Date().getTime();\n  const uri = imageId.substring(7);\n\n  const deferred = $.Deferred();\n\n  // check to make sure we have metadata for this imageId\n  const metaData = metaDataManager.get(imageId);\n\n  if (metaData === undefined) {\n    deferred.reject(`no metadata for imageId ${imageId}`);\n\n    return deferred.promise();\n  }\n\n  // TODO: load bulk data items that we might need\n  const mediaType = 'multipart/related; type=\"application/octet-stream\"'; // 'image/dicom+jp2';\n\n  // get the pixel data from the server\n  getPixelData(uri, imageId, mediaType).then(function (result) {\n\n    const transferSyntax = getTransferSyntaxForContentType(result.contentType);\n    const pixelData = result.imageFrame.pixelData;\n    const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      // add the loadTimeInMS property\n      const end = new Date().getTime();\n\n      image.loadTimeInMS = end - start;\n      deferred.resolve(image);\n    }, function (reason) {\n      deferred.reject(reason);\n    });\n  }, function (reason) {\n    deferred.reject(reason);\n  });\n\n  return deferred;\n}\n\nexport default loadImage;\n\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/loadImage.js","import { external } from '../externalModules.js';\n\nfunction getImageFrame (imageId) {\n  const imagePixelModule = external.cornerstone.metaData.get('imagePixelModule', imageId);\n\n  return {\n    samplesPerPixel: imagePixelModule.samplesPerPixel,\n    photometricInterpretation: imagePixelModule.photometricInterpretation,\n    planarConfiguration: imagePixelModule.planarConfiguration,\n    rows: imagePixelModule.rows,\n    columns: imagePixelModule.columns,\n    bitsAllocated: imagePixelModule.bitsAllocated,\n    pixelRepresentation: imagePixelModule.pixelRepresentation, // 0 = unsigned,\n    smallestPixelValue: imagePixelModule.smallestPixelValue,\n    largestPixelValue: imagePixelModule.largestPixelValue,\n    redPaletteColorLookupTableDescriptor: imagePixelModule.redPaletteColorLookupTableDescriptor,\n    greenPaletteColorLookupTableDescriptor: imagePixelModule.greenPaletteColorLookupTableDescriptor,\n    bluePaletteColorLookupTableDescriptor: imagePixelModule.bluePaletteColorLookupTableDescriptor,\n    redPaletteColorLookupTableData: imagePixelModule.redPaletteColorLookupTableData,\n    greenPaletteColorLookupTableData: imagePixelModule.greenPaletteColorLookupTableData,\n    bluePaletteColorLookupTableData: imagePixelModule.bluePaletteColorLookupTableData,\n    pixelData: undefined // populated later after decoding\n  };\n}\n\nexport default getImageFrame;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/getImageFrame.js","import webWorkerManager from './webWorkerManager.js';\nimport decodeJPEGBaseline8BitColor from './decodeJPEGBaseline8BitColor.js';\n\nfunction addDecodeTask (imageFrame, transferSyntax, pixelData, options) {\n  const priority = options.priority || undefined;\n  const transferList = options.transferPixelData ? [pixelData.buffer] : undefined;\n\n  return webWorkerManager.addTask(\n    'decodeTask',\n    {\n      imageFrame,\n      transferSyntax,\n      pixelData,\n      options\n    }, priority, transferList).promise;\n}\n\nfunction decodeImageFrame (imageFrame, transferSyntax, pixelData, canvas, options = {}) {\n  // TODO: Turn this into a switch statement instead\n  if (transferSyntax === '1.2.840.10008.1.2') {\n    // Implicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1') {\n    // Explicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.2') {\n    // Explicit VR Big Endian (retired)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1.99') {\n    // Deflate transfer syntax (deflated by dicomParser)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.5') {\n    // RLE Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.50') {\n    // JPEG Baseline lossy process 1 (8 bit)\n\n    // Handle 8-bit JPEG Baseline color images using the browser's built-in\n    // JPEG decoding\n    if (imageFrame.bitsAllocated === 8 &&\n       (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\n      return decodeJPEGBaseline8BitColor(imageFrame, pixelData, canvas);\n    }\n\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.51') {\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.57') {\n    // JPEG Lossless, Nonhierarchical (Processes 14)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.70') {\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.80') {\n    // JPEG-LS Lossless Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.81') {\n    // JPEG-LS Lossy (Near-Lossless) Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.90') {\n    // JPEG 2000 Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.91') {\n    // JPEG 2000 Lossy\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  }\n\n  /* Don't know if these work...\n   // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\n   {\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\n   }\n   // JPEG 2000 Part 2 Multicomponent Image Compression\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\n   {\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\n   }\n   */\n\n  throw new Error(`No decoder for transfer syntax ${transferSyntax}`);\n}\n\nexport default decodeImageFrame;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/decodeImageFrame.js","import { getOptions } from './internal/options.js';\n\n// the taskId to assign to the next task added via addTask()\nlet nextTaskId = 0;\n\n// array of queued tasks sorted with highest priority task first\nconst tasks = [];\n\n// array of web workers to dispatch decode tasks to\nconst webWorkers = [];\n\n// The options for CornerstoneWADOImageLoader\nconst options = getOptions();\n\nconst defaultConfig = {\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\n  startWebWorkersOnDemand: true,\n  webWorkerPath: '../../dist/cornerstoneWADOImageLoaderWebWorker.js',\n  webWorkerTaskPaths: [],\n  taskConfiguration: {\n    decodeTask: {\n      loadCodecsOnStartup: true,\n      initializeCodecsOnStartup: false,\n      codecsPath: '../dist/cornerstoneWADOImageLoaderCodecs.js',\n      usePDFJS: false,\n      strict: options.strict\n    }\n  }\n};\n\nlet config;\n\nconst statistics = {\n  maxWebWorkers: 0,\n  numWebWorkers: 0,\n  numTasksQueued: 0,\n  numTasksExecuting: 0,\n  numTasksCompleted: 0,\n  totalTaskTimeInMS: 0,\n  totalTimeDelayedInMS: 0\n};\n\n/**\n * Function to start a task on a web worker\n */\nfunction startTaskOnWebWorker () {\n  // return immediately if no decode tasks to do\n  if (!tasks.length) {\n    return;\n  }\n\n  // look for a web worker that is ready\n  for (let i = 0; i < webWorkers.length; i++) {\n    if (webWorkers[i].status === 'ready') {\n      // mark it as busy so tasks are not assigned to it\n      webWorkers[i].status = 'busy';\n\n      // get the highest priority task\n      const task = tasks.shift();\n\n      task.start = new Date().getTime();\n\n      // update stats with how long this task was delayed (waiting in queue)\n      const end = new Date().getTime();\n\n      statistics.totalTimeDelayedInMS += end - task.added;\n\n      // assign this task to this web worker and send the web worker\n      // a message to execute it\n      webWorkers[i].task = task;\n      webWorkers[i].worker.postMessage({\n        taskType: task.taskType,\n        workerIndex: i,\n        data: task.data\n      }, task.transferList);\n      statistics.numTasksExecuting++;\n\n      return;\n    }\n  }\n\n  // if no available web workers and we haven't started max web workers, start a new one\n  if (webWorkers.length < config.maxWebWorkers) {\n    spawnWebWorker();\n  }\n}\n\n/**\n * Function to handle a message from a web worker\n * @param msg\n */\nfunction handleMessageFromWorker (msg) {\n  // console.log('handleMessageFromWorker', msg.data);\n  if (msg.data.taskType === 'initialize') {\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    startTaskOnWebWorker();\n  } else {\n    const start = webWorkers[msg.data.workerIndex].task.start;\n\n    webWorkers[msg.data.workerIndex].task.deferred.resolve(msg.data.result);\n    webWorkers[msg.data.workerIndex].task = undefined;\n\n    statistics.numTasksExecuting--;\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    statistics.numTasksCompleted++;\n\n    const end = new Date().getTime();\n\n    statistics.totalTaskTimeInMS += end - start;\n\n    startTaskOnWebWorker();\n  }\n}\n\n/**\n * Spawns a new web worker\n */\nfunction spawnWebWorker () {\n  // prevent exceeding maxWebWorkers\n  if (webWorkers.length >= config.maxWebWorkers) {\n    return;\n  }\n\n  // spawn the webworker\n  const worker = new Worker(config.webWorkerPath);\n\n  webWorkers.push({\n    worker,\n    status: 'initializing'\n  });\n  worker.addEventListener('message', handleMessageFromWorker);\n  worker.postMessage({\n    taskType: 'initialize',\n    workerIndex: webWorkers.length - 1,\n    config\n  });\n}\n\n/**\n * Initialization function for the web worker manager - spawns web workers\n * @param configObject\n */\nfunction initialize (configObject) {\n  configObject = configObject || defaultConfig;\n\n  // prevent being initialized more than once\n  if (config) {\n    throw new Error('WebWorkerManager already initialized');\n  }\n\n  config = configObject;\n\n  config.maxWebWorkers = config.maxWebWorkers || (navigator.hardwareConcurrency || 1);\n\n  // Spawn new web workers\n  if (!config.startWebWorkersOnDemand) {\n    for (let i = 0; i < config.maxWebWorkers; i++) {\n      spawnWebWorker();\n    }\n  }\n}\n\n/**\n * dynamically loads a web worker task\n * @param sourcePath\n * @param taskConfig\n */\nfunction loadWebWorkerTask (sourcePath, taskConfig) {\n  // add it to the list of web worker tasks paths so on demand web workers\n  // load this properly\n  config.webWorkerTaskPaths.push(sourcePath);\n\n  // if a task specific configuration is provided, merge it into the config\n  if (taskConfig) {\n    config.taskConfiguration = Object.assign(config.taskConfiguration, taskConfig);\n  }\n\n  // tell each spawned web worker to load this task\n  for (let i = 0; i < webWorkers.length; i++) {\n    webWorkers[i].worker.postMessage({\n      taskType: 'loadWebWorkerTask',\n      workerIndex: webWorkers.length - 1,\n      sourcePath,\n      config\n    });\n  }\n}\n\n/**\n * Function to add a decode task to be performed\n *\n * @param taskType - the taskType for this task\n * @param data - data specific to the task\n * @param priority - optional priority of the task (defaults to 0), > 0 is higher, < 0 is lower\n * @param transferList - optional array of data to transfer to web worker\n * @returns {*}\n */\nfunction addTask (taskType, data, priority = 0, transferList) {\n  if (!config) {\n    initialize();\n  }\n\n  let deferred = {};\n  const promise = new Promise((resolve, reject) => {\n    deferred = {\n      resolve,\n      reject\n    };\n  });\n\n  // find the right spot to insert this decode task (based on priority)\n  let i;\n\n  for (i = 0; i < tasks.length; i++) {\n    if (tasks[i].priority < priority) {\n      break;\n    }\n  }\n\n  const taskId = nextTaskId++;\n\n  // insert the decode task at position i\n  tasks.splice(i, 0, {\n    taskId,\n    taskType,\n    status: 'ready',\n    added: new Date().getTime(),\n    data,\n    deferred,\n    priority,\n    transferList\n  });\n\n  // try to start a task on the web worker since we just added a new task and a web worker may be available\n  startTaskOnWebWorker();\n\n  return {\n    taskId,\n    promise\n  };\n}\n\n/**\n * Changes the priority of a queued task\n * @param taskId - the taskId to change the priority of\n * @param priority - priority of the task (defaults to 0), > 0 is higher, < 0 is lower\n * @returns boolean - true on success, false if taskId not found\n */\nfunction setTaskPriority (taskId, priority = 0) {\n  // search for this taskId\n  for (let i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      const task = tasks.splice(i, 1)[0];\n\n      // set its priority\n      task.priority = priority;\n\n      // find the right spot to insert this decode task (based on priority)\n      for (i = 0; i < tasks.length; i++) {\n        if (tasks[i].priority < priority) {\n          break;\n        }\n      }\n\n      // insert the decode task at position i\n      tasks.splice(i, 0, task);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Cancels a queued task and rejects\n * @param taskId - the taskId to cancel\n * @param reason - optional reason the task was rejected\n * @returns boolean - true on success, false if taskId not found\n */\nfunction cancelTask (taskId, reason) {\n  // search for this taskId\n  for (let i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      const task = tasks.splice(i, 1);\n\n      task.deferred.reject(reason);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Function to return the statistics on running web workers\n * @returns object containing statistics\n */\nfunction getStatistics () {\n  statistics.maxWebWorkers = config.maxWebWorkers;\n  statistics.numWebWorkers = webWorkers.length;\n  statistics.numTasksQueued = tasks.length;\n\n  return statistics;\n}\n\nexport default {\n  initialize,\n  loadWebWorkerTask,\n  addTask,\n  getStatistics,\n  setTaskPriority,\n  cancelTask\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/webWorkerManager.js","import getMinMax from '../shared/getMinMax.js';\n\n/**\n * Special decoder for 8 bit jpeg that leverages the browser's built in JPEG decoder for increased performance\n */\n\nfunction arrayBufferToString (buffer) {\n  return binaryToString(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(buffer))));\n}\n\nfunction binaryToString (binary) {\n  let error;\n\n  try {\n    return decodeURIComponent(escape(binary));\n  } catch (_error) {\n    error = _error;\n    if (error instanceof URIError) {\n      return binary;\n    }\n    throw error;\n\n  }\n}\n\nfunction decodeJPEGBaseline8BitColor (imageFrame, pixelData, canvas) {\n  const start = new Date().getTime();\n  const imgBlob = new Blob([pixelData], { type: 'image/jpeg' });\n\n  return new Promise((resolve, reject) => {\n    const fileReader = new FileReader();\n\n    if (fileReader.readAsBinaryString === undefined) {\n      fileReader.readAsArrayBuffer(imgBlob);\n    } else {\n      fileReader.readAsBinaryString(imgBlob); // doesn't work on IE11\n    }\n\n    fileReader.onload = function () {\n      const img = new Image();\n\n      img.onload = function () {\n        canvas.height = img.height;\n        canvas.width = img.width;\n        imageFrame.rows = img.height;\n        imageFrame.columns = img.width;\n        const context = canvas.getContext('2d');\n\n        context.drawImage(this, 0, 0);\n        const imageData = context.getImageData(0, 0, img.width, img.height);\n        const end = new Date().getTime();\n\n        imageFrame.pixelData = imageData.data;\n        imageFrame.imageData = imageData;\n        imageFrame.decodeTimeInMS = end - start;\n\n        // calculate smallest and largest PixelValue\n        const minMax = getMinMax(imageFrame.pixelData);\n\n        imageFrame.smallestPixelValue = minMax.min;\n        imageFrame.largestPixelValue = minMax.max;\n\n        resolve(imageFrame);\n      };\n\n      img.onerror = function (error) {\n        reject(error);\n      };\n\n      if (fileReader.readAsBinaryString === undefined) {\n        img.src = `data:image/jpeg;base64,${window.btoa(arrayBufferToString(fileReader.result))}`;\n      } else {\n        img.src = `data:image/jpeg;base64,${window.btoa(fileReader.result)}`; // doesn't work on IE11\n      }\n    };\n\n    fileReader.onerror = (e) => {\n      reject(e);\n    };\n  });\n}\n\nexport default decodeJPEGBaseline8BitColor;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/decodeJPEGBaseline8BitColor.js","export default function (photoMetricInterpretation) {\n  return (photoMetricInterpretation === 'RGB' ||\n    photoMetricInterpretation === 'PALETTE COLOR' ||\n    photoMetricInterpretation === 'YBR_FULL' ||\n    photoMetricInterpretation === 'YBR_FULL_422' ||\n    photoMetricInterpretation === 'YBR_PARTIAL_422' ||\n    photoMetricInterpretation === 'YBR_PARTIAL_420' ||\n    photoMetricInterpretation === 'YBR_RCT' ||\n    photoMetricInterpretation === 'YBR_ICT');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/isColorImage.js","import { convertRGBColorByPixel, convertRGBColorByPlane,\n  convertYBRFullByPixel, convertYBRFullByPlane,\n  convertPALETTECOLOR } from './colorSpaceConverters/index.js';\n\nfunction convertRGB (imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    convertRGBColorByPixel(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    convertRGBColorByPlane(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\nfunction convertYBRFull (imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    convertYBRFullByPixel(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    convertYBRFullByPlane(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\nexport default function convertColorSpace (imageFrame, imageData) {\n  const rgbaBuffer = imageData.data;\n  // convert based on the photometric interpretation\n\n  if (imageFrame.photometricInterpretation === 'RGB') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_RCT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_ICT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'PALETTE COLOR') {\n    convertPALETTECOLOR(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL_422') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL') {\n    convertYBRFull(imageFrame, rgbaBuffer);\n  } else {\n    throw new Error(`No color space conversion for photometric interpretation ${imageFrame.photometricInterpretation}`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/convertColorSpace.js","function isJPEGBaseline8BitColor (imageFrame, transferSyntax) {\n  transferSyntax = transferSyntax || imageFrame.transferSyntax;\n\n  if (imageFrame.bitsAllocated === 8 &&\n     transferSyntax === '1.2.840.10008.1.2.4.50' &&\n     (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\n    return true;\n  }\n}\n\nexport default isJPEGBaseline8BitColor;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/isJPEGBaseline8BitColor.js","let files = [];\n\nfunction add (file) {\n  const fileIndex = files.push(file);\n\n  return `dicomfile:${fileIndex - 1}`;\n}\n\nfunction get (index) {\n  return files[index];\n}\n\nfunction remove (index) {\n  files[index] = undefined;\n}\n\nfunction purge () {\n  files = [];\n}\n\nexport default {\n  add,\n  get,\n  remove,\n  purge\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/fileManager.js","import { dicomParser } from '../../externalModules.js';\n\n/**\n * Function to deal with extracting an image frame from an encapsulated data set.\n */\n\n\nfunction framesAreFragmented (dataSet) {\n  const numberOfFrames = dataSet.intString('x00280008');\n  const pixelDataElement = dataSet.elements.x7fe00010;\n\n  return (numberOfFrames !== pixelDataElement.fragments.length);\n}\n\nexport default function getEncapsulatedImageFrame (dataSet, frameIndex) {\n  if (dataSet.elements.x7fe00010.basicOffsetTable.length) {\n    // Basic Offset Table is not empty\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex);\n  }\n\n  // Empty basic offset table\n\n  if (framesAreFragmented(dataSet)) {\n    const basicOffsetTable = dicomParser.createJPEGBasicOffsetTable(dataSet, dataSet.elements.x7fe00010);\n\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex, basicOffsetTable);\n  }\n\n  return dicomParser.readEncapsulatedPixelDataFromFragments(dataSet, dataSet.elements.x7fe00010, frameIndex);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/getEncapsulatedImageFrame.js","import unpackBinaryFrame from './unpackBinaryFrame.js';\n\n/**\n * Function to deal with extracting an image frame from an encapsulated data set.\n */\n\nfunction getUncompressedImageFrame (dataSet, frameIndex) {\n  const pixelDataElement = dataSet.elements.x7fe00010;\n  const bitsAllocated = dataSet.uint16('x00280100');\n  const rows = dataSet.uint16('x00280010');\n  const columns = dataSet.uint16('x00280011');\n  const samplesPerPixel = dataSet.uint16('x00280002');\n\n  const pixelDataOffset = pixelDataElement.dataOffset;\n  const pixelsPerFrame = rows * columns * samplesPerPixel;\n\n  let frameOffset;\n\n  if (bitsAllocated === 8) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame);\n  } else if (bitsAllocated === 16) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 2;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame * 2);\n  } else if (bitsAllocated === 1) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 0.125;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return unpackBinaryFrame(dataSet.byteArray, frameOffset, pixelsPerFrame);\n  }\n\n  throw new Error('unsupported pixel format');\n}\n\nexport default getUncompressedImageFrame;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/getUncompressedImageFrame.js","/* eslint no-bitwise: 0 */\n\nfunction isBitSet (byte, bitPos) {\n  return byte & (1 << bitPos);\n}\n\n/**\n * Function to deal with unpacking a binary frame\n */\nfunction unpackBinaryFrame (byteArray, frameOffset, pixelsPerFrame) {\n  // Create a new pixel array given the image size\n  const pixelData = new Uint8Array(pixelsPerFrame);\n\n  for (let i = 0; i < pixelsPerFrame; i++) {\n    // Compute byte position\n    const bytePos = Math.floor(i / 8);\n\n    // Get the current byte\n    const byte = byteArray[bytePos + frameOffset];\n\n    // Bit position (0-7) within byte\n    const bitPos = (i % 8);\n\n    // Check whether bit at bitpos is set\n    pixelData[i] = isBitSet(byte, bitPos) ? 1 : 0;\n  }\n\n  return pixelData;\n}\n\nexport default unpackBinaryFrame;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/unpackBinaryFrame.js","import parseImageId from './parseImageId.js';\nimport fileManager from './fileManager.js';\n\nfunction loadFileRequest (uri) {\n  const parsedImageId = parseImageId(uri);\n  const fileIndex = parseInt(parsedImageId.url, 10);\n  const file = fileManager.get(fileIndex);\n\n  return new Promise((resolve, reject) => {\n    const fileReader = new FileReader();\n\n    fileReader.onload = (e) => {\n      const dicomPart10AsArrayBuffer = e.target.result;\n\n      resolve(dicomPart10AsArrayBuffer);\n    };\n\n    fileReader.onerror = reject;\n\n    fileReader.readAsArrayBuffer(file);\n  });\n}\n\nexport default loadFileRequest;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/loadFileRequest.js","import { $ } from '../../externalModules.js';\nimport createImage from '../createImage.js';\nimport parseImageId from './parseImageId.js';\nimport dataSetCacheManager from './dataSetCacheManager.js';\nimport loadFileRequest from './loadFileRequest.js';\nimport getPixelData from './getPixelData.js';\nimport { xhrRequest } from '../internal/index.js';\n\n// add a decache callback function to clear out our dataSetCacheManager\nfunction addDecache (image) {\n  image.decache = function () {\n    // console.log('decache');\n    const parsedImageId = parseImageId(image.imageId);\n\n    dataSetCacheManager.unload(parsedImageId.url);\n  };\n}\n\nfunction loadImageFromPromise (dataSetPromise, imageId, frame = 0, sharedCacheKey, options) {\n  const start = new Date().getTime();\n  const deferred = $.Deferred();\n\n  dataSetPromise.then(function (dataSet/* , xhr*/) {\n    const pixelData = getPixelData(dataSet, frame);\n    const transferSyntax = dataSet.string('x00020010');\n    const loadEnd = new Date().getTime();\n    const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      image.data = dataSet;\n      image.sharedCacheKey = sharedCacheKey;\n      const end = new Date().getTime();\n\n      image.loadTimeInMS = loadEnd - start;\n      image.totalTimeInMS = end - start;\n      addDecache(image);\n      deferred.resolve(image);\n    }, function (error) {\n      deferred.reject(error);\n    });\n  }, function (error) {\n    deferred.reject(error);\n  });\n\n  return deferred;\n}\n\nfunction loadImageFromDataSet (dataSet, imageId, frame = 0, sharedCacheKey, options) {\n  const start = new Date().getTime();\n  const deferred = $.Deferred();\n\n  const pixelData = getPixelData(dataSet, frame);\n  const transferSyntax = dataSet.string('x00020010');\n  const loadEnd = new Date().getTime();\n  const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\n\n  imagePromise.then((image) => {\n    image.data = dataSet;\n    image.sharedCacheKey = sharedCacheKey;\n    const end = new Date().getTime();\n\n    image.loadTimeInMS = loadEnd - start;\n    image.totalTimeInMS = end - start;\n    addDecache(image);\n    deferred.resolve(image);\n  }, function (error) {\n    deferred.reject(error);\n  });\n\n  return deferred;\n}\n\nfunction getLoaderForScheme (scheme) {\n  if (scheme === 'dicomweb' || scheme === 'wadouri') {\n    return xhrRequest;\n  } else if (scheme === 'dicomfile') {\n    return loadFileRequest;\n  }\n}\n\nfunction loadImage (imageId, options) {\n  const parsedImageId = parseImageId(imageId);\n  const loader = getLoaderForScheme(parsedImageId.scheme);\n\n  // if the dataset for this url is already loaded, use it\n  if (dataSetCacheManager.isLoaded(parsedImageId.url)) {\n    const dataSet = dataSetCacheManager.get(parsedImageId.url, loader, imageId);\n\n    return loadImageFromDataSet(dataSet, imageId, parsedImageId.frame, parsedImageId.url, options);\n  }\n\n  // load the dataSet via the dataSetCacheManager\n  const dataSetPromise = dataSetCacheManager.load(parsedImageId.url, loader, imageId);\n\n  return loadImageFromPromise(dataSetPromise, imageId, parsedImageId.frame, parsedImageId.url, options);\n}\n\nexport { loadImageFromPromise, getLoaderForScheme, loadImage };\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/loadImage.js","export * from './colorSpaceConverters/index.js';\n\nexport { default as wadouri } from './wadouri/index.js';\nexport { default as wadors } from './wadors/index.js';\nexport { default as configure } from './configure.js';\nexport { default as convertColorSpace } from './convertColorSpace.js';\nexport { default as createImage } from './createImage.js';\nexport { default as decodeImageFrame } from './decodeImageFrame.js';\nexport { default as decodeJPEGBaseline8BitColor } from './decodeJPEGBaseline8BitColor.js';\nexport { default as getImageFrame } from './getImageFrame.js';\nexport { default as getMinMax } from '../shared/getMinMax.js';\nexport { default as isColorImage } from './isColorImage.js';\nexport { default as isJPEGBaseline8BitColor } from './isJPEGBaseline8BitColor.js';\nexport { default as webWorkerManager } from './webWorkerManager.js';\nexport { default as version } from '../version.js';\nexport { internal } from './internal/index.js';\nexport { external } from '../externalModules.js';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/index.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let rgbIndex = 0;\n  let rgbaIndex = 0;\n\n  for (let i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let rgbaIndex = 0;\n  let rIndex = 0;\n  let gIndex = numPixels;\n  let bIndex = numPixels * 2;\n\n  for (let i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[gIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[bIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let ybrIndex = 0;\n  let rgbaIndex = 0;\n\n  for (let i = 0; i < numPixels; i++) {\n    const y = imageFrame[ybrIndex++];\n    const cb = imageFrame[ybrIndex++];\n    const cr = imageFrame[ybrIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let rgbaIndex = 0;\n  let yIndex = 0;\n  let cbIndex = numPixels;\n  let crIndex = numPixels * 2;\n\n  for (let i = 0; i < numPixels; i++) {\n    const y = imageFrame[yIndex++];\n    const cb = imageFrame[cbIndex++];\n    const cr = imageFrame[crIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js","/* eslint no-bitwise: 0 */\n\nexport default function (imageFrame, rgbaBuffer) {\n  const numPixels = imageFrame.columns * imageFrame.rows;\n  let palIndex = 0;\n  let rgbaIndex = 0;\n  const pixelData = imageFrame.pixelData;\n  const start = imageFrame.redPaletteColorLookupTableDescriptor[1];\n  const rData = imageFrame.redPaletteColorLookupTableData;\n  const gData = imageFrame.greenPaletteColorLookupTableData;\n  const bData = imageFrame.bluePaletteColorLookupTableData;\n  const shift = imageFrame.redPaletteColorLookupTableDescriptor[2] === 8 ? 0 : 8;\n  let len = imageFrame.redPaletteColorLookupTableData.length;\n\n  if (len === 0) {\n    len = 65535;\n  }\n\n  for (let i = 0; i < numPixels; ++i) {\n    let value = pixelData[palIndex++];\n\n    if (value < start) {\n      value = 0;\n    } else if (value > start + len - 1) {\n      value = len - 1;\n    } else {\n      value -= start;\n    }\n\n    rgbaBuffer[rgbaIndex++] = rData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = gData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = bData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = 255;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js","import { dicomParser } from '../../../externalModules.js';\nimport getNumberValues from './getNumberValues.js';\nimport parseImageId from '../parseImageId.js';\nimport dataSetCacheManager from '../dataSetCacheManager.js';\nimport getImagePixelModule from './getImagePixelModule.js';\nimport getLUTs from './getLUTs.js';\nimport getModalityLUTOutputPixelRepresentation from './getModalityLUTOutputPixelRepresentation.js';\n\nfunction metaDataProvider (type, imageId) {\n  const parsedImageId = parseImageId(imageId);\n\n  const dataSet = dataSetCacheManager.get(parsedImageId.url);\n\n  if (!dataSet) {\n    return;\n  }\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: dataSet.string('x00080060'),\n      seriesInstanceUID: dataSet.string('x0020000e'),\n      seriesNumber: dataSet.intString('x00200011'),\n      studyInstanceUID: dataSet.string('x0020000d'),\n      seriesDate: dicomParser.parseDA(dataSet.string('x00080021')),\n      seriesTime: dicomParser.parseTM(dataSet.string('x00080031') || '')\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: dataSet.intString('x00101010'),\n      patientSize: dataSet.floatString('x00101020'),\n      patientWeight: dataSet.floatString('x00101030')\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: getNumberValues(dataSet, 'x00280030', 2),\n      imageOrientationPatient: getNumberValues(dataSet, 'x00200037', 6),\n      imagePositionPatient: getNumberValues(dataSet, 'x00200032', 3),\n      sliceThickness: dataSet.floatString('x00180050'),\n      sliceLocation: dataSet.floatString('x00201041'),\n      frameOfReferenceUID: dataSet.string('x00200052')\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return getImagePixelModule(dataSet);\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      rescaleIntercept: dataSet.floatString('x00281052'),\n      rescaleSlope: dataSet.floatString('x00281053'),\n      rescaleType: dataSet.string('x00281054'),\n      modalityLUTSequence: getLUTs(dataSet.uint16('x00280103'), dataSet.elements.x00283000)\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    const modalityLUTOutputPixelRepresentation = getModalityLUTOutputPixelRepresentation(dataSet);\n\n\n    return {\n      windowCenter: getNumberValues(dataSet, 'x00281050', 1),\n      windowWidth: getNumberValues(dataSet, 'x00281051', 1),\n      voiLUTSequence: getLUTs(modalityLUTOutputPixelRepresentation, dataSet.elements.x00283010)\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: dataSet.string('x00080016'),\n      sopInstanceUID: dataSet.string('x00080018')\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    const radiopharmaceuticalInfo = dataSet.elements.x00540016;\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    const firstRadiopharmaceuticalInfoDataSet = radiopharmaceuticalInfo.items[0].dataSet;\n\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM(firstRadiopharmaceuticalInfoDataSet.string('x00181072') || ''),\n        radionuclideTotalDose: firstRadiopharmaceuticalInfoDataSet.floatString('x00181074'),\n        radionuclideHalfLife: firstRadiopharmaceuticalInfoDataSet.floatString('x00181075')\n      }\n    };\n  }\n}\n\nexport default metaDataProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/metaDataProvider.js","module.exports = __WEBPACK_EXTERNAL_MODULE_46__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"jquery\",\"commonjs2\":\"jquery\",\"amd\":\"jquery\",\"root\":\"$\"}\n// module id = 46\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_47__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"dicom-parser\",\"commonjs2\":\"dicom-parser\",\"amd\":\"dicom-parser\",\"root\":\"dicomParser\"}\n// module id = 47\n// module chunks = 0","import wadors from './wadors/index.js';\nimport wadouri from './wadouri/index.js';\n\n/**\n * Register the WADO-URI and WADO-RS image loaders and metaData providers\n * with an instance of Cornerstone Core.\n *\n * @param cornerstone The Cornerstone Core library to register the image loaders with\n */\nfunction registerLoaders (cornerstone) {\n  wadors.register(cornerstone);\n  wadouri.register(cornerstone);\n}\n\nexport default registerLoaders;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/registerLoaders.js","import getValue from './getValue.js';\n\n/**\n * Returns the first string value as a Javascript number\n *\n * @param element - The javascript object for the specified element in the metadata\n * @param [index] - the index of the value in a multi-valued element, default is 0\n * @param [defaultValue] - The default value to return if the element does not exist\n * @returns {*}\n */\nfunction getNumberString (element, index, defaultValue) {\n  const value = getValue(element, index, defaultValue);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\n\nexport default getNumberString;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberString.js","import { dicomParser } from '../../../externalModules.js';\nimport getNumberValues from './getNumberValues.js';\nimport getValue from './getValue.js';\nimport getNumberValue from './getNumberValue.js';\nimport metaDataManager from '../metaDataManager.js';\n\nfunction metaDataProvider (type, imageId) {\n  const metaData = metaDataManager.get(imageId);\n\n  if (!metaData) {\n    return;\n  }\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: getValue(metaData['00080060']),\n      seriesInstanceUID: getValue(metaData['0020000e']),\n      seriesNumber: getNumberValue(metaData['00200011']),\n      studyInstanceUID: getValue(metaData['0020000d']),\n      seriesDate: dicomParser.parseDA(getValue(metaData['00080021'])),\n      seriesTime: dicomParser.parseTM(getValue(metaData['00080031'], 0, ''))\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: getNumberValue(metaData['00101010']),\n      patientSize: getNumberValue(metaData['00101020']),\n      patientWeight: getNumberValue(metaData['00101030'])\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: getNumberValues(metaData['00280030'], 2),\n      imageOrientationPatient: getNumberValues(metaData['00200037'], 6),\n      imagePositionPatient: getNumberValues(metaData['00200032'], 3),\n      sliceThickness: getNumberValue(metaData['00180050']),\n      sliceLocation: getNumberValue(metaData['00201041'])\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return {\n      samplesPerPixel: getNumberValue(metaData['00280002']),\n      photometricInterpretation: getValue(metaData['00280004']),\n      rows: getNumberValue(metaData['00280010']),\n      columns: getNumberValue(metaData['00280011']),\n      bitsAllocated: getNumberValue(metaData['00280100']),\n      bitsStored: getNumberValue(metaData['00280101']),\n      highBit: getValue(metaData['00280102']),\n      pixelRepresentation: getNumberValue(metaData['00280103']),\n      planarConfiguration: getNumberValue(metaData['00280006']),\n      pixelAspectRatio: getValue(metaData['00280034']),\n      smallestPixelValue: getNumberValue(metaData['00280106']),\n      largestPixelValue: getNumberValue(metaData['00280107']),\n      redPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281101']),\n      greenPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281102']),\n      bluePaletteColorLookupTableDescriptor: getNumberValues(metaData['00281103']),\n      redPaletteColorLookupTableData: getNumberValues(metaData['00281201']),\n      greenPaletteColorLookupTableData: getNumberValues(metaData['00281202']),\n      bluePaletteColorLookupTableData: getNumberValues(metaData['00281203'])\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    return {\n      // TODO VOT LUT Sequence\n      windowCenter: getNumberValues(metaData['00281050'], 1),\n      windowWidth: getNumberValues(metaData['00281051'], 1)\n    };\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      // TODO VOT LUT Sequence\n      rescaleIntercept: getNumberValue(metaData['00281052']),\n      rescaleSlope: getNumberValue(metaData['00281053']),\n      rescaleType: getValue(metaData['00281054'])\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: getValue(metaData['00080016']),\n      sopInstanceUID: getValue(metaData['00080018'])\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    const radiopharmaceuticalInfo = getValue(metaData['00540016']);\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM(getValue(radiopharmaceuticalInfo['00181072'], 0, '')),\n        radionuclideTotalDose: getNumberValue(radiopharmaceuticalInfo['00181074']),\n        radionuclideHalfLife: getNumberValue(radiopharmaceuticalInfo['00181075'])\n      }\n    };\n  }\n\n}\n\nexport default metaDataProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/metaDataProvider.js","import { $, external } from '../../externalModules.js';\nimport { getOptions } from './options.js';\n\nfunction xhrRequest (url, imageId, headers = {}, params = {}) {\n  const options = getOptions();\n\n  // Make the request for the DICOM P10 SOP Instance\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n\n    xhr.open('get', url, true);\n    xhr.responseType = 'arraybuffer';\n    options.beforeSend(xhr);\n    Object.keys(headers).forEach(function (key) {\n      xhr.setRequestHeader(key, headers[key]);\n    });\n\n    params.deferred = {\n      resolve,\n      reject\n    };\n    params.url = url;\n    params.imageId = imageId;\n\n    // Event triggered when downloading an image starts\n    xhr.onloadstart = function (event) {\n      // Action\n      if (options.onloadstart) {\n        options.onloadstart(event, params);\n      }\n\n      // Event\n      const eventData = {\n        url,\n        imageId\n      };\n\n      $(external.cornerstone.events).trigger('CornerstoneImageLoadStart', eventData);\n\n      const customEvent = new CustomEvent('cornerstoneimageloadstart', { detail: eventData });\n\n      external.cornerstone.events.dispatchEvent(customEvent);\n    };\n\n    // Event triggered when downloading an image ends\n    xhr.onloadend = function (event) {\n      // Action\n      if (options.onloadend) {\n        options.onloadend(event, params);\n      }\n\n      const eventData = {\n        url,\n        imageId\n      };\n\n      // Event\n      $(external.cornerstone.events).trigger('CornerstoneImageLoadEnd', eventData);\n\n      const customEvent = new CustomEvent('cornerstoneimageloadend', { detail: eventData });\n\n      external.cornerstone.events.dispatchEvent(customEvent);\n    };\n\n    // handle response data\n    xhr.onreadystatechange = function (event) {\n      // Action\n      if (options.onreadystatechange) {\n        options.onreadystatechange(event, params);\n\n        return;\n      }\n\n      // Default action\n      // TODO: consider sending out progress messages here as we receive the pixel data\n      if (xhr.readyState === 4) {\n        if (xhr.status === 200) {\n          resolve(xhr.response, xhr);\n        } else {\n          // request failed, reject the Promise\n          reject(xhr);\n        }\n      }\n    };\n\n    // Event triggered when downloading an image progresses\n    xhr.onprogress = function (oProgress) {\n      // console.log('progress:',oProgress)\n      const loaded = oProgress.loaded; // evt.loaded the bytes browser receive\n      let total;\n      let percentComplete;\n\n      if (oProgress.lengthComputable) {\n        total = oProgress.total; // evt.total the total bytes seted by the header\n        percentComplete = Math.round((loaded / total) * 100);\n      }\n\n      // Action\n      if (options.onprogress) {\n        options.onprogress(oProgress, params);\n      }\n\n      // Event\n      const eventData = {\n        url,\n        imageId,\n        loaded,\n        total,\n        percentComplete\n      };\n\n      $(external.cornerstone.events).trigger('CornerstoneImageLoadProgress', eventData);\n\n      const customEvent = new CustomEvent('cornerstoneimageloadprogress', { detail: eventData });\n\n      external.cornerstone.events.dispatchEvent(customEvent);\n    };\n\n    xhr.send();\n  });\n}\n\nexport default xhrRequest;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/xhrRequest.js","import loadImage from './loadImage';\nimport { metaDataProvider } from './metaData/index.js';\n\nexport default function (cornerstone) {\n  // register wadors scheme and metadata provider\n  cornerstone.registerImageLoader('wadors', loadImage);\n  cornerstone.metaData.addProvider(metaDataProvider);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/register.js","import getEncapsulatedImageFrame from './getEncapsulatedImageFrame.js';\nimport getUncompressedImageFrame from './getUncompressedImageFrame.js';\n\nfunction getPixelData (dataSet, frameIndex = 0) {\n  const pixelDataElement = dataSet.elements.x7fe00010;\n\n  if (pixelDataElement.encapsulatedPixelData) {\n    return getEncapsulatedImageFrame(dataSet, frameIndex);\n  }\n\n  return getUncompressedImageFrame(dataSet, frameIndex);\n}\n\nexport default getPixelData;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/getPixelData.js","import { loadImage } from './loadImage';\nimport { metaDataProvider } from './metaData/index.js';\n\nexport default function (cornerstone) {\n  // register dicomweb and wadouri image loader prefixes\n  cornerstone.registerImageLoader('dicomweb', loadImage);\n  cornerstone.registerImageLoader('wadouri', loadImage);\n  cornerstone.registerImageLoader('dicomfile', loadImage);\n\n  // add wadouri metadata provider\n  cornerstone.metaData.addProvider(metaDataProvider);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/register.js","import { setOptions } from './internal/index.js';\n\nfunction configure (options) {\n  setOptions(options);\n}\n\nexport default configure;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/configure.js"],"sourceRoot":""}