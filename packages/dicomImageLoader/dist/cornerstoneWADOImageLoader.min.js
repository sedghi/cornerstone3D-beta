/*! cornerstone-wado-image-loader - v0.14.0 - 2016-09-11 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={wadouri:{},wadors:{},internal:{options:{beforeSend:function(a){},imageCreated:function(a){}}}}),function(a,b,c){"use strict";function d(a){a.decache=function(){var b=c.wadouri.parseImageId(a.imageId);c.wadouri.dataSetCacheManager.unload(b.url)}}function e(a,b){var d=a.elements.x7fe00010;return d.encapsulatedPixelData?c.wadouri.getEncapsulatedImageFrame(a,b):c.wadouri.getUncompressedImageFrame(a,b)}function f(b,f,g,h,i){var j=(new Date).getTime();g=g||0;var k=a.Deferred();return b.then(function(a){var b=e(a,g),h=a.string("x00020010"),l=(new Date).getTime(),m=c.createImage(f,b,h,i);m.then(function(b){b.data=a;var c=(new Date).getTime();b.loadTimeInMS=l-j,b.totalTimeInMS=c-j,d(b),k.resolve(b)})},function(a){k.reject(a)}),k.promise()}function g(a){return"dicomweb"===a||"wadouri"===a?c.internal.xhrRequest:"dicomfile"===a?c.wadouri.loadFileRequest:void 0}function h(a,b){var d=c.wadouri.parseImageId(a),e=g(d.scheme);return c.wadouri.dataSetCacheManager.isLoaded(d.url)?f(c.wadouri.dataSetCacheManager.load(d.url,e),a,d.frame,d.url,b):f(c.wadouri.dataSetCacheManager.load(d.url,e),a,d.frame,d.url,b)}b.registerImageLoader("dicomweb",h),b.registerImageLoader("wadouri",h),b.registerImageLoader("dicomfile",h)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){var c=a.columns*a.rows,d=0,e=0,f=a.pixelData,g=a.redPaletteColorLookupTableDescriptor[1],h=a.redPaletteColorLookupTableData,i=a.greenPaletteColorLookupTableData,j=a.bluePaletteColorLookupTableData,k=8===a.redPaletteColorLookupTableDescriptor[2]?0:8,l=a.redPaletteColorLookupTableData.length;0===l&&(l=65535);for(var m=0;m<c;++m){var n=f[d++];n<g?n=0:n>g+l-1?n=l-1:n-=g,b[e++]=h[n]>>k,b[e++]=i[n]>>k,b[e++]=j[n]>>k,b[e++]=255}}a.convertPALETTECOLOR=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=c,g=2*c,h=0;h<c;h++)b[d++]=a[e++],b[d++]=a[f++],b[d++]=a[g++],b[d++]=255}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}a.convertYBRFullByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=c,g=2*c,h=0;h<c;h++){var i=a[e++],j=a[f++],k=a[g++];b[d++]=i+1.402*(k-128),b[d++]=i-.34414*(j-128)-.71414*(k-128),b[d++]=i+1.772*(j-128),b[d++]=255}}a.convertYBRFullByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b){a.internal.options=b}a.configure=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){0===b.planarConfiguration?a.convertRGBColorByPixel(b.pixelData,c):a.convertRGBColorByPlane(b.pixelData,c)}function c(b,c){0===b.planarConfiguration?a.convertYBRFullByPixel(b.pixelData,c):a.convertYBRFullByPlane(b.pixelData,c)}function d(d,e){var f=e.data;if(console.time("convertColorSpace"),"RGB"===d.photometricInterpretation)b(d,f);else if("YBR_RCT"===d.photometricInterpretation)b(d,f);else if("YBR_ICT"===d.photometricInterpretation)b(d,f);else if("PALETTE COLOR"===d.photometricInterpretation)a.convertPALETTECOLOR(d,f);else if("YBR_FULL_422"===d.photometricInterpretation)b(d,f);else{if("YBR_FULL"!==d.photometricInterpretation)throw"no color space conversion for photometric interpretation "+d.photometricInterpretation;c(d,f)}console.timeEnd("convertColorSpace")}a.convertColorSpace=d}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){return"1.2.840.10008.5.1.4.1.1.12.1"!==a&&"1.2.840.10008.5.1.4.1.1.12.2.1\t"!==a}function e(a){var b=Math.round(a.bitsAllocated/8);return a.rows*a.columns*b*a.samplesPerPixel}function f(a){16===a.bitsAllocated?0===a.pixelRepresentation?a.pixelData=new Uint16Array(a.pixelData):a.pixelData=new Int16Array(a.pixelData):a.pixelData=new Uint8Array(a.pixelData)}function g(g,j,k,l){var m=a.Deferred(),n=c.getImageFrame(g),o=c.decodeImageFrame(n,k,j,h,l);return o.then(function(a){f(a);var j=b.metaData.get("imagePlaneModule",g),k=b.metaData.get("voiLutModule",g),l=b.metaData.get("modalityLutModule",g),n=b.metaData.get("sopCommonModule",g),o={imageId:g,color:c.isColorImage(a.photometricInterpretation),columnPixelSpacing:j.pixelSpacing?j.pixelSpacing[1]:void 0,columns:a.columns,height:a.rows,intercept:l.rescaleIntercept?l.rescaleIntercept:0,invert:"MONOCHROME1"===a.photometricInterpretation,minPixelValue:a.smallestPixelValue,maxPixelValue:a.largestPixelValue,render:void 0,rowPixelSpacing:j.pixelSpacing?j.pixelSpacing[0]:void 0,rows:a.rows,sizeInBytes:e(a),slope:l.rescaleSlope?l.rescaleSlope:1,width:a.columns,windowCenter:k.windowCenter?k.windowCenter[0]:void 0,windowWidth:k.windowWidth?k.windowWidth[0]:void 0,decodeTimeInMS:a.decodeTimeInMS,webWorkerTimeInMS:a.webWorkerTimeInMS};if(o.getPixelData=function(){return a.pixelData},o.color){h.height=a.rows,h.width=a.columns;var p=h.getContext("2d"),q=p.createImageData(a.columns,a.rows);c.convertColorSpace(a,q),a.imageData=q,a.pixelData=q.data}if(o.color?(o.render=b.renderColorImage,o.getCanvas=function(){if(i===g)return h;h.height=o.rows,h.width=o.columns;var b=h.getContext("2d");return b.putImageData(a.imageData,0,0),i=g,h}):o.render=b.renderGrayscaleImage,void 0===o.minPixelValue||void 0===o.maxPixelValue){var r=c.getMinMax(a.pixelData);o.minPixelValue=r.min,o.maxPixelValue=r.max}if(l.modalityLUTSequence&&l.modalityLUTSequence.length>0&&d(n.sopClassUID)&&(o.modalityLUT=l.modalityLUTSequence[0]),k.voiLUTSequence&&k.voiLUTSequence.length>0&&(o.voiLUT=k.voiLUTSequence[0]),void 0===o.windowCenter||void 0===o.windowWidth)if(o.color)o.windowWidth=255,o.windowCenter=128;else{var s=o.maxPixelValue*o.slope+o.intercept,t=o.minPixelValue*o.slope+o.intercept;o.windowWidth=s-t,o.windowCenter=(s+t)/2}m.resolve(o)}),m.promise()}var h=document.createElement("canvas"),i="";c.createImage=g}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b,d,e){var f=e.priority||void 0,g=e.transferPixelData?[d.buffer]:void 0;return c.webWorkerManager.addTask("decodeTask",{imageFrame:a,transferSyntax:b,pixelData:d,options:e},f,g).promise}function e(a,b,e,f,g){if(g=g||{},"1.2.840.10008.1.2"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.1"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.2"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.1.99"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.5"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.4.50"===b)return 8===a.bitsAllocated?c.decodeJPEGBaseline8Bit(a,f):d(a,b,e,g);if("1.2.840.10008.1.2.4.51"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.4.57"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.4.70"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.4.80"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.4.81"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.4.90"===b)return d(a,b,e,g);if("1.2.840.10008.1.2.4.91"===b)return d(a,b,e,g);throw console&&console.log&&console.log("Image cannot be decoded due to Unsupported transfer syntax "+b),"no decoder for transfer syntax "+b}c.decodeImageFrame=e}($,cornerstone,cornerstoneWADOImageLoader),function(a,b){"use strict";function c(a){return d(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(a))))}function d(a){var b;try{return decodeURIComponent(escape(a))}catch(c){if(b=c,b instanceof URIError)return a;throw b}}function e(b,d){var e=(new Date).getTime(),f=a.Deferred(),g=new Blob([b.pixelData],{type:"image/jpeg"}),h=new FileReader;return void 0===h.readAsBinaryString?h.readAsArrayBuffer(g):h.readAsBinaryString(g),h.onload=function(){var a=new Image;a.onload=function(){d.height=a.height,d.width=a.width,b.rows=a.height,b.columns=a.width;var c=d.getContext("2d");c.drawImage(this,0,0);var g=c.getImageData(0,0,a.width,a.height),h=(new Date).getTime();b.pixelData=g.data,b.imageData=g,b.decodeTimeInMS=h-e,f.resolve(b)},a.onerror=function(a){f.reject(a)},void 0===h.readAsBinaryString?a.src="data:image/jpeg;base64,"+window.btoa(c(h.result)):a.src="data:image/jpeg;base64,"+window.btoa(h.result)},f.promise()}function f(a){if(8===a.bitsAllocated&&"1.2.840.10008.1.2.4.50"===a.transferSyntax)return!0}b.decodeJPEGBaseline8Bit=e,b.isJPEGBaseline8Bit=f}($,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var c=b.metaData.get("imagePixelModule",a);return{samplesPerPixel:c.samplesPerPixel,photometricInterpretation:c.photometricInterpretation,planarConfiguration:c.planarConfiguration,rows:c.rows,columns:c.columns,bitsAllocated:c.bitsAllocated,pixelRepresentation:c.pixelRepresentation,smallestPixelValue:c.smallestPixelValue,largestPixelValue:c.largestPixelValue,redPaletteColorLookupTableDescriptor:c.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:c.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:c.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:c.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:c.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:c.bluePaletteColorLookupTableData,pixelData:void 0}}c.getImageFrame=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b,c=a[0],d=a[0],e=a.length,f=0;f<e;f++)b=a[f],c=Math.min(c,b),d=Math.max(d,b);return{min:c,max:d}}a.getMinMax=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a||"YBR_ICT"===a}a.isColorImage=b}(cornerstoneWADOImageLoader),function(a){"use strict";a.version="0.13.3"}(cornerstoneWADOImageLoader),function(a){function b(a,b,c){if(c+a.length>b.length)return!1;for(var d=c,e=0;e<a.length;e++)if(a[e]!==b[d++])return!1;return!0}function c(a){for(var b=new Uint8Array(a.length),c=0,d=a.length;c<d;c++)b[c]=a.charCodeAt(c);return b}function d(a,d,e){e=e||0;for(var f=c(d),g=e;g<a.length;g++)if(f[0]===a[g]&&b(f,a,g))return g;return-1}a.wadors.findIndexOfString=d}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=0;b<a.length;b++)if("--"===a[b].substr(0,2))return a[b]}function c(a){for(var b=0;b<a.length;b++)if("Content-Type:"===a[b].substr(0,13))return a[b].substr(13).trim()}function d(a,b,c){b=b||0,c=c||a.length-b;for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a[e]);return d}a.wadors.getPixelData=function(e,f,g){g=g||"application/octet-stream";var h={accept:g},i=$.Deferred(),j=a.internal.xhrRequest(e,f,h);return j.then(function(e){var f=new Uint8Array(e),g=a.wadors.findIndexOfString(f,"\n\r\n");g===-1&&i.reject("invalid response - no multipart mime header");var h=d(f,0,g),j=h.split("\r\n"),k=b(j);k||i.reject("invalid response - no boundary marker");var l=g+3,m=a.wadors.findIndexOfString(f,k,l);m===-1&&i.reject("invalid response - terminating boundary not found");var n=m-l;i.resolve({contentType:c(j),imageFrame:new Uint8Array(e,l,n)})}),i.promise()}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){return"1.2.840.10008.1.2"}function e(b,e){var f=(new Date).getTime(),g=a.Deferred(),h=b.substring(7),i=c.wadors.metaDataManager.get(b);if(void 0===i)return g.reject("no metadata for imageId "+b),g.promise();var j;return c.wadors.getPixelData(h,b,j).then(function(a){var h=d(a.contentType),i=a.imageFrame.pixelData,j=c.createImage(b,i,h,e);j.then(function(a){var b=(new Date).getTime();a.loadTimeInMS=b-f,g.resolve(a)})}).fail(function(a){g.reject(a)}),g.promise()}b.registerImageLoader("wadors",e)}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b,d){var e=c.wadors.getValue(a,b,d);if(void 0!==e)return parseFloat(e)}c.wadors.getNumberString=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){var d=a.wadors.getValue(b,c);if(void 0!==d)return parseFloat(d)}a.wadors.getNumberValue=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if(a&&a.Value&&!(b&&a.Value.length<b)){for(var c=[],d=0;d<a.Value.length;d++)c.push(parseFloat(a.Value[d]));return c}}c.wadors.getNumberValues=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b,c){return b=b||0,a&&a.Value?a.Value.length<=b?c:a.Value[b]:c}c.wadors.getValue=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b){"use strict";function c(a,c){var g=b.wadors.metaDataManager.get(c);if(g)return"imagePlaneModule"===a?{pixelSpacing:d(g["00280030"],2),imageOrientationPatient:d(g["00200037"],6),imagePositionPatient:d(g["00200032"],3),sliceThickness:f(g["00180050"]),sliceLocation:f(g["00201041"])}:"imagePixelModule"===a?{samplesPerPixel:e(g["00280002"]),photometricInterpretation:e(g["00280004"]),rows:e(g["00280010"]),columns:e(g["00280011"]),bitsAllocated:e(g["00280100"]),bitsStored:e(g["00280101"]),highBit:e(g["00280102"]),pixelRepresentation:e(g["00280103"]),planarConfiguration:e(g["00280006"]),pixelAspectRatio:e(g["00280034"]),smallestPixelValue:e(g["00280106"]),largestPixelValue:e(g["00280107"])}:"voiLutModule"===a?{windowCenter:d(g["00281050"],1),windowWidth:d(g["00281051"],1)}:"modalityLutModule"===a?{rescaleIntercept:f(g["00281052"]),rescaleSlope:f(g["00281053"]),rescaleType:e(g["00281054"])}:"sopCommonModule"===a?{sopClassUID:e(g["00080016"]),sopInstanceUID:e(g["00080018"])}:void 0}var d=b.wadors.getNumberValues,e=b.wadors.getValue,f=b.wadors.getNumberValue;a.metaData.addProvider(c),b.wadors.metaDataProvider=c}(cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){f[a]=b}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.wadors.metaDataManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b){"use strict";function c(a){return void 0!==h[a]}function d(a){if(h[a])return h[a].dataSet}function e(c,d){if(d=d||b.internal.xhrRequest,h[c]){var e=a.Deferred();return h[c].cacheCount++,e.resolve(h[c].dataSet),e}if(i[c])return i[c];var f=d(c);i[c]=f;var g=a.Deferred();return f.then(function(a){var b=new Uint8Array(a),d=dicomParser.parseDicom(b);h[c]={dataSet:d,cacheCount:1},g.resolve(d),delete i[c]},function(){}).always(function(){delete i[c]}),g}function f(a){h[a]&&(h[a].cacheCount--,0===h[a].cacheCount&&delete h[a])}function g(){h={},i={}}var h={},i={};b.wadouri.dataSetCacheManager={isLoaded:c,load:e,unload:f,purge:g,get:d}}($,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"dicomfile:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.wadouri.fileManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=a.intString("x00280008"),c=a.elements.x7fe00010;if(b!=c.fragments.length)return!0}function e(a,b){if(!a.elements.x7fe00010.basicOffsetTable.length){if(d(a)){var c=dicomParser.createJPEGBasicOffsetTable(a,a.elements.x7fe00010);return dicomParser.readEncapsulatedImageFrame(a,a.elements.x7fe00010,b,c)}return dicomParser.readEncapsulatedPixelDataFromFragments(a,a.elements.x7fe00010,b)}return dicomParser.readEncapsulatedImageFrame(a,a.elements.x7fe00010,b)}function f(a,b){return e(a,b)}c.wadouri.getEncapsulatedImageFrame=f}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c,d=a.elements.x7fe00010,e=a.uint16("x00280100"),f=a.uint16("x00280010"),g=a.uint16("x00280011"),h=a.uint16("x00280002"),i=d.dataOffset,j=f*g*h;if(8===e){if(c=i+b*j,c>=a.byteArray.length)throw"frame exceeds size of pixelData";return new Uint8Array(a.byteArray.buffer,c,j)}if(16===e){if(c=i+b*j*2,c>=a.byteArray.length)throw"frame exceeds size of pixelData";return new Uint8Array(a.byteArray.buffer,c,2*j)}throw"unsupported pixel format"}c.wadouri.getUncompressedImageFrame=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(b){var d=c.wadouri.parseImageId(b),e=parseInt(d.url),f=c.wadouri.fileManager.get(e),g=a.Deferred(),h=new FileReader;return h.onload=function(a){var b=a.target.result;g.resolve(b)},h.readAsArrayBuffer(f),g.promise()}c.wadouri.loadFileRequest=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(a.elements[b]&&6==a.elements[b].length)return[a.uint16(b,0),a.uint16(b,1),a.uint16(b,2)]}function c(a,b,c){for(var d=[],e=a.elements[b],f=c[0],g=0;g<f;g++)16===c[2]?d[g]=a.uint16(b,g):d[g]=a.byteArray[g+e.dataOffset];return d}function d(a,d){a.elements.x00281101&&(d.redPaletteColorLookupTableDescriptor=b(a,"x00281101"),d.greenPaletteColorLookupTableDescriptor=b(a,"x00281102"),d.bluePaletteColorLookupTableDescriptor=b(a,"x00281103"),d.redPaletteColorLookupTableData=c(a,"x00281201",d.redPaletteColorLookupTableDescriptor),d.greenPaletteColorLookupTableData=c(a,"x00281202",d.greenPaletteColorLookupTableDescriptor),d.bluePaletteColorLookupTableData=c(a,"x00281203",d.bluePaletteColorLookupTableDescriptor))}function e(a,b){var c=a.uint16("x00280103");0===c?(b.smallestPixelValue=a.uint16("x00280106"),b.largestPixelValue=a.uint16("x00280107")):(b.smallestPixelValue=a.int16("x00280106"),b.largestPixelValue=a.int16("x00280107"))}function f(a){var b={samplesPerPixel:a.uint16("x00280002"),photometricInterpretation:a.string("x00280004"),rows:a.uint16("x00280010"),columns:a.uint16("x00280011"),bitsAllocated:a.uint16("x00280100"),bitsStored:a.uint16("x00280101"),highBit:a.uint16("x00280102"),pixelRepresentation:a.uint16("x00280103"),planarConfiguration:a.uint16("x00280006"),pixelAspectRatio:a.string("x00280034")};return e(a,b),d(a,b),b}a.wadouri.getImagePixelModule=f}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){var c=b.uint16("x00283002",0);0===c&&(c=65535);var d=0;d=0===a?b.uint16("x00283002",1):b.int16("x00283002",1);for(var e=b.uint16("x00283002",2),f={id:"1",firstValueMapped:d,numBitsPerEntry:e,lut:[]},g=0;g<c;g++)0===a?f.lut[g]=b.uint16("x00283006",g):f.lut[g]=b.int16("x00283006",g);return f}function c(a,c){if(c&&c.items.length){for(var d=[],e=0;e<c.items.length;e++){var f=c.items[e].dataSet,g=b(a,f);g&&d.push(g)}return d}}a.wadouri.getLUTs=c}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.uint16("x00280103"),c=a.uint16("x00280101");return 0===b?0:-1<<c-1}function c(a){var c=a.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===c||"1.2.840.10008.5.1.4.1.1.2.1"===c)return 1;var d=a.floatString("x00281052"),e=a.floatString("x00281053");if(void 0!==d&&void 0!==e){var f=b(a),g=f*e+d;return g<0?1:0}return a.elements.x00283000&&a.elements.x00283000.length>0?0:a.uint16("x00280103")}a.wadouri.getModalityLUTOutputPixelRepresentation=c}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b,c){var d=[],e=a.string(b);if(e){var f=e.split("\\");if(!(c&&f.length<c)){for(var g=0;g<f.length;g++)d.push(parseFloat(f[g]));return d}}}a.wadouri.getNumberValues=b}(cornerstoneWADOImageLoader),function(a,b){"use strict";function c(a,c){var e=b.wadouri.parseImageId(c),f=b.wadouri.dataSetCacheManager.get(e.url);if(f){if("imagePlaneModule"===a)return{pixelSpacing:d(f,"x00280030",2),imageOrientationPatient:d(f,"x00200037",6),imagePositionPatient:d(f,"x00200032",3),sliceThickness:f.floatString("x00180050"),sliceLocation:f.floatString("x00201041"),frameOfReferenceUID:f.string("x00200052")};if("imagePixelModule"===a)return b.wadouri.getImagePixelModule(f);if("modalityLutModule"===a)return{rescaleIntercept:f.floatString("x00281052"),rescaleSlope:f.floatString("x00281053"),rescaleType:f.string("x00281054"),modalityLUTSequence:b.wadouri.getLUTs(f.uint16("x00280103"),f.elements.x00283000)};if("voiLutModule"===a){var g=b.wadouri.getModalityLUTOutputPixelRepresentation(f);return{windowCenter:d(f,"x00281050",1),windowWidth:d(f,"x00281051",1),voiLUTSequence:b.wadouri.getLUTs(g,f.elements.x00283010)}}return"sopCommonModule"===a?{sopClassUID:f.string("x00080016"),sopInstanceUID:f.string("x00080018")}:void 0}}var d=b.wadouri.getNumberValues;a.metaData.addProvider(c),b.wadouri.metaDataProvider=c}(cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b,c=a.indexOf(":"),d=a.substring(c+1),e=d.indexOf("frame=");if(e!==-1){var f=d.substr(e+6);b=parseInt(f),d=d.substr(0,e-1)}return{scheme:a.substr(0,c),url:d,frame:b}}a.wadouri.parseImageId=b}(cornerstoneWADOImageLoader),function(a,b){"use strict";function c(){if(n.length){for(var a=0;a<o.length;a++)if("ready"===o[a].status){o[a].status="busy";var b=n.shift();b.start=(new Date).getTime();var c=(new Date).getTime();return q.totalTimeDelayedInMS+=c-b.added,o[a].task=b,o[a].worker.postMessage({taskType:b.taskType,workerIndex:a,data:b.data},b.transferList),void q.numTasksExecuting++}o.length<l.maxWebWorkers&&e()}}function d(a){if("initialize"===a.data.taskType)o[a.data.workerIndex].status="ready",c();else{q.numTasksExecuting--,o[a.data.workerIndex].status="ready",q.numTasksCompleted++;var b=(new Date).getTime();q.totalTaskTimeInMS+=b-o[a.data.workerIndex].task.start,o[a.data.workerIndex].task.deferred.resolve(a.data.result),o[a.data.workerIndex].task=void 0,c()}}function e(){if(!(o.length>=l.maxWebWorkers)){var a=new Worker(l.webWorkerPath);o.push({worker:a,status:"initializing"}),a.addEventListener("message",d),a.postMessage({taskType:"initialize",workerIndex:o.length-1,config:l})}}function f(a){if(a=a||p,l)throw new Error("WebWorkerManager already initialized");if(l=a,l.maxWebWorkers=l.maxWebWorkers||navigator.hardwareConcurrency||1,!l.startWebWorkersOnDemand)for(var b=0;b<l.maxWebWorkers;b++)e()}function g(a,b){l.webWorkerTaskPaths.push(a),b&&(l.taskConfiguration=Object.assign(l.taskConfiguration,b));for(var c=0;c<o.length;c++)o[c].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:o.length-1,sourcePath:a,config:l})}function h(b,d,e,g){l||f(),e=e||0;for(var h=a.Deferred(),i=0;i<n.length&&!(n[i].priority<=e);i++);var j=m++;return n.splice(i,0,{taskId:j,taskType:b,status:"ready",added:(new Date).getTime(),data:d,deferred:h,priority:e,transferList:g}),c(),{taskId:j,promise:h.promise()}}function i(a,b){for(var c=0;c<n.length;c++)if(n[c].taskId===a){var d=n.splice(c,1)[0];for(d.priority=b,c=0;c<n.length&&!(n[c].priority<=b);c++);return n.splice(c,0,d),!0}return!1}function j(a,b){for(var c=0;c<n.length;c++)if(n[c].taskId===a){var d=n.splice(c,1);return d.promise.reject(b),!0}return!1}function k(){return q.maxWebWorkers=l.maxWebWorkers,q.numWebWorkers=o.length,q.numTasksQueued=n.length,q}var l,m=0,n=[],o=[],p={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerPath:"../../dist/cornerstoneWADOImageLoaderWebWorker.js",webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"../dist/cornerstoneWADOImageLoaderCodecs.js",usePDFJS:!1}}},q={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};b.webWorkerManager={initialize:f,loadWebWorkerTask:g,addTask:h,getStatistics:k,setTaskPriority:i,cancelTask:j}}($,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d,e,f){f=f||{};var g=a.Deferred(),h=new XMLHttpRequest;return h.open("get",d,!0),h.responseType="arraybuffer",c.internal.options.beforeSend(h),Object.keys(f).forEach(function(a){h.setRequestHeader(a,f[a])}),h.onreadystatechange=function(){4===h.readyState&&(200===h.status?g.resolve(h.response,h):g.reject(h))},h.onprogress=function(c){if(c.lengthComputable){var d=c.loaded,f=c.total,g=Math.round(d/f*100);a(b).trigger("CornerstoneImageLoadProgress",{imageId:e,loaded:d,total:f,percentComplete:g})}},h.send(),g.promise()}c.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader);