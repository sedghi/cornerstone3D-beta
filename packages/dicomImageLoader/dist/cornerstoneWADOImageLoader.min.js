/*! cornerstone-wado-image-loader - v0.14.0 - 2016-07-08 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={wadors:{},internal:{options:{beforeSend:function(a){},imageCreated:function(a){}}}}),function(a,b,c){"use strict";function d(a){a.decache=function(){var b=c.parseImageId(a.imageId);c.dataSetCacheManager.unload(b.url)}}function e(b,e,f,g){var h=a.Deferred();return b.then(function(a,b){var i=new Uint8Array(a),j=dicomParser.parseDicom(i),k=c.createImageObject(j,e,f,g);k.then(function(a){d(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}function f(a){return"dicomweb"===a||"wadouri"===a?c.internal.xhrRequest:"dicomfile"===a?c.internal.loadFileRequest:void 0}function g(b){var g=(new Date).getTime(),h=c.parseImageId(b),i=f(h.scheme);if(c.dataSetCacheManager.isLoaded(h.url))return e(c.dataSetCacheManager.load(h.url,i),b,h.frame,h.url);if(void 0!==h.frame)return e(c.dataSetCacheManager.load(h.url,i),b,h.frame,h.url);var j=a.Deferred(),k=i(h.url,b);return k.then(function(a,e){var f=new Uint8Array(a),i=dicomParser.parseDicom(f),k=c.createImageObject(i,b,h.frame);k.then(function(a){d(a);var b=(new Date).getTime();a.loadTimeInMS=b-g,j.resolve(a)},function(a){j.reject(a)})},function(a){j.reject(a)}),j}c.internal.loadImage=g}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){0===b.planarConfiguration?a.convertRGBColorByPixel(b.pixelData,c):a.convertRGBColorByPlane(b.pixelData,c)}function c(b,c){0===b.planarConfiguration?a.convertYBRFullByPixel(b.pixelData,c):a.convertYBRFullByPlane(b.pixelData,c)}function d(d,e){var f=e.data,g=$.Deferred();try{if("RGB"===d.photometricInterpretation)b(d,f);else if("YBR_RCT"===d.photometricInterpretation)b(d,f);else if("YBR_ICT"===d.photometricInterpretation)b(d,f);else if("PALETTE COLOR"===d.photometricInterpretation)a.convertPALETTECOLOR(d,f);else if("YBR_FULL_422"===d.photometricInterpretation)b(d,f);else{if("YBR_FULL"!==d.photometricInterpretation)throw"no color space conversion for photometric interpretation "+d.photometricInterpretation;c(d,f)}return g.resolve(e),g.promise()}catch(h){return g.reject(h),g.promise()}}a.convertColorSpace=d}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){for(var c=a.columns*a.rows,d=0,e=0,f=a.pixelData,g=a.palette.start,h=a.palette.rData,i=a.palette.gData,j=a.palette.bData,k=8===a.palette.bits?0:8,l=a.palette.rData.length,m=0;m<c;++m){var n=f[d++];n<g?n=0:n>g+l-1?n=l-1:n-=g,b[e++]=h[n]>>k,b[e++]=i[n]>>k,b[e++]=j[n]>>k,b[e++]=255}}a.convertPALETTECOLOR=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=c,g=2*c,h=0;h<c;h++)b[d++]=a[e++],b[d++]=a[f++],b[d++]=a[g++],b[d++]=255}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}a.convertYBRFullByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=c,g=2*c,h=0;h<c;h++){var i=a[e++],j=a[f++],k=a[g++];b[d++]=i+1.402*(k-128),b[d++]=i-.34414*(j-128)-.71414*(k-128),b[d++]=i+1.772*(j-128),b[d++]=255}}a.convertYBRFullByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b){a.internal.options=b}a.configure=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c,d,e){void 0===d&&(d=0);var f=b.string("x00280004"),g=a.isColorImage(f);return g===!1?a.makeGrayscaleImage(c,b,d,e):a.makeColorImage(c,b,d,e)}a.createImageObject=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return void 0!==f[a]}function c(a,b){if(f[a]){var c=$.Deferred();return f[a].cacheCount++,c.resolve(f[a].dataSet),c}if(g[a])return g[a];var d=b(a);return g[a]=d,d.then(function(b){f[a]={dataSet:b,cacheCount:1},delete g[a]},function(){}).always(function(){delete g[a]}),d}function d(a){f[a]&&(f[a].cacheCount--,0===f[a].cacheCount&&delete f[a])}function e(){f={},g={}}var f={},g={};a.dataSetCacheManager={isLoaded:b,load:c,unload:d,purge:e}}(cornerstoneWADOImageLoader),function(a){function b(a){return(255&a)<<8|a>>8&255}function c(a,c){if(16===a.bitsAllocated){var d=c.buffer,e=c.byteOffset,f=c.length;e%2&&(d=d.slice(e),e=0),0===a.pixelRepresentation?a.pixelData=new Uint16Array(d,e,f/2):a.pixelData=new Int16Array(d,e,f/2);for(var g=0;g<a.pixelData.length;g++)a[g]=b(a.pixelData[g])}else 8===a.bitsAllocated&&(a.pixelData=c);return a}a.decodeBigEndian=c}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b,d){var e=(new Date).getTime();if("1.2.840.10008.1.2"===b)a=c.decodeLittleEndian(a,d);else if("1.2.840.10008.1.2.1"===b)a=c.decodeLittleEndian(a,d);else if("1.2.840.10008.1.2.2"===b)a=c.decodeBigEndian(a,d);else if("1.2.840.10008.1.2.1.99"===b)a=c.decodeLittleEndian(a,d);else if("1.2.840.10008.1.2.5"===b)a=c.decodeRLE(a,d);else if("1.2.840.10008.1.2.4.50"===b)a=c.decodeJPEGBaseline(a,d);else if("1.2.840.10008.1.2.4.51"===b)a=c.decodeJPEGBaseline(a,d);else if("1.2.840.10008.1.2.4.57"===b)a=c.decodeJPEGLossless(a,d);else if("1.2.840.10008.1.2.4.70"===b)a=c.decodeJPEGLossless(a,d);else if("1.2.840.10008.1.2.4.80"===b)a=c.decodeJPEGLS(a,d);else if("1.2.840.10008.1.2.4.81"===b)a=c.decodeJPEGLS(a,d);else if("1.2.840.10008.1.2.4.90"===b)a=c.decodeJPEG2000(a,d);else{if("1.2.840.10008.1.2.4.91"!==b)throw console&&console.log&&console.log("Image cannot be decoded due to Unsupported transfer syntax "+b),"no decoder for transfer syntax "+b;a=c.decodeJPEG2000(a,d)}var f=(new Date).getTime();return a.decodeTimeInMS=f-e,a}c.decodeImageFrame=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=new JpxImage;c.parse(b);var d=c.tiles.length;if(1!==d)throw"JPEG2000 decoder returned a tileCount of "+d+", when 1 is expected";return a.columns=c.width,a.rows=c.height,a.pixelData=c.tiles[0].items,a}function e(a,b,c){var d=h._malloc(a.length);h.writeArrayToMemory(a,d);var e=h._malloc(4),f=h._malloc(4),g=h._malloc(4),i=h._malloc(4),j=h._malloc(4),k=Date.now(),l=h.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[d,a.length,e,f,g,i,j]);if(0!==l)return console.log("[opj_decode] decoding failed!"),h._free(d),h._free(h.getValue(e,"*")),h._free(g),h._free(i),h._free(f),void h._free(j);var m=h.getValue(e,"*"),n={length:h.getValue(f,"i32"),sx:h.getValue(g,"i32"),sy:h.getValue(i,"i32"),nbChannels:h.getValue(j,"i32"),perf_timetodecode:void 0,pixelData:void 0},o=n.sx*n.sy*n.nbChannels,p=new Int32Array(h.HEAP32.buffer,m,o);if(1===b)if(Uint8Array.from)n.pixelData=Uint8Array.from(p);else{n.pixelData=new Uint8Array(o);for(var q=0;q<o;q++)n.pixelData[q]=p[q]}else if(c)if(Int16Array.from)n.pixelData=Int16Array.from(p);else{n.pixelData=new Int16Array(o);for(var q=0;q<o;q++)n.pixelData[q]=p[q]}else if(Uint16Array.from)n.pixelData=Uint16Array.from(p);else{n.pixelData=new Uint16Array(o);for(var q=0;q<o;q++)n.pixelData[q]=p[q]}var r=Date.now();return n.perf_timetodecode=r-k,h._free(d),h._free(e),h._free(m),h._free(f),h._free(g),h._free(i),h._free(j),n}function f(a,b){var c=a.bitsAllocated<=8?1:2,d=1===a.pixelRepresentation,f=e(b,c,d);return a.columns=f.sx,a.rows=f.sy,a.pixelData=f.pixelData,a.photometricInterpretation="RGB",a}function g(a,b){if("undefined"==typeof OpenJPEG&&"undefined"==typeof JpxImage)throw"No JPEG2000 decoder loaded";if("undefined"!=typeof OpenJPEG){if(!h&&(h=OpenJPEG(),!h||!h._jp2_decode))throw"OpenJPEG failed to initialize";return f(a,b)}if("undefined"!=typeof JpxImage)return d(a,b)}var h;c.decodeJPEG2000=g}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if("undefined"==typeof JpegImage)throw"No JPEG Baseline decoder loaded";var c=new JpegImage;return c.parse(b),8===a.bitsAllocated?(a.pixelData=c.getData(a.columns,a.rows),a):16===a.bitsAllocated?(a.pixelData=c.getData16(a.columns,a.rows),a):void 0}c.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return c(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(a))))}function c(a){var b;try{return decodeURIComponent(escape(a))}catch(c){if(b=c,b instanceof URIError)return a;throw b}}function d(a,c){var d=(new Date).getTime(),e=$.Deferred(),f=new Blob([a.pixelData],{type:"image/jpeg"}),g=new FileReader;return void 0===g.readAsBinaryString?g.readAsArrayBuffer(f):g.readAsBinaryString(f),g.onload=function(){var f=new Image;f.onload=function(){c.height=f.height,c.width=f.width,a.rows=f.height,a.columns=f.width;var b=c.getContext("2d");b.drawImage(this,0,0);var g=b.getImageData(0,0,f.width,f.height),h=(new Date).getTime();a.decodeTimeInMS=h-d,e.resolve(g)},f.onerror=function(a){e.reject(a)},void 0===g.readAsBinaryString?f.src="data:image/jpeg;base64,"+window.btoa(b(g.result)):f.src="data:image/jpeg;base64,"+window.btoa(g.result)},e.promise()}function e(a){if(8===a.bitsAllocated&&"1.2.840.10008.1.2.4.50"===a.transferSyntax)return!0}a.decodeJPEGBaseline8Bit=d,a.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader),function(a){function b(a,b){if("undefined"==typeof jpeg||"undefined"==typeof jpeg.lossless||"undefined"==typeof jpeg.lossless.Decoder)throw"No JPEG Lossless decoder loaded";var c=a.bitsAllocated<=8?1:2,d=b.buffer,e=new jpeg.lossless.Decoder,f=e.decode(d,d.byteOffset,d.length,c);return 0===a.pixelRepresentation?16===a.bitsAllocated?(a.pixelData=new Uint16Array(f.buffer),a):(a.pixelData=new Uint8Array(f.buffer),a):(a.pixelData=new Int16Array(f.buffer),a)}a.decodeJPEGLossless=b}(cornerstoneWADOImageLoader),function(a){function b(a,b){var c=d._malloc(a.length);d.writeArrayToMemory(a,c);var e=d._malloc(4),f=d._malloc(4),g=d._malloc(4),h=d._malloc(4),i=d._malloc(4),j=d._malloc(4),k=d._malloc(4),l=d._malloc(4),m=d._malloc(4),n=d.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[c,a.length,e,f,g,h,i,j,l,k,m]),o={result:n,width:d.getValue(g,"i32"),height:d.getValue(h,"i32"),bitsPerSample:d.getValue(i,"i32"),stride:d.getValue(j,"i32"),components:d.getValue(l,"i32"),allowedLossyError:d.getValue(k,"i32"),interleaveMode:d.getValue(m,"i32"),pixelData:void 0},p=d.getValue(e,"*");if(o.bitsPerSample<=8){o.pixelData=new Uint8Array(o.width*o.height*o.components);var q=new Uint8Array(d.HEAP8.buffer,p,o.pixelData.length);o.pixelData.set(q)}else if(b){o.pixelData=new Int16Array(o.width*o.height*o.components);var r=new Int16Array(d.HEAP16.buffer,p,o.pixelData.length);o.pixelData.set(r)}else{o.pixelData=new Uint16Array(o.width*o.height*o.components);var r=new Uint16Array(d.HEAP16.buffer,p,o.pixelData.length);o.pixelData.set(r)}return d._free(c),d._free(p),d._free(e),d._free(f),d._free(g),d._free(h),d._free(i),d._free(j),d._free(l),d._free(m),o}function c(a,c){if("undefined"==typeof CharLS)throw"No JPEG-LS decoder loaded";if(!d&&(d=CharLS(),!d||!d._jpegls_decode))throw"JPEG-LS failed to initialize";var e=b(c,1===a.pixelRepresentation);if(0!==e.result&&6!==e.result)throw"JPEG-LS decoder failed to decode frame (error code "+e.result+")";return a.columns=e.width,a.rows=e.height,a.pixelData=e.pixelData,a}var d;a.decodeJPEGLS=c}(cornerstoneWADOImageLoader),function(a){function b(a,b){if(16===a.bitsAllocated){var c=b.buffer,d=b.byteOffset,e=b.length;d%2&&(c=c.slice(d),d=0),0===a.pixelRepresentation?a.pixelData=new Uint16Array(c,d,e/2):a.pixelData=new Int16Array(c,d,e/2)}else 8===a.bitsAllocated&&(a.pixelData=b);return a}a.decodeLittleEndian=b}(cornerstoneWADOImageLoader),function(a){function b(a,b){if(8===a.bitsAllocated)return c(a,b);if(16===a.bitsAllocated)return d(a,b);throw"unsupported pixel format for RLE"}function c(a,b){for(var c=b,d=a.rows*a.columns,e=new ArrayBuffer(d*a.samplesPerPixel),f=new DataView(c.buffer,c.byteOffset),g=new DataView(c.buffer,c.byteOffset),h=new DataView(e),i=0,j=f.getInt32(0,!0),k=0;k<j;++k){i=k;var l=f.getInt32(4*(k+1),!0),m=f.getInt32(4*(k+2),!0);0===m&&(m=c.length);for(var n=d*j;l<m;){var o=g.getInt8(l++);if(o>=0&&o<=127)for(var p=0;p<o+1&&i<n;++p)h.setInt8(i,g.getInt8(l++)),i+=a.samplesPerPixel;else if(o<=-1&&o>=-127)for(var q=g.getInt8(l++),r=0;r<-o+1&&i<n;++r)h.setInt8(i,q),i+=a.samplesPerPixel}}return a.pixelData=new Uint8Array(e),a}function d(a,b){for(var c=b,d=a.rows*a.columns,e=new ArrayBuffer(d*a.samplesPerPixel*2),f=new DataView(c.buffer,c.byteOffset),g=new DataView(c.buffer,c.byteOffset),h=new DataView(e),i=f.getInt32(0,!0),j=0;j<i;++j){var k=0,l=0===j?1:0,m=f.getInt32(4*(j+1),!0),n=f.getInt32(4*(j+2),!0);for(0===n&&(n=c.length);m<n;){var o=g.getInt8(m++);if(o>=0&&o<=127)for(var p=0;p<o+1&&k<d;++p)h.setInt8(2*k+l,g.getInt8(m++)),k++;else if(o<=-1&&o>=-127)for(var q=g.getInt8(m++),r=0;r<-o+1&&k<d;++r)h.setInt8(2*k+l,q),k++}}return 0===a.pixelRepresentation?a.pixelData=new Uint16Array(e):a.pixelData=new Int16Array(e),a}a.decodeRLE=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){var d=a.getRawImageFrame(b,c);return a.decodeImageFrame(d)}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=a.intString("x00280008"),c=a.elements.x7fe00010;if(b!=c.fragments.length)return!0}function e(a,b){if(!a.elements.x7fe00010.basicOffsetTable.length){if(d(a)){var c=dicomParser.createJPEGBasicOffsetTable(a,a.elements.x7fe00010);return dicomParser.readEncapsulatedImageFrame(a,a.elements.x7fe00010,b,c)}return dicomParser.readEncapsulatedPixelDataFromFragments(a,a.elements.x7fe00010,b)}return dicomParser.readEncapsulatedImageFrame(a,a.elements.x7fe00010,b)}function f(a,b){return e(a,b)}c.getEncapsulatedImageFrame=f}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.elements.x7fe00010,d=a.uint16("x00280100"),e=a.uint16("x00280010"),f=a.uint16("x00280011"),g=a.uint16("x00280002"),h=c.dataOffset,i=e*f*g;if(8===d){var j=h+b*i;if(j>=a.byteArray.length)throw"frame exceeds size of pixelData";return new Uint8Array(a.byteArray.buffer,j,i)}if(16===d){var j=h+b*i*2;if(j>=a.byteArray.length)throw"frame exceeds size of pixelData";return new Uint8Array(a.byteArray.buffer,j,2*i)}throw"unsupported pixel format"}c.getUncompressedImageFrame=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(b.elements.x00283002&&b.elements.x00283002&&b.elements.x00283006){var c=b.uint16("x00283002",0);0===c&&(c=65535);var d;d=0===a?b.uint16("x00283002",1):b.int16("x00283002",1);var e=b.uint16("x00283002",2);if(void 0!==c&&void 0!==d&&void 0!==e){for(var f={id:"1",firstValueMapped:d,numBitsPerEntry:e,lut:[]},g=0;g<c;g++)0===a?f.lut[g]=b.uint16("x00283006",g):f.lut[g]=b.int16("x00283006",g);return f}}}a.getLUT=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;f<d;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}a.getMinMax=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.int16("x00281101",0);return b||(b=65536),b}function c(a){if(a.elements.x00281101&&a.elements.x00281201&&a.elements.x00281202&&a.elements.x00281203){var c=b(a),d=a.byteArray.buffer;return{start:a.int16("x00281101",1),bits:a.int16("x00281101",2),rData:new Uint16Array(d,a.elements.x00281201.dataOffset,c),gData:new Uint16Array(d,a.elements.x00281202.dataOffset,c),bData:new Uint16Array(d,a.elements.x00281203.dataOffset,c)}}}a.getPalette=c}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.uint16("x00280103"),c=a.uint16("x00280100");return 0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}a.getPixelFormat=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.string("x00280030");if(b&&b.length>0){var c=b.split("\\");if(parseFloat(c[0])&&parseFloat(c[1]))return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}a.getPixelSpacing=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b={transferSyntax:a.string("x00020010"),samplesPerPixel:a.uint16("x00280002"),photometricInterpretation:a.string("x00280004"),planarConfiguration:a.uint16("x00280006"),rows:a.uint16("x00280010"),columns:a.uint16("x00280011"),bitsAllocated:a.uint16("x00280100"),pixelRepresentation:a.uint16("x00280103"),palette:c.getPalette(a),storedPixelData:void 0};return b}c.getRawImageFrame=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={intercept:0,slope:1};return a.elements.x00281052&&a.elements.x00281053&&(b.intercept=a.floatString("x00281052")||b.intercept,b.slope=a.floatString("x00281053")||b.slope),b}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0};return a.elements.x00281050&&a.elements.x00281051&&(b.windowCenter=a.floatString("x00281050"),b.windowWidth=a.floatString("x00281051")),b}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";b.registerImageLoader("dicomfile",c.internal.loadImage)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"dicomfile:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.fileManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(b){var d=c.parseImageId(b),e=parseInt(d.url),f=c.fileManager.get(e),g=a.Deferred(),h=new FileReader;return h.onload=function(a){var b=a.target.result;g.resolve(b)},h.readAsArrayBuffer(f),g.promise()}c.internal.loadFileRequest=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=Math.round(a.bitsAllocated),c=a.rows*a.columns*b*a.samplesPerPixel;return c}function e(a,e){var f=c.wadors.metaDataProvider,g=f("imagePlaneModule",a),h=f("voiLutModule",a),i=f("modalityLutModule",a),j={imageId:a,color:c.isColorImage(e.photometricInterpretation),columnPixelSpacing:g.pixelSpacing?g.pixelSpacing[1]:void 0,columns:e.columns,height:e.rows,intercept:i.rescaleIntercept?i.rescaleIntercept:0,invert:"MONOCHROME1"===e.photometricInterpretation,minPixelValue:e.smallestPixelValue,maxPixelValue:e.largestPixelValue,render:b.renderGrayscaleImage,rowPixelSpacing:g.pixelSpacing?g.pixelSpacing[0]:void 0,rows:e.rows,sizeInBytes:d(e),slope:i.rescaleSlope?i.rescaleSlope:1,width:e.columns,windowCenter:h.windowCenter?h.windowCenter[0]:void 0,windowWidth:h.windowWidth?h.windowWidth[0]:void 0,decodeTimeInMS:e.decodeTimeInMS};if(j.getPixelData=function(){return e.pixelData},j.color?j.renderer=b.renderColorImage:j.renderer=b.renderGrayscaleImage,void 0===j.minPixelValue||void 0===j.maxPixelValue){var k=c.getMinMax(e.pixelData);j.minPixelValue=k.min,j.maxPixelValue=k.max}if(void 0===j.windowCenter||void 0===j.windowWidth){var l=j.maxPixelValue*j.slope+j.intercept,m=j.minPixelValue*j.slope+j.intercept;j.windowWidth=l-m,j.windowCenter=(l+m)/2}return j}c.wadors.createImage=e}($,cornerstone,cornerstoneWADOImageLoader),function(a){function b(a,b,c){if(c+a.length>b.length)return!1;for(var d=c,e=0;e<a.length;e++)if(a[e]!==b[d++])return!1;return!0}function c(a){for(var b=new Uint8Array(a.length),c=0,d=a.length;c<d;c++)b[c]=a.charCodeAt(c);return b}function d(a,d,e){e=e||0;for(var f=c(d),g=e;g<a.length;g++)if(f[0]===a[g]&&b(f,a,g))return g;return-1}a.wadors.findIndexOfString=d}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=c.wadors.metaDataProvider("imagePixelModule",a),d={samplesPerPixel:b.samplesPerPixel,photometricInterpretation:b.photometricInterpretation,planarConfiguration:b.planarConfiguration,rows:b.rows,columns:b.columns,bitsAllocated:b.bitsAllocated,pixelRepresentation:b.pixelRepresentation,smallestPixelValue:b.smallestPixelValue,largestPixelValue:b.largestPixelValue,palette:void 0,storedPixelData:void 0};return d}c.wadors.getImageFrame=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b,d){var e=c.wadors.getValue(a,b,d);if(void 0!==e)return parseFloat(e)}c.wadors.getNumberString=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if(a&&a.Value&&!(b&&a.Value.length<b)){for(var c=[],d=0;d<a.Value.length;d++)c.push(parseFloat(a.Value[d]));return c}}c.wadors.getNumberValues=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=0;b<a.length;b++)if("--"===a[b].substr(0,2))return a[b]}function c(a){for(var b=0;b<a.length;b++)if("Content-Type:"===a[b].substr(0,13))return a[b].substr(13).trim()}function d(a,b,c){b=b||0,c=c||a.length-b;for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a[e]);return d}a.wadors.getPixelData=function(e,f,g){g=g||"application/octet-stream";var h={accept:g},i=$.Deferred(),j=a.internal.xhrRequest(e,f,h);return j.then(function(e,f){var g=new Uint8Array(e),h=a.wadors.findIndexOfString(g,"\n\r\n");h===-1&&i.reject("invalid response - no multipart mime header");var j=d(g,0,h),k=j.split("\r\n"),l=b(k);l||i.reject("invalid response - no boundary marker");var m=h+3,n=a.wadors.findIndexOfString(g,l,m);n===-1&&i.reject("invalid response - terminating boundary not found");var o=n-m;i.resolve({contentType:c(k),imageFrame:new Uint8Array(e,m,o)})}),i.promise()}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b,c){return b=b||0,a&&a.Value?a.Value.length<=b?c:a.Value[b]:c}c.wadors.getValue=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){f[a]=b}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.wadors.metaDataManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){var c=e(a,b);if(void 0!==c)return parseFloat(c)}function c(c,f){var g=a.wadors.metaDataManager.get(f);if(g)return"imagePlaneModule"===c?{pixelSpacing:d(g["00280030"],2),imageOrientationPatient:d(g["00200037"],6),imagePositionPatient:d(g["00200032"],3),sliceThickness:b(g["00180050"]),sliceLocation:b(g["00201041"])}:"imagePixelModule"===c?{samplesPerPixel:e(g["00280002"]),photometricInterpretation:e(g["00280004"]),rows:e(g["00280010"]),columns:e(g["00280011"]),bitsAllocated:e(g["00280100"]),bitsStored:e(g["00280101"]),highBit:e(g["00280102"]),pixelRepresentation:e(g["00280103"]),planarConfiguration:e(g["00280006"]),pixelAspectRatio:e(g["00280034"]),smallestPixelValue:e(g["00280106"]),largestPixelValue:e(g["00280107"])}:"voiLutModule"===c?{windowCenter:d(g["00281050"],1),windowWidth:d(g["00281051"],1)}:"modalityLutModule"===c?{rescaleIntercept:b(g["00281052"]),rescaleSlope:b(g["00281053"]),rescaleType:e(g["00281054"])}:void 0}var d=a.wadors.getNumberValues,e=a.wadors.getValue;a.wadors.metaDataProvider=c}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){return"1.2.840.10008.1.2"}function e(b){var e=(new Date).getTime(),f=a.Deferred(),g=b.substring(7),h=c.wadors.metaDataManager.get(b);if(void 0===h)return f.reject("no metadata for imageId "+b),f.promise();var i;return c.wadors.getPixelData(g,b,i).then(function(a){var g=c.wadors.getImageFrame(b),h=d(a.contentType);g=c.decodeImageFrame(g,h,a.imageFrame);var i=c.wadors.createImage(b,g),j=(new Date).getTime();i.loadTimeInMS=j-e,f.resolve(i)}).fail(function(a){f.reject(a)}),f.promise()}b.registerImageLoader("wadors",e)}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";b.registerImageLoader("dicomweb",c.internal.loadImage),b.registerImageLoader("wadouri",c.internal.loadImage)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a||"YBR_ICT"===a}a.isColorImage=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var d=a.elements.x7fe00010;return d.encapsulatedPixelData?c.getEncapsulatedImageFrame(a,b):c.getUncompressedImageFrame(a,b)}function e(a,b,e){var f=d(b,e),g=b.string("x00020010");return c.decodeImageFrame(a,g,f)}function f(a,b,d){if(c.isJPEGBaseline8Bit(a)===!0)return c.decodeJPEGBaseline8Bit(a,h);a=e(a,b,d),h.height=a.rows,h.width=a.columns;var f=h.getContext("2d"),g=f.createImageData(a.columns,a.rows);return c.convertColorSpace(a,g)}function g(d,e,g,j){var k=c.getPixelSpacing(e),l=e.uint16("x00280010"),m=e.uint16("x00280011"),n=c.getRescaleSlopeAndIntercept(e),o=e.byteArray.length,p=c.getWindowWidthAndCenter(e);i=void 0;var q,r=a.Deferred(),s=c.getRawImageFrame(e);try{q=f(s,e,g)}catch(t){return r.reject(t),r.promise()}return q.then(function(a){function f(){return a.data}function g(){return a}function q(){if(i===d)return h;h.height=l,h.width=m;var b=h.getContext("2d");return b.putImageData(a,0,0),i=d,h}var t={imageId:d,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:p.windowCenter,windowWidth:p.windowWidth,render:b.renderColorImage,getPixelData:f,getImageData:g,getCanvas:q,rows:l,columns:m,height:l,width:m,color:!0,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:e,invert:!1,sizeInBytes:o,sharedCacheKey:j,decodeTimeInMS:s.decodeTimeInMS};(void 0===t.windowCenter||isNaN(t.windowCenter)||void 0===t.windowWidth||isNaN(t.windowWidth))&&(t.windowWidth=255,t.windowCenter=128),c.internal.options.imageCreated&&c.internal.options.imageCreated(t),r.resolve(t)},function(a){r.reject(a)}),r.promise()}var h=document.createElement("canvas"),i="";c.makeColorImage=g}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=a.string("x00080016");return"1.2.840.10008.5.1.4.1.1.12.1"!==b&&"1.2.840.10008.5.1.4.1.1.12.2.1\t"!==b}function e(a,b){var d=a.elements.x7fe00010;return d.encapsulatedPixelData?c.getEncapsulatedImageFrame(a,b):c.getUncompressedImageFrame(a,b)}function f(a,b,d){var f=e(b,d),g=b.string("x00020010");return c.decodeImageFrame(a,g,f)}function g(e,g,h,i){function j(){return k}var k,l,m=a.Deferred(),n=c.getPixelSpacing(g),o=g.uint16("x00280010"),p=g.uint16("x00280011"),q=c.getRescaleSlopeAndIntercept(g),r=g.byteArray.length,s=g.string("x00280004"),t="MONOCHROME1"===s,u=c.getWindowWidthAndCenter(g);try{l=c.getRawImageFrame(g),l=f(l,g,h),k=l.pixelData}catch(v){return m.reject(v),m.promise()}var w=c.getMinMax(k),x={imageId:e,minPixelValue:w.min,maxPixelValue:w.max,slope:q.slope,intercept:q.intercept,windowCenter:u.windowCenter,windowWidth:u.windowWidth,render:b.renderGrayscaleImage,getPixelData:j,rows:o,columns:p,height:o,width:p,color:!1,columnPixelSpacing:n.column,rowPixelSpacing:n.row,data:g,invert:t,sizeInBytes:r,sharedCacheKey:i,decodeTimeInMS:l.decodeTimeInMS},y=g.uint16("x00280103");if(g.elements.x00283000&&d(g)&&(x.modalityLUT=c.getLUT(y,g.elements.x00283000.items[0].dataSet)),g.elements.x00283010&&(y=0,x.minPixelValue*x.slope+x.intercept<0&&(y=1),x.voiLUT=c.getLUT(y,g.elements.x00283010.items[0].dataSet)),void 0===x.windowCenter||isNaN(x.windowCenter)||void 0===x.windowWidth||isNaN(x.windowWidth)){var z=x.maxPixelValue*x.slope+x.intercept,A=x.minPixelValue*x.slope+x.intercept;x.windowWidth=z-A,x.windowCenter=(z+A)/2}return c.internal.options.imageCreated&&c.internal.options.imageCreated(x),m.resolve(x),m.promise()}c.makeGrayscaleImage=g}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b,c=a.indexOf(":"),d=a.substring(c+1),e=d.indexOf("frame=");if(e!==-1){var f=d.substr(e+6);b=parseInt(f),d=d.substr(0,e-1)}return{scheme:a.substr(0,c),url:d,frame:b}}a.parseImageId=b}(cornerstoneWADOImageLoader),function(a){"use strict";a.version="0.13.3"}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d,e,f){f=f||{};var g=a.Deferred(),h=new XMLHttpRequest;return h.open("get",d,!0),h.responseType="arraybuffer",c.internal.options.beforeSend(h),Object.keys(f).forEach(function(a){h.setRequestHeader(a,f[a])}),h.onreadystatechange=function(a){4===h.readyState&&(200===h.status?g.resolve(h.response,h):g.reject(h))},h.onprogress=function(c){if(c.lengthComputable){var d=c.loaded,f=c.total,g=Math.round(d/f*100);a(b).trigger("CornerstoneImageLoadProgress",{imageId:e,loaded:d,total:f,percentComplete:g})}},h.send(),g.promise()}c.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader);