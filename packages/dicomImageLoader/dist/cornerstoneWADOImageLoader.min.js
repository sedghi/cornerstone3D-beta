/*! cornerstone-wado-image-loader - v0.6.1 - 2015-08-15 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(a){}},multiFrameCacheHack:{}}}),function(a){"use strict";function b(b,c,d){var e=b.uint16("x00280006");0===e?a.convertRGBColorByPixel(c,d):a.convertRGBColorByPlane(c,d)}function c(c,d,e){var f=d.uint16("x00280010"),g=d.uint16("x00280011"),h=d.string("x00280004");c.height=f,c.width=g;var i=c.getContext("2d"),j=i.createImageData(g,f),k=$.Deferred();try{if("RGB"===h)b(d,e,j.data);else if("YBR_RCT"===h)b(d,e,j.data);else if("YBR_ICT"===h)b(d,e,j.data);else if("PALETTE COLOR"===h)a.convertPALETTECOLOR(e,j.data,d);else if("YBR_FULL_422"===h)a.convertYBRFull(e,j.data);else{if("YBR_FULL"!==h)throw"no color space conversion for photometric interpretation "+h;a.convertYBRFull(e,j.data)}return k.resolve(j),k}catch(l){return k.reject(l),k}}a.convertColorSpace=c}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b,c){for(var d=c.int16("x00281101",0),e=c.int16("x00281101",1),f=c.int16("x00281101",2),g=8===f?0:8,h=c.byteArray.buffer,i=new Uint16Array(h,c.elements.x00281201.dataOffset,d),j=new Uint16Array(h,c.elements.x00281202.dataOffset,d),k=new Uint16Array(h,c.elements.x00281203.dataOffset,d),l=c.uint16("x00280010")*c.uint16("x00280011"),m=0,n=0,o=0;l>o;++o){var p=a[m++];e>p?p=0:p>e+d-1?p=d-1:p-=e,b[n++]=i[p]>>g,b[n++]=j[p]>>g,b[n++]=k[p]>>g,b[n++]=255}}a.convertPALETTECOLOR=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0;c>e;e++)for(var f=0,g=c,h=2*c,e=0;c>e;e++)b[d++]=a[f++],b[d++]=a[g++],b[d++]=a[h++],b[d++]=255}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}a.convertYBRFull=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b){a.internal.options=b}a.configure=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(b){var d,e=b.indexOf(":"),f=b.substring(e+1),g=f.indexOf("frame=");if(-1!==g){var h=f.substr(g+6);d=parseInt(h),f=f.substr(0,g-1)}if(void 0!==d&&c.internal.multiFrameCacheHack.hasOwnProperty(f)){var i=a.Deferred(),j=c.internal.multiFrameCacheHack[f],k=c.createImageObject(j,b,d);return k.then(function(a){i.resolve(a)},function(a){i.reject(a)}),i}return c.internal.xhrRequest(b,d,f)}b.loadImage=d,b.registerImageLoader("dicomweb",d),b.registerImageLoader("wadouri",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c,d){void 0===d&&(d=0);var e=b.string("x00280004"),f=a.isColorImage(e);return f===!1?a.makeGrayscaleImage(c,b,d):a.makeColorImage(c,b,d)}a.createImageObject=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.uint16("x00280010"),d=a.uint16("x00280011"),e=dicomParser.readEncapsulatedPixelData(a,a.elements.x7fe00010,b),f=new JpxImage;f.parse(e);var g=f.width,h=f.height;if(g!==d)throw"JPEG2000 decoder returned width of "+g+", when "+d+" is expected";if(h!==c)throw"JPEG2000 decoder returned width of "+h+", when "+c+" is expected";var i=f.tiles.length;if(1!==i)throw"JPEG2000 decoder returned a tileCount of "+i+", when 1 is expected";var j=f.tiles[0],k=j.items;return k}c.decodeJPEG2000=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.elements.x7fe00010,d=a.uint16("x00280010"),e=a.uint16("x00280011"),f=a.uint16("x00280100"),g=dicomParser.readEncapsulatedPixelData(a,c,b),h=new JpegImage;return h.parse(g),8===f?h.getData(e,d):16===f?h.getData16(e,d):void 0}c.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return c(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(a))))}function c(a){var b;try{return decodeURIComponent(escape(a))}catch(c){if(b=c,b instanceof URIError)return a;throw b}}function d(a,c,d){var e=$.Deferred(),f=c.uint16("x00280010"),g=c.uint16("x00280011");a.height=f,a.width=g;var h=dicomParser.readEncapsulatedPixelData(c,c.elements.x7fe00010,d),i=new Blob([h],{type:"image/jpeg"}),j=new FileReader;return void 0===j.readAsBinaryString?j.readAsArrayBuffer(i):j.readAsBinaryString(i),j.onload=function(){var c=new Image;c.onload=function(){var b=a.getContext("2d");b.drawImage(this,0,0);var c=b.getImageData(0,0,g,f);e.resolve(c)},c.onerror=function(a){e.reject()},void 0===j.readAsBinaryString?c.src="data:image/jpeg;base64,"+window.btoa(b(j.result)):c.src="data:image/jpeg;base64,"+window.btoa(j.result)},e}function e(a){var b=a.string("x00020010"),c=a.uint16("x00280100");return 8===c&&"1.2.840.10008.1.2.4.50"===b?!0:void 0}a.decodeJPEGBaseline8Bit=d,a.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader),function(a){function b(b,e){var f,g=b.uint16("x00280010"),h=b.uint16("x00280011"),i=b.uint16("x00280002"),j=b.elements.x7fe00010,k=dicomParser.readEncapsulatedPixelData(b,j,e),l=a.getPixelFormat(b),m=h*g;return 1===l?(f=new ArrayBuffer(m*i),c(k,f,m),new Uint8Array(f)):2===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Uint16Array(f)):3===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Int16Array(f)):void 0}function c(a,b,c){for(var d=new DataView(a.buffer,a.byteOffset),e=new DataView(a.buffer,a.byteOffset),f=new DataView(b),g=0,h=d.getInt32(0,!0),i=0;h>i;++i){g=i*c;var j=d.getInt32(4*(i+1),!0),k=d.getInt32(4*(i+2),!0);0===k&&(k=a.length);for(var l=c*h;k>j;){var m=e.getInt8(j++);if(m>=0&&127>=m)for(var n=0;m+1>n&&l>g;++n)f.setInt8(g++,e.getInt8(j++));else if(-1>=m&&m>=-127)for(var o=e.getInt8(j++),p=0;-m+1>p&&l>g;++p)f.setInt8(g++,o)}}}function d(a,b,c){for(var d=new DataView(a.buffer,a.byteOffset),e=new DataView(a.buffer,a.byteOffset),f=new DataView(b),g=d.getInt32(0,!0),h=0;g>h;++h){var i=0,j=0===h?1:0,k=d.getInt32(4*(h+1),!0),l=d.getInt32(4*(h+2),!0);for(0===l&&(l=a.length);l>k;){var m=e.getInt8(k++);if(m>=0&&127>=m)for(var n=0;m+1>n&&c>i;++n)f.setInt8(2*i+j,e.getInt8(k++)),i++;else if(-1>=m&&m>=-127)for(var o=e.getInt8(k++),p=0;-m+1>p&&c>i;++p)f.setInt8(2*i+j,o),i++}}}a.decodeRLE=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){var d=b.string("x00020010");if("1.2.840.10008.1.2"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.1"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.4.90"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.4.91"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.5"===d)return a.decodeRLE(b,c);if("1.2.840.10008.1.2.4.50"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.51"===d)return a.decodeJPEGBaseline(b,c);throw"no decoder for transfer syntax "+d}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var d=c.getPixelFormat(a),e=a.elements.x7fe00010,f=a.uint16("x00280010"),g=a.uint16("x00280011"),h=a.uint16("x00280002"),i=e.dataOffset,j=g*f*h,k=0;return 1===d?(k=i+b*j,new Uint8Array(a.byteArray.buffer,k,j)):2===d?(k=i+b*j*2,new Uint16Array(a.byteArray.buffer,k,j)):3===d?(k=i+b*j*2,new Int16Array(a.byteArray.buffer,k,j)):void 0}c.extractUncompressedPixels=d}($,cornerstone,cornerstoneWADOImageLoader);var ColorSpace={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},JpegImage=function(){"use strict";function a(){}function b(a,b){for(var c,d,e=0,f=[],g=16;g>0&&!a[g-1];)g--;f.push({children:[],index:0});var h,i=f[0];for(c=0;g>c;c++){for(d=0;d<a[c];d++){for(i=f.pop(),i.children[i.index]=b[e];i.index>0;)i=f.pop();for(i.index++,f.push(i);f.length<=c;)f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h;e++}g>c+1&&(f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h)}return f[0].children}function c(a,b,c){return 64*((a.blocksPerLine+1)*b+c)}function d(a,b,d,e,f,g,i,j,k){function l(){if(H>0)return H--,G>>H&1;if(G=a[b++],255==G){var c=a[b++];if(c)throw"unexpected marker: "+(G<<8|c).toString(16)}return H=7,G>>>7}function m(a){for(var b,c=a;null!==(b=l());){if(c=c[b],"number"==typeof c)return c;if("object"!=typeof c)throw"invalid huffman sequence"}return null}function n(a){for(var b=0;a>0;){var c=l();if(null===c)return;b=b<<1|c,a--}return b}function o(a){var b=n(a);return b>=1<<a-1?b:b+(-1<<a)+1}function p(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c);a.blockData[b]=a.pred+=d;for(var e=1;64>e;){var f=m(a.huffmanTableAC),g=15&f,i=f>>4;if(0!==g){e+=i;var j=h[e];a.blockData[b+j]=o(g),e++}else{if(15>i)break;e+=16}}}function q(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c)<<k;a.blockData[b]=a.pred+=d}function r(a,b){a.blockData[b]|=l()<<k}function s(a,b){if(I>0)return void I--;for(var c=g,d=i;d>=c;){var e=m(a.huffmanTableAC),f=15&e,j=e>>4;if(0!==f){c+=j;var l=h[c];a.blockData[b+l]=o(f)*(1<<k),c++}else{if(15>j){I=n(j)+(1<<j)-1;break}c+=16}}}function t(a,b){for(var c=g,d=i,e=0;d>=c;){var f=h[c];switch(J){case 0:var j=m(a.huffmanTableAC),p=15&j;if(e=j>>4,0===p)15>e?(I=n(e)+(1<<e),J=4):(e=16,J=1);else{if(1!==p)throw"invalid ACn encoding";w=o(p),J=e?2:3}continue;case 1:case 2:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(e--,0===e&&(J=2==J?3:0));break;case 3:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(a.blockData[b+f]=w<<k,J=0);break;case 4:a.blockData[b+f]&&(a.blockData[b+f]+=l()<<k)}c++}4===J&&(I--,0===I&&(J=0))}function u(a,b,d,e,f){var g=d/D|0,h=d%D,i=g*a.v+e,j=h*a.h+f,k=c(a,i,j);b(a,k)}function v(a,b,d){var e=d/a.blocksPerLine|0,f=d%a.blocksPerLine,g=c(a,e,f);b(a,g)}var w,x,y,z,A,B,C,D=(d.precision,d.samplesPerLine,d.scanLines,d.mcusPerLine),E=d.progressive,F=(d.maxH,d.maxV,b),G=0,H=0,I=0,J=0,K=e.length;C=E?0===g?0===j?q:r:0===j?s:t:p;var L,M,N=0;M=1==K?e[0].blocksPerLine*e[0].blocksPerColumn:D*d.mcusPerColumn,f||(f=M);for(var O,P;M>N;){for(y=0;K>y;y++)e[y].pred=0;if(I=0,1==K)for(x=e[0],B=0;f>B;B++)v(x,C,N),N++;else for(B=0;f>B;B++){for(y=0;K>y;y++)for(x=e[y],O=x.h,P=x.v,z=0;P>z;z++)for(A=0;O>A;A++)u(x,C,N,z,A);N++}if(H=0,L=a[b]<<8|a[b+1],65280>=L)throw"marker was not found";if(!(L>=65488&&65495>=L))break;b+=2}return b-F}function e(a,b,c){var d,e,f,g,h,q,r,s,t,u,v=a.quantizationTable;for(u=0;64>u;u++)c[u]=a.blockData[b+u]*v[u];for(u=0;8>u;++u){var w=8*u;0!==c[1+w]||0!==c[2+w]||0!==c[3+w]||0!==c[4+w]||0!==c[5+w]||0!==c[6+w]||0!==c[7+w]?(d=o*c[0+w]+128>>8,e=o*c[4+w]+128>>8,f=c[2+w],g=c[6+w],h=p*(c[1+w]-c[7+w])+128>>8,s=p*(c[1+w]+c[7+w])+128>>8,q=c[3+w]<<4,r=c[5+w]<<4,t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+128>>8,f=f*m-g*n+128>>8,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+w]=d+s,c[7+w]=d-s,c[1+w]=e+r,c[6+w]=e-r,c[2+w]=f+q,c[5+w]=f-q,c[3+w]=g+h,c[4+w]=g-h):(t=o*c[0+w]+512>>10,c[0+w]=t,c[1+w]=t,c[2+w]=t,c[3+w]=t,c[4+w]=t,c[5+w]=t,c[6+w]=t,c[7+w]=t)}for(u=0;8>u;++u){var x=u;0!==c[8+x]||0!==c[16+x]||0!==c[24+x]||0!==c[32+x]||0!==c[40+x]||0!==c[48+x]||0!==c[56+x]?(d=o*c[0+x]+2048>>12,e=o*c[32+x]+2048>>12,f=c[16+x],g=c[48+x],h=p*(c[8+x]-c[56+x])+2048>>12,s=p*(c[8+x]+c[56+x])+2048>>12,q=c[24+x],r=c[40+x],t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+2048>>12,f=f*m-g*n+2048>>12,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+x]=d+s,c[56+x]=d-s,c[8+x]=e+r,c[48+x]=e-r,c[16+x]=f+q,c[40+x]=f-q,c[24+x]=g+h,c[32+x]=g-h):(t=o*c[u+0]+8192>>14,c[0+x]=t,c[8+x]=t,c[16+x]=t,c[24+x]=t,c[32+x]=t,c[40+x]=t,c[48+x]=t,c[56+x]=t)}for(u=0;64>u;++u){var y=b+u,z=c[u];z=z<=-2056/a.bitConversion?0:z>=2024/a.bitConversion?255/a.bitConversion:z+2056/a.bitConversion>>4,a.blockData[y]=z}}function f(a,b){for(var d=b.blocksPerLine,f=b.blocksPerColumn,g=new Int32Array(64),h=0;f>h;h++)for(var i=0;d>i;i++){var j=c(b,h,i);e(b,j,g)}return b.blockData}function g(a){return 0>=a?0:a>=255?255:0|a}var h=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,j=799,k=3406,l=2276,m=1567,n=3784,o=5793,p=2896;return a.prototype={load:function(a){var b=function(a){this.parse(a),this.onload&&this.onload()}.bind(this);if(a.indexOf("data:")>-1){for(var c=a.indexOf("base64,")+7,d=atob(a.substring(c)),e=new Uint8Array(d.length),f=d.length-1;f>=0;f--)e[f]=d.charCodeAt(f);b(d)}else{var g=new XMLHttpRequest;g.open("GET",a,!0),g.responseType="arraybuffer",g.onload=function(){var a=new Uint8Array(g.response);b(a)}.bind(this),g.send(null)}},parse:function(a){function c(){var b=a[k]<<8|a[k+1];return k+=2,b}function e(){var b=c(),d=a.subarray(k,k+b-2);return k+=d.length,d}function g(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){N=a.components[d];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*N.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/8)*N.v/a.maxV),g=b*N.h,h=c*N.v,i=64*h*(g+1);N.blockData=new Int16Array(i),N.blocksPerLine=e,N.blocksPerColumn=f}a.mcusPerLine=b,a.mcusPerColumn=c}var i,j,k=0,l=(a.length,null),m=null,n=[],o=[],p=[],q=c();if(65496!=q)throw"SOI not found";for(q=c();65497!=q;){var r,s,t;switch(q){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var u=e();65504===q&&74===u[0]&&70===u[1]&&73===u[2]&&70===u[3]&&0===u[4]&&(l={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])}),65518===q&&65===u[0]&&100===u[1]&&111===u[2]&&98===u[3]&&101===u[4]&&0===u[5]&&(m={version:u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:for(var v=c(),w=v+k-2;w>k;){var x=a[k++],y=new Int32Array(64);if(x>>4===0)for(s=0;64>s;s++){var z=h[s];y[z]=a[k++]}else{if(x>>4!==1)throw"DQT: invalid table spec";for(s=0;64>s;s++){var A=h[s];y[A]=c()}}n[15&x]=y}break;case 65472:case 65473:case 65474:if(i)throw"Only single frame JPEGs supported";c(),i={},i.extended=65473===q,i.progressive=65474===q,i.precision=a[k++],i.scanLines=c(),i.samplesPerLine=c(),i.components=[],i.componentIds={};var B,C=a[k++],D=0,E=0;for(r=0;C>r;r++){B=a[k];var F=a[k+1]>>4,G=15&a[k+1];F>D&&(D=F),G>E&&(E=G);var H=a[k+2];t=i.components.push({h:F,v:G,quantizationTable:n[H],quantizationTableId:H,bitConversion:255/((1<<i.precision)-1)}),i.componentIds[B]=t-1,k+=3}i.maxH=D,i.maxV=E,g(i);break;case 65476:var I=c();for(r=2;I>r;){var J=a[k++],K=new Uint8Array(16),L=0;for(s=0;16>s;s++,k++)L+=K[s]=a[k];var M=new Uint8Array(L);for(s=0;L>s;s++,k++)M[s]=a[k];r+=17+L,(J>>4===0?p:o)[15&J]=b(K,M)}break;case 65501:c(),j=c();break;case 65498:var N,O=(c(),a[k++]),P=[];for(r=0;O>r;r++){var Q=i.componentIds[a[k++]];N=i.components[Q];var R=a[k++];N.huffmanTableDC=p[R>>4],N.huffmanTableAC=o[15&R],P.push(N)}var S=a[k++],T=a[k++],U=a[k++],V=d(a,k,i,P,j,S,T,U>>4,15&U);k+=V;break;default:if(255==a[k-3]&&a[k-2]>=192&&a[k-2]<=254){k-=3;break}throw"unknown JPEG marker "+q.toString(16)}q=c()}switch(this.width=i.samplesPerLine,this.height=i.scanLines,this.jfif=l,this.adobe=m,this.components=[],i.components.length){case 1:this.colorspace=ColorSpace.Grayscale;break;case 3:this.adobe?this.colorspace=ColorSpace.AdobeRGB:this.colorspace=ColorSpace.RGB;break;case 4:this.colorspace=ColorSpace.CYMK;break;default:this.colorspace=ColorSpace.Unknown}for(var r=0;r<i.components.length;r++){var N=i.components[r];N.quantizationTable||null===N.quantizationTableId||(N.quantizationTable=n[N.quantizationTableId]),this.components.push({output:f(i,N),scaleX:N.h/i.maxH,scaleY:N.v/i.maxV,blocksPerLine:N.blocksPerLine,blocksPerColumn:N.blocksPerColumn,bitConversion:N.bitConversion})}},getData16:function(a,b){if(1!==this.components.length)throw"Unsupported color mode";var d,e,f,g,h,i,j=this.width/a,k=this.height/b,l=0,m=this.components.length,n=a*b*m,o=new Uint16Array(n),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(i=0;m>i;i++){d=this.components[i];for(var q,r,s=d.blocksPerLine,t=d.blocksPerColumn,u=s<<3,v=0,w=0;t>w;w++)for(var x=w<<3,y=0;s>y;y++){var z=c(d,w,y),l=0,A=y<<3;for(q=0;8>q;q++){var v=(x+q)*u;for(r=0;8>r;r++)p[v+A+r]=d.output[z+l++]}}e=d.scaleX*j,f=d.scaleY*k,l=i;var B,C,D;for(h=0;b>h;h++)for(g=0;a>g;g++)C=0|h*f,B=0|g*e,D=C*u+B,o[l]=p[D],l+=m}return o},getData:function(a,b){var d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t=this.width/a,u=this.height/b,v=0,w=this.components.length,x=a*b*w,y=new Uint8Array(x),z=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(j=0;w>j;j++){d=this.components[j];for(var A,B,C=d.blocksPerLine,D=d.blocksPerColumn,E=C<<3,F=0,G=0;D>G;G++)for(var H=G<<3,I=0;C>I;I++){var J=c(d,G,I),v=0,K=I<<3;for(A=0;8>A;A++){var F=(H+A)*E;for(B=0;8>B;B++)z[F+K+B]=d.output[J+v++]*d.bitConversion}}e=d.scaleX*t,f=d.scaleY*u,v=j;var L,M,N;for(i=0;b>i;i++)for(h=0;a>h;h++)M=0|i*f,L=0|h*e,N=M*E+L,y[v]=z[N],v+=w}switch(w){case 1:case 2:break;case 3:if(s=!0,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;x>j;j+=w)k=y[j],l=y[j+1],m=y[j+2],p=g(k-179.456+1.402*m),q=g(k+135.459-.344*l-.714*m),r=g(k-226.816+1.772*l),y[j]=p,y[j+1]=q,y[j+2]=r;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(s=!1,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;x>j;j+=w)k=y[j],l=y[j+1],m=y[j+2],n=g(434.456-k-1.402*m),o=g(119.541-k+.344*l+.714*m),k=g(481.816-k-1.772*l),y[j]=n,y[j+1]=o,y[j+2]=k;break;default:throw"Unsupported color mode"}return y}},a}();!function(a){"use strict";function b(a){var b=a.uint16("x00280103"),c=a.uint16("x00280100");return 0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}a.getPixelFormat=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.string("x00280030");if(b&&b.length>0){var c=b.split("\\");return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}a.getPixelSpacing=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={intercept:0,slope:1},c=a.floatString("x00281052"),d=a.floatString("x00281053");return c&&(b.intercept=c),d&&(b.slope=d),b}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0},c=a.floatString("x00281050"),d=a.floatString("x00281051");return c&&(b.windowCenter=c),d&&(b.windowWidth=d),b}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a||"YBR_ICT"===a?!0:!1}a.isColorImage=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if(c.isJPEGBaseline8Bit(a)===!0)return c.decodeJPEGBaseline8Bit(f,a,b);var d=c.decodeTransferSyntax(a,b);return c.convertColorSpace(f,a,d)}function e(e,h,i){var j=c.getPixelSpacing(h),k=h.uint16("x00280010"),l=h.uint16("x00280011"),m=c.getRescaleSlopeAndIntercept(h),n=4,o=k*l,p=o*n,q=c.getWindowWidthAndCenter(h);g=void 0;var r,s=a.Deferred();try{r=d(h,i)}catch(t){return s.reject(t),s}return r.then(function(a){function c(){return a.data}function d(){return a}function i(){if(g===e)return f;f.height=k,f.width=l;var b=f.getContext("2d");return b.putImageData(a,0,0),g=e,f}var n={imageId:e,minPixelValue:0,maxPixelValue:255,slope:m.slope,intercept:m.intercept,windowCenter:q.windowCenter,windowWidth:q.windowWidth,render:b.renderColorImage,getPixelData:c,getImageData:d,getCanvas:i,rows:k,columns:l,height:k,width:l,color:!0,columnPixelSpacing:j.column,rowPixelSpacing:j.row,data:h,invert:!1,sizeInBytes:p};void 0===n.windowCenter&&(n.windowWidth=255,n.windowCenter=128),s.resolve(n)},function(a){s.reject(a)}),s}var f=document.createElement("canvas"),g="";c.makeColorImage=e}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=c.getPixelFormat(a);if(1===b)return 1;if(2===b||3===b)return 2;throw"unknown pixel format"}function e(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;d>f;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}function f(f,g,h){function i(){return q}var j,k=a.Deferred(),l=c.getPixelSpacing(g),m=g.uint16("x00280010"),n=g.uint16("x00280011"),o=c.getRescaleSlopeAndIntercept(g);try{j=d(g)}catch(p){return k.reject(p),k}var q,r=m*n,s=r*j,t=g.string("x00280004"),u="MONOCHROME1"===t,v=c.getWindowWidthAndCenter(g);try{q=c.decodeTransferSyntax(g,h)}catch(w){return k.reject(w),k}var x=e(q),y={imageId:f,minPixelValue:x.min,maxPixelValue:x.max,slope:o.slope,intercept:o.intercept,windowCenter:v.windowCenter,windowWidth:v.windowWidth,render:b.renderGrayscaleImage,getPixelData:i,rows:m,columns:n,height:m,width:n,color:!1,columnPixelSpacing:l.column,rowPixelSpacing:l.row,data:g,invert:u,sizeInBytes:s};if(void 0===y.windowCenter){var z=y.maxPixelValue*y.slope+y.intercept,A=y.minPixelValue*y.slope+y.intercept;y.windowWidth=z-A,y.windowCenter=(z+A)/2}return k.resolve(y),k}c.makeGrayscaleImage=f}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";a.version="0.6.1"}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d,e,f){var g=a.Deferred(),h=new XMLHttpRequest;return h.responseType="arraybuffer",h.open("get",f,!0),c.internal.options.beforeSend(h),h.onreadystatechange=function(a){if(4===h.readyState)if(200===h.status){var b=h.response,i=new Uint8Array(b),j=dicomParser.parseDicom(i);void 0!==e&&(c.internal.multiFrameCacheHack[f]=j);var k=c.createImageObject(j,d,e);k.then(function(a){g.resolve(a)},function(a){g.reject(a)})}else g.reject(h.response)},h.onprogress=function(c){if(c.lengthComputable){var e=c.loaded,f=c.total,g=Math.round(e/f*100);a(b).trigger("CornerstoneImageLoadProgress",{imageId:d,loaded:e,total:f,percentComplete:g})}},h.send(),g}c.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader);