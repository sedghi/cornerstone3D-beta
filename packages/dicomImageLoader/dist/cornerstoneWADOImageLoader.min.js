/*! cornerstoneWADOImageLoader - v0.4.2 - 2014-09-08 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
var cornerstoneWADOImageLoader=function(a,b,c){"use strict";function d(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a?!0:!1}function e(a,b,e){void 0===e&&(e=0);var f=a.string("x00280004"),g=d(f);return g===!1?c.makeGrayscaleImage(b,a,a.byteArray,f,e):c.makeColorImage(b,a,a.byteArray,f,e)}function f(b){var c=a.Deferred(),d=b;d=d.substring(9);var f,h=d.indexOf("frame=");if(-1!==h){var i=d.substr(h+6);f=parseInt(i),d=d.substr(0,h-1)}if(void 0!==f&&g.hasOwnProperty(d)){var j=g[d],k=e(j,b,f);return k.then(function(a){c.resolve(a)},function(){c.reject()}),c}var l=new XMLHttpRequest;return l.open("get",d,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){var a=l.response,h=new Uint8Array(a),i=dicomParser.parseDicom(h);void 0!==f&&(g[d]=i);var j=e(i,b,f);j.then(function(a){c.resolve(a)},function(){c.reject()})}else c.reject()},l.send(),c}void 0===c&&(c={});var g={};return b.registerImageLoader("dicomweb",f),c}($,cornerstone,cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}return void 0===a&&(a={}),a.decodeRGB=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}return void 0===a&&(a={}),a.decodeYBRFull=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a){var b=a.string("x00280030");if(b&&b.length>0){var c=b.split("\\");return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}return void 0===a&&(a={}),a.getPixelSpacing=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a){var b={intercept:0,slope:1},c=a.floatString("x00281052"),d=a.floatString("x00281053");return c&&(b.intercept=c),d&&(b.slope=d),b}return void 0===a&&(a={}),a.getRescaleSlopeAndIntercept=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0},c=a.floatString("x00281050"),d=a.floatString("x00281051");return c&&(b.windowCenter=c),d&&(b.windowWidth=d),b}return void 0===a&&(a={}),a.getWindowWidthAndCenter=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a,b,c){"use strict";function d(b,d,e,g,h,i){f.height=h,f.width=g;var j,k=b.elements.x7fe00010,l=k.dataOffset,m=b.string("x00020010"),n=g*h*3,o=l+i*n,p=f.getContext("2d"),q=p.createImageData(g,h),r=a.Deferred();if("RGB"===e)return j=new Uint8Array(d.buffer,o,n),c.decodeRGB(j,q.data),r.resolve(q),r;if("YBR_FULL"===e)return j=new Uint8Array(d.buffer,o,n),c.decodeYBRFull(j,q.data),r.resolve(q),r;if("YBR_FULL_422"===e&&"1.2.840.10008.1.2.4.50"===m){j=dicomParser.readEncapsulatedPixelData(b,i);var s=new Blob([j],{type:"image/jpeg"}),t=new FileReader;return t.readAsBinaryString(s),t.onload=function(){var a=new Image;a.onload=function(){p.drawImage(this,0,0),q=p.getImageData(0,0,g,h),r.resolve(q)},a.onerror=function(){r.reject()},a.src="data:image/jpeg;base64,"+window.btoa(t.result)},r}throw"no codec for "+e}function e(e,h,i,j,k){var l=c.getPixelSpacing(h),m=h.uint16("x00280010"),n=h.uint16("x00280011"),o=c.getRescaleSlopeAndIntercept(h),p=4,q=m*n,r=q*p,s=c.getWindowWidthAndCenter(h),t=a.Deferred(),u=d(h,i,j,n,m,k);return u.then(function(a){function c(){return a.data}function d(){return a}function i(){if(g===e)return f;f.height=m,f.width=n;var b=f.getContext("2d");return b.putImageData(a,0,0),g=e,f}var j={imageId:e,minPixelValue:0,maxPixelValue:255,slope:o.slope,intercept:o.intercept,windowCenter:s.windowCenter,windowWidth:s.windowWidth,render:b.renderColorImage,getPixelData:c,getImageData:d,getCanvas:i,rows:m,columns:n,height:m,width:n,color:!0,columnPixelSpacing:l.column,rowPixelSpacing:l.row,data:h,invert:!1,sizeInBytes:r};void 0===j.windowCenter&&(j.windowWidth=255,j.windowCenter=128),t.resolve(j)},function(){t.reject()}),t}void 0===c&&(c={});var f=document.createElement("canvas"),g="";return c.makeColorImage=e,c}($,cornerstone,cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a,b,c){"use strict";function d(a){{var b=a.uint16("x00280103"),c=a.uint16("x00280100");a.string("x00280004")}return 0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}function e(a,b,c,e,f){var g=d(a),h=a.elements.x7fe00010,i=h.dataOffset,j=c*e,k=0;return 1===g?(k=i+f*j,new Uint8Array(b.buffer,k,j)):2===g?(k=i+f*j*2,new Uint16Array(b.buffer,k,j)):3===g?(k=i+f*j*2,new Int16Array(b.buffer,k,j)):void 0}function f(a){var b=d(a);if(1===b)return 1;if(2===b||3===b)return 2;throw"unknown pixel format"}function g(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;d>f;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}function h(d,h,i,j,k){function l(){return v}var m=c.getPixelSpacing(h),n=h.uint16("x00280010"),o=h.uint16("x00280011"),p=c.getRescaleSlopeAndIntercept(h),q=f(h),r=n*o,s=r*q,t="MONOCHROME1"===j,u=c.getWindowWidthAndCenter(h),v=e(h,i,o,n,k),w=g(v),x={imageId:d,minPixelValue:w.min,maxPixelValue:w.max,slope:p.slope,intercept:p.intercept,windowCenter:u.windowCenter,windowWidth:u.windowWidth,render:b.renderGrayscaleImage,getPixelData:l,rows:n,columns:o,height:n,width:o,color:!1,columnPixelSpacing:m.column,rowPixelSpacing:m.row,data:h,invert:t,sizeInBytes:s};if(void 0===x.windowCenter){var y=x.maxPixelValue*x.slope+x.intercept,z=x.minPixelValue*x.slope+x.intercept;x.windowWidth=y-z,x.windowCenter=(y+z)/2}var A=a.Deferred();return A.resolve(x),A}return void 0===c&&(c={}),c.makeGrayscaleImage=h,c}($,cornerstone,cornerstoneWADOImageLoader);