/*! cornerstone-wado-image-loader - v0.14.0 - 2016-06-08 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(a){},imageCreated:function(a){}}}}),function(a,b,c){"use strict";function d(a){a.decache=function(){var b=c.parseImageId(a.imageId);c.dataSetCacheManager.unload(b.url)}}function e(b,e,f,g){var h=a.Deferred();return b.then(function(a){var b=c.createImageObject(a,e,f,g);b.then(function(a){d(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}function f(a){return"dicomweb"===a||"wadouri"===a?c.internal.xhrRequest:"dicomfile"===a?c.internal.loadFileRequest:void 0}function g(b){var g=c.parseImageId(b),h=f(g.scheme);if(c.dataSetCacheManager.isLoaded(g.url))return e(c.dataSetCacheManager.load(g.url,h),b,g.frame,g.url);if(void 0!==g.frame)return e(c.dataSetCacheManager.load(g.url,h),b,g.frame,g.url);var i=a.Deferred(),j=h(g.url,b);return j.then(function(a){var e=c.createImageObject(a,b,g.frame);e.then(function(a){d(a),i.resolve(a)},function(a){i.reject(a)})},function(a){i.reject(a)}),i}c.internal.loadImage=g}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c,d){var e=b.uint16("x00280006");0===e?a.convertRGBColorByPixel(c,d):a.convertRGBColorByPlane(c,d)}function c(b,c,d){var e=b.uint16("x00280006");0===e?a.convertYBRFullByPixel(c,d):a.convertYBRFullByPlane(c,d)}function d(d,e,f){var g=e.uint16("x00280010"),h=e.uint16("x00280011"),i=e.string("x00280004");d.height=g,d.width=h;var j=d.getContext("2d"),k=j.createImageData(h,g),l=$.Deferred();try{if("RGB"===i)b(e,f,k.data);else if("YBR_RCT"===i)b(e,f,k.data);else if("YBR_ICT"===i)b(e,f,k.data);else if("PALETTE COLOR"===i)a.convertPALETTECOLOR(f,k.data,e);else if("YBR_FULL_422"===i)b(e,f,k.data);else{if("YBR_FULL"!==i)throw"no color space conversion for photometric interpretation "+i;c(e,f,k.data)}return l.resolve(k),l.promise()}catch(m){return l.reject(m),l.promise()}}a.convertColorSpace=d}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b,c){var d=c.int16("x00281101",0);d||(d=65536);for(var e=c.int16("x00281101",1),f=c.int16("x00281101",2),g=8===f?0:8,h=c.byteArray.buffer,i=new Uint16Array(h,c.elements.x00281201.dataOffset,d),j=new Uint16Array(h,c.elements.x00281202.dataOffset,d),k=new Uint16Array(h,c.elements.x00281203.dataOffset,d),l=c.uint16("x00280010")*c.uint16("x00280011"),m=0,n=0,o=0;l>o;++o){var p=a[m++];e>p?p=0:p>e+d-1?p=d-1:p-=e,b[n++]=i[p]>>g,b[n++]=j[p]>>g,b[n++]=k[p]>>g,b[n++]=255}}a.convertPALETTECOLOR=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=c,g=2*c,h=0;c>h;h++)b[d++]=a[e++],b[d++]=a[f++],b[d++]=a[g++],b[d++]=255}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}a.convertYBRFullByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=c,g=2*c,h=0;c>h;h++){var i=a[e++],j=a[f++],k=a[g++];b[d++]=i+1.402*(k-128),b[d++]=i-.34414*(j-128)-.71414*(k-128),b[d++]=i+1.772*(j-128),b[d++]=255}}a.convertYBRFullByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b){a.internal.options=b}a.configure=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c,d,e){void 0===d&&(d=0);var f=b.string("x00280004"),g=a.isColorImage(f);return g===!1?a.makeGrayscaleImage(c,b,d,e):a.makeColorImage(c,b,d,e)}a.createImageObject=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return void 0!==f[a]}function c(a,b){if(f[a]){var c=$.Deferred();return f[a].cacheCount++,c.resolve(f[a].dataSet),c}if(g[a])return g[a];var d=b(a);return g[a]=d,d.then(function(b){f[a]={dataSet:b,cacheCount:1},delete g[a]},function(){}).always(function(){delete g[a]}),d}function d(a){f[a]&&(f[a].cacheCount--,0===f[a].cacheCount&&delete f[a])}function e(){f={},g={}}var f={},g={};a.dataSetCacheManager={isLoaded:b,load:c,unload:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var d=a.uint16("x00280010"),e=a.uint16("x00280011"),f=c.getEncodedImageFrame(a,b),g=new JpxImage;g.parse(f);var h=g.width,i=g.height;if(h!==e)throw"JPEG2000 decoder returned width of "+h+", when "+e+" is expected";if(i!==d)throw"JPEG2000 decoder returned width of "+i+", when "+d+" is expected";var j=g.tiles.length;if(1!==j)throw"JPEG2000 decoder returned a tileCount of "+j+", when 1 is expected";var k=g.tiles[0],l=k.items;return l}function e(a,b,c){var d=h._malloc(a.length);h.writeArrayToMemory(a,d);var e=h._malloc(4),f=h._malloc(4),g=h._malloc(4),i=h._malloc(4),j=h._malloc(4),k=Date.now(),l=h.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[d,a.length,e,f,g,i,j]);if(0!==l)return console.log("[opj_decode] decoding failed!"),h._free(d),h._free(h.getValue(e,"*")),h._free(g),h._free(i),h._free(f),void h._free(j);var m=h.getValue(e,"*"),n={length:h.getValue(f,"i32"),sx:h.getValue(g,"i32"),sy:h.getValue(i,"i32"),nbChannels:h.getValue(j,"i32"),perf_timetodecode:void 0,pixelData:void 0},o=n.sx*n.sy*n.nbChannels,p=new Uint32Array(h.HEAP32.buffer,m,o);if(1===b)if(Uint8Array.from)n.pixelData=Uint8Array.from(p);else{n.pixelData=new Uint8Array(o);for(var q=0;o>q;q++)n.pixelData[q]=p[q]}else if(c)if(Int16Array.from)n.pixelData=Int16Array.from(p);else{n.pixelData=new Int16Array(o);for(var q=0;o>q;q++)n.pixelData[q]=p[q]}else if(Uint16Array.from)n.pixelData=Uint16Array.from(p);else{n.pixelData=new Uint16Array(o);for(var q=0;o>q;q++)n.pixelData[q]=p[q]}var r=Date.now();return n.perf_timetodecode=r-k,h._free(d),h._free(e),h._free(m),h._free(f),h._free(g),h._free(i),h._free(j),n}function f(a,b){var d=a.uint16("x00280010"),f=a.uint16("x00280011"),g=c.getEncodedImageFrame(a,b),h=a.uint16("x00280100")<=8?1:2,i=a.uint16("x00280103")?!0:!1,j=e(g,h,i),k=j.sx,l=j.sy;if(k!==f)throw"JPEG2000 decoder returned width of "+k+", when "+f+" is expected";if(l!==d)throw"JPEG2000 decoder returned width of "+l+", when "+d+" is expected";return j.pixelData}function g(a,b){if("undefined"==typeof OpenJPEG&&"undefined"==typeof JpxImage)throw"No JPEG2000 decoder loaded";if("undefined"!=typeof OpenJPEG){if(!h&&(h=OpenJPEG(),!h||!h._jp2_decode))throw"OpenJPEG failed to initialize";return f(a,b)}return"undefined"!=typeof JpxImage?d(a,b):void 0}var h;c.decodeJPEG2000=g}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if("undefined"==typeof JpegImage)throw"No JPEG Baseline decoder loaded";var d=a.uint16("x00280010"),e=a.uint16("x00280011"),f=a.uint16("x00280100"),g=c.getEncodedImageFrame(a,b),h=new JpegImage;return h.parse(g),8===f?h.getData(e,d):16===f?h.getData16(e,d):void 0}c.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return c(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(a))))}function c(a){var b;try{return decodeURIComponent(escape(a))}catch(c){if(b=c,b instanceof URIError)return a;throw b}}function d(c,d,e){var f=$.Deferred(),g=d.uint16("x00280010"),h=d.uint16("x00280011");c.height=g,c.width=h;var i=a.getEncodedImageFrame(d,e),j=new Blob([i],{type:"image/jpeg"}),k=new FileReader;return void 0===k.readAsBinaryString?k.readAsArrayBuffer(j):k.readAsBinaryString(j),k.onload=function(){var a=new Image;a.onload=function(){var a=c.getContext("2d");a.drawImage(this,0,0);var b=a.getImageData(0,0,h,g);f.resolve(b)},a.onerror=function(a){f.reject(a)},void 0===k.readAsBinaryString?a.src="data:image/jpeg;base64,"+window.btoa(b(k.result)):a.src="data:image/jpeg;base64,"+window.btoa(k.result)},f.promise()}function e(a){var b=a.string("x00020010"),c=a.uint16("x00280100");return 8===c&&"1.2.840.10008.1.2.4.50"===b?!0:void 0}a.decodeJPEGBaseline8Bit=d,a.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader),function(a){function b(a,b){var c=d._malloc(a.length);d.writeArrayToMemory(a,c);var e=d._malloc(4),f=d._malloc(4),g=d._malloc(4),h=d._malloc(4),i=d._malloc(4),j=d._malloc(4),k=d._malloc(4),l=d._malloc(4),m=d._malloc(4),n=d.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[c,a.length,e,f,g,h,i,j,l,k,m]),o={result:n,width:d.getValue(g,"i32"),height:d.getValue(h,"i32"),bitsPerSample:d.getValue(i,"i32"),stride:d.getValue(j,"i32"),components:d.getValue(l,"i32"),allowedLossyError:d.getValue(k,"i32"),interleaveMode:d.getValue(m,"i32"),pixelData:void 0},p=d.getValue(e,"*");if(o.bitsPerSample<=8){o.pixelData=new Uint8Array(o.width*o.height*o.components);var q=new Uint8Array(d.HEAP8.buffer,p,o.pixelData.length);o.pixelData.set(q)}else if(b){o.pixelData=new Int16Array(o.width*o.height*o.components);var r=new Int16Array(d.HEAP16.buffer,p,o.pixelData.length);o.pixelData.set(r)}else{o.pixelData=new Uint16Array(o.width*o.height*o.components);var r=new Uint16Array(d.HEAP16.buffer,p,o.pixelData.length);o.pixelData.set(r)}return d._free(c),d._free(p),d._free(e),d._free(f),d._free(g),d._free(h),d._free(i),d._free(j),d._free(l),d._free(m),o}function c(c,e){if("undefined"==typeof CharLS)throw"No JPEG-LS decoder loaded";if(!d&&(d=CharLS(),!d||!d._jpegls_decode))throw"JPEG-LS failed to initialize";var f=c.uint16("x00280010"),g=c.uint16("x00280011"),h=c.uint16("x00280103"),i=0!==h,j=a.getEncodedImageFrame(c,e),k=b(j,i);if(0!==k.result&&6!==k.result)throw"JPEG-LS decoder failed to decode frame (error code "+k.result+")";if(k.width!==g)throw"JPEG-LS decoder returned width of "+k.width+", when "+g+" is expected";if(k.height!==f)throw"JPEG-LS decoder returned width of "+k.height+", when "+f+" is expected";return k.pixelData}var d;a.decodeJPEGLS=c}(cornerstoneWADOImageLoader),function(a){function b(b,c){if("undefined"==typeof jpeg||"undefined"==typeof jpeg.lossless||"undefined"==typeof jpeg.lossless.Decoder)throw"No JPEG Lossless decoder loaded";var d=b.uint16("x00280100"),e=b.uint16("x00280103"),f=a.getEncodedImageFrame(b,c),g=8>=d?1:2,h=new jpeg.lossless.Decoder,i=h.decode(f.buffer,f.byteOffset,f.length,g);return 0===e?2===g?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)}a.decodeJPEGLossless=b}(cornerstoneWADOImageLoader),function(a){function b(b,e){var f,g=b.uint16("x00280010"),h=b.uint16("x00280011"),i=b.uint16("x00280002"),j=b.elements.x7fe00010,k=dicomParser.readEncapsulatedPixelDataFromFragments(b,j,e),l=a.getPixelFormat(b),m=h*g;return 1===l?(f=new ArrayBuffer(m*i),c(k,f,m,i),new Uint8Array(f)):2===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Uint16Array(f)):3===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Int16Array(f)):void 0}function c(a,b,c,d){for(var e=new DataView(a.buffer,a.byteOffset),f=new DataView(a.buffer,a.byteOffset),g=new DataView(b),h=0,i=e.getInt32(0,!0),j=0;i>j;++j){h=j;var k=e.getInt32(4*(j+1),!0),l=e.getInt32(4*(j+2),!0);0===l&&(l=a.length);for(var m=c*i;l>k;){var n=f.getInt8(k++);if(n>=0&&127>=n)for(var o=0;n+1>o&&m>h;++o)g.setInt8(h,f.getInt8(k++)),h+=d;else if(-1>=n&&n>=-127)for(var p=f.getInt8(k++),q=0;-n+1>q&&m>h;++q)g.setInt8(h,p),h+=d}}}function d(a,b,c){for(var d=new DataView(a.buffer,a.byteOffset),e=new DataView(a.buffer,a.byteOffset),f=new DataView(b),g=d.getInt32(0,!0),h=0;g>h;++h){var i=0,j=0===h?1:0,k=d.getInt32(4*(h+1),!0),l=d.getInt32(4*(h+2),!0);for(0===l&&(l=a.length);l>k;){var m=e.getInt8(k++);if(m>=0&&127>=m)for(var n=0;m+1>n&&c>i;++n)f.setInt8(2*i+j,e.getInt8(k++)),i++;else if(-1>=m&&m>=-127)for(var o=e.getInt8(k++),p=0;-m+1>p&&c>i;++p)f.setInt8(2*i+j,o),i++}}}a.decodeRLE=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){var d=b.string("x00020010");if("1.2.840.10008.1.2"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.1"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.2"===d)return a.extractUncompressedPixels(b,c,!0);if("1.2.840.10008.1.2.1.99"===d)return a.extractUncompressedPixels(b,c,!0);if("1.2.840.10008.1.2.5"===d)return a.decodeRLE(b,c);if("1.2.840.10008.1.2.4.50"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.51"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.57"===d)return a.decodeJPEGLossless(b,c);if("1.2.840.10008.1.2.4.70"===d)return a.decodeJPEGLossless(b,c);if("1.2.840.10008.1.2.4.80"===d)return a.decodeJPEGLS(b,c);if("1.2.840.10008.1.2.4.81"===d)return a.decodeJPEGLS(b,c);if("1.2.840.10008.1.2.4.90"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.4.91"===d)return a.decodeJPEG2000(b,c);throw console&&console.log&&console.log("Image cannot be decoded due to Unsupported transfer syntax "+d),"no decoder for transfer syntax "+d}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){return(255&a)<<8|a>>8&255}function e(a,b,e){var g=c.getPixelFormat(a),h=f(a,b,g);if(e&&(2===g||3===g))for(var i=0;i<h.length;i++)h[i]=d(h[i]);return h}function f(a,b,c){var d=a.elements.x7fe00010,e=a.uint16("x00280010"),f=a.uint16("x00280011"),g=a.uint16("x00280002"),h=d.dataOffset,i=f*e*g;if(!i)throw"Sanity check failed when calculating the number of pixels";var j=0;if(1===c){if(j=h+b*i,j>=a.byteArray.length)throw"frame exceeds size of pixelData";return new Uint8Array(a.byteArray.buffer,j,i)}if(2===c){if(j=h+b*i*2,j>=a.byteArray.length)throw"frame exceeds size of pixelData";return new Uint16Array(a.byteArray.buffer,j,i)}if(3===c){if(j=h+b*i*2,j>=a.byteArray.length)throw"frame exceeds size of pixelData";return new Int16Array(a.byteArray.buffer,j,i)}throw"Unknown pixel format"}c.extractUncompressedPixels=e}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=a.intString("x00280008");return b>1}function e(a){var b=a.intString("x00280008"),c=a.elements.x7fe00010;return b!=c.fragments.length?!0:void 0}function f(a,b){var c=a.elements.x7fe00010;if(d(a)){if(e(a))throw"multi-frame sop instance with no basic offset table is not currently supported";return dicomParser.readEncapsulatedPixelDataFromFragments(a,c,b)}var f=0,g=c.fragments.length;return dicomParser.readEncapsulatedPixelDataFromFragments(a,c,f,g)}function g(a,b){return a.elements.x7fe00010.basicOffsetTable.length?dicomParser.readEncapsulatedImageFrame(a,a.elements.x7fe00010,b):f(a,b)}c.getEncodedImageFrame=g}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(b.elements.x00283002&&b.elements.x00283002&&b.elements.x00283006){var c=b.uint16("x00283002",0);0===c&&(c=65535);var d;d=0===a?b.uint16("x00283002",1):b.int16("x00283002",1);var e=b.uint16("x00283002",2);if(void 0!==c&&void 0!==d&&void 0!==e){for(var f={id:"1",firstValueMapped:d,numBitsPerEntry:e,lut:[]},g=0;c>g;g++)0===a?f.lut[g]=b.uint16("x00283006",g):f.lut[g]=b.int16("x00283006",g);return f}}}a.getLUT=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;d>f;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}a.getMinMax=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.uint16("x00280103"),c=a.uint16("x00280100");return 0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}a.getPixelFormat=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.string("x00280030");if(b&&b.length>0){var c=b.split("\\");if(parseFloat(c[0])&&parseFloat(c[1]))return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}a.getPixelSpacing=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={intercept:0,slope:1};return a.elements.x00281052&&a.elements.x00281053&&(b.intercept=a.floatString("x00281052")||b.intercept,b.slope=a.floatString("x00281053")||b.slope),b}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0};return a.elements.x00281050&&a.elements.x00281051&&(b.windowCenter=a.floatString("x00281050"),b.windowWidth=a.floatString("x00281051")),b}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";b.registerImageLoader("dicomfile",c.internal.loadImage)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"dicomfile:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.fileManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(b){var d=c.parseImageId(b),e=parseInt(d.url),f=c.fileManager.get(e),g=a.Deferred(),h=new FileReader;return h.onload=function(a){var b=a.target.result,c=new Uint8Array(b),d=dicomParser.parseDicom(c);g.resolve(d)},h.readAsArrayBuffer(f),g.promise()}c.internal.loadFileRequest=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){function b(a,b,c){if(c+a.length>b.length)return!1;for(var d=c,e=0;e<a.length;e++)if(a[e]!==b[d++])return!1;return!0}function c(a){for(var b=new Uint8Array(a.length),c=0,d=a.length;d>c;c++)b[c]=a.charCodeAt(c);return b}function d(a,d,e){e=e||0;for(var f=c(d),g=e;g<a.length;g++)if(f[0]===a[g]&&b(f,a,g))return g;return-1}a.internal.findIndexOfString=d}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=0;b<a.length;b++)if("--"===a[b].substr(0,2))return a[b];return void 0}function c(a){for(var b=0;b<a.length;b++)if("Content-Type:"===a[b].substr(0,13))return a[b].substr(13).trim();return void 0}function d(a,b,c){b=b||0,c=c||a.length-b;for(var d="",e=b;b+c>e;e++)d+=String.fromCharCode(a[e]);return d}a.internal.getImageFrame=function(e,f){f=f||"application/octet-stream";var g=$.Deferred(),h=new XMLHttpRequest;return h.responseType="arraybuffer",h.open("get",e,!0),h.setRequestHeader("Accept","multipart/related;type="+f),h.onreadystatechange=function(e){if(4===h.readyState)if(200===h.status){var f=h.response,i=new Uint8Array(h.response),j=a.internal.findIndexOfString(i,"\n\r\n");-1===j&&g.reject("invalid response - no multipart mime header");var k=d(i,0,j),l=k.split("\r\n"),m=b(l);m||g.reject("invalid response - no boundary marker");var n=j+4,o=a.internal.findIndexOfString(i,m,n);-1===o&&g.reject("invalid response - terminating boundary not found");var p=o-n-1;g.resolve({contentType:c(l),arrayBuffer:f,offset:n,length:p})}else g.reject(h.response)},h.send(),g.promise()}}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"wadors:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.imageManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d){var e=a.Deferred(),f=d.substring(7),g=c.imageManager.get(f);if(void 0===g)return e.reject("unknown imageId"),e.promise();var h;return c.internal.getImageFrame(g.uri,h).then(function(a){var f;16===g.instance.bitsAllocated?f=0===g.instance.pixelRepresentation?new Uint16Array(a.arrayBuffer,a.offset,a.length/2):new Int16Array(a.arrayBuffer,a.offset,a.length/2):8===g.instance.bitsAllocated&&(f=new Uint8Array(a.arrayBuffer,a.offset,a.length));var h=c.getMinMax(f);g.imageId=d,g.minPixelValue=h.min,g.maxPixelValue=h.max,g.render=b.renderGrayscaleImage,g.getPixelData=function(){return f},e.resolve(g)}).fail(function(a){e.reject(a)}),e.promise()}b.registerImageLoader("wadors",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";b.registerImageLoader("dicomweb",c.internal.loadImage),b.registerImageLoader("wadouri",c.internal.loadImage)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a||"YBR_ICT"===a?!0:!1}a.isColorImage=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if(c.isJPEGBaseline8Bit(a)===!0)return c.decodeJPEGBaseline8Bit(f,a,b);var d=c.decodeTransferSyntax(a,b);return c.convertColorSpace(f,a,d)}function e(e,h,i,j){var k=c.getPixelSpacing(h),l=h.uint16("x00280010"),m=h.uint16("x00280011"),n=c.getRescaleSlopeAndIntercept(h),o=h.byteArray.length,p=c.getWindowWidthAndCenter(h);g=void 0;var q,r=a.Deferred();try{q=d(h,i)}catch(s){return r.reject(s),r.promise()}return q.then(function(a){function d(){return a.data}function i(){return a}function q(){if(g===e)return f;f.height=l,f.width=m;var b=f.getContext("2d");return b.putImageData(a,0,0),g=e,f}var s={imageId:e,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:p.windowCenter,windowWidth:p.windowWidth,render:b.renderColorImage,getPixelData:d,getImageData:i,getCanvas:q,rows:l,columns:m,height:l,width:m,color:!0,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:h,invert:!1,sizeInBytes:o,sharedCacheKey:j};(void 0===s.windowCenter||isNaN(s.windowCenter)||void 0===s.windowWidth||isNaN(s.windowWidth))&&(s.windowWidth=255,s.windowCenter=128),c.internal.options.imageCreated&&c.internal.options.imageCreated(s),r.resolve(s)},function(a){r.reject(a)}),r.promise()}var f=document.createElement("canvas"),g="";c.makeColorImage=e}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=c.getPixelFormat(a);if(1===b)return 1;if(2===b||3===b)return 2;throw"unknown pixel format"}function e(a){var b=a.string("x00080016");return"1.2.840.10008.5.1.4.1.1.12.1"!==b&&"1.2.840.10008.5.1.4.1.1.12.2.1	"!==b}function f(f,g,h,i){function j(){return r}var k,l=a.Deferred(),m=c.getPixelSpacing(g),n=g.uint16("x00280010"),o=g.uint16("x00280011"),p=c.getRescaleSlopeAndIntercept(g);try{k=d(g)}catch(q){return l.reject(q),l.promise()}var r,s=g.byteArray.length,t=g.string("x00280004"),u="MONOCHROME1"===t,v=c.getWindowWidthAndCenter(g);try{r=c.decodeTransferSyntax(g,h)}catch(w){return l.reject(w),l.promise()}var x=c.getMinMax(r),y={imageId:f,minPixelValue:x.min,maxPixelValue:x.max,slope:p.slope,intercept:p.intercept,windowCenter:v.windowCenter,windowWidth:v.windowWidth,render:b.renderGrayscaleImage,getPixelData:j,rows:n,columns:o,height:n,width:o,color:!1,columnPixelSpacing:m.column,rowPixelSpacing:m.row,data:g,invert:u,sizeInBytes:s,sharedCacheKey:i},z=g.uint16("x00280103");if(g.elements.x00283000&&e(g)&&(y.modalityLUT=c.getLUT(z,g.elements.x00283000.items[0].dataSet)),g.elements.x00283010&&(z=0,y.minPixelValue*y.slope+y.intercept<0&&(z=1),y.voiLUT=getLUT(z,g.elements.x00283010.items[0].dataSet)),void 0===y.windowCenter||isNaN(y.windowCenter)||void 0===y.windowWidth||isNaN(y.windowWidth)){var A=y.maxPixelValue*y.slope+y.intercept,B=y.minPixelValue*y.slope+y.intercept;y.windowWidth=A-B,y.windowCenter=(A+B)/2}return c.internal.options.imageCreated&&c.internal.options.imageCreated(y),l.resolve(y),l.promise()}c.makeGrayscaleImage=f}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b,c=a.indexOf(":"),d=a.substring(c+1),e=d.indexOf("frame=");if(-1!==e){var f=d.substr(e+6);b=parseInt(f),d=d.substr(0,e-1)}return{scheme:a.substr(0,c),url:d,frame:b}}a.parseImageId=b}(cornerstoneWADOImageLoader),function(a){"use strict";a.version="0.13.3"}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d,e){var f=a.Deferred(),g=new XMLHttpRequest;return g.open("get",d,!0),g.responseType="arraybuffer",c.internal.options.beforeSend(g),g.onreadystatechange=function(a){if(4===g.readyState)if(200===g.status){var b=g.response,c=new Uint8Array(b),d=dicomParser.parseDicom(c);f.resolve(d)}else f.reject(g)},g.onprogress=function(c){if(c.lengthComputable){var d=c.loaded,f=c.total,g=Math.round(d/f*100);a(b).trigger("CornerstoneImageLoadProgress",{imageId:e,loaded:d,total:f,percentComplete:g})}},g.send(),f.promise()}c.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader);