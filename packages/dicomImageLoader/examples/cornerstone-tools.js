var cornerstoneTools=function(a,b,c,d){function e(a,b){var c=a.width/2,d=a.height/2;if(0>=c||0>=d)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.y/(c*c)+f.y*f.y/(d*d)<=1;return g}function f(a,b){for(var c=0,d=0,f=0,g=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)1==e(b,{x:i,y:h})&&(c+=a[g],d+=a[g]*a[g],f++),g++;if(0==f)return{count:f,mean:0,variance:0,stdDev:0};var j=c/f,k=d/f-j*j;return{count:f,mean:j,variance:k,stdDev:Math.sqrt(k)}}function g(a,b){var c={visible:!0,handles:{start:{x:b.x,y:b.y,highlight:!0,active:!1},end:{x:b.x,y:b.y,highlight:!0,active:!0}}};d.addToolState(a.currentTarget,p,c),d.handleHandle(a,c.handles.end)}function h(a,b){var c={left:Math.min(a.handles.start.x,a.handles.end.x),top:Math.min(a.handles.start.y,a.handles.end.y),width:Math.abs(a.handles.start.x-a.handles.end.x),height:Math.abs(a.handles.start.y-a.handles.end.y)};return d.lineHelper.pointNearRect(b,c)}function i(a){var c=a.data;if(a.which==c.whichMouseButton){var e=a.currentTarget,f=b.getViewport(e),i=b.pageToImage(e,a.pageX,a.pageY),j=d.getToolState(a.currentTarget,p);if(void 0!==j)for(var k=0;k<j.data.length;k++){var l=j.data[k];if(1==d.handleCursorNearHandle(a,l,i,f.scale))return void a.stopImmediatePropagation()}if(void 0!==j)for(var k=0;k<j.data.length;k++){var l=j.data[k];if(h(l,i))return d.moveAllHandles(a,l,j,!0),void a.stopImmediatePropagation()}if(c.active===!0)return g(a,i,f.scale),void a.stopImmediatePropagation()}}function j(a){if(0==a.which){var c=d.getToolState(a.currentTarget,p);if(void 0!==c){for(var e=!1,f=0;f<c.data.length;f++){var g=a.currentTarget,i=b.pageToImage(g,a.pageX,a.pageY),j=b.getViewport(g),k=c.data[f];h(k,i)===!0?(d.setHighlightForAllHandles(k,!0)&&(e=!0),d.activateNearbyHandle(k.handles,i,j.scale)&&(e=!0)):d.deactivateAndUnhighlightAllHandles(k)&&(e=!0)}e===!0&&b.updateImage(g)}}}function k(a){var e=d.getToolState(a.currentTarget,p);if(void 0!==e){var g=a.detail.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(a.detail.enabledElement,g);for(var h=0;h<e.data.length;h++){g.save();var i=e.data[h],j=Math.abs(i.handles.start.x-i.handles.end.x),k=Math.abs(i.handles.start.y-i.handles.end.y),l=Math.min(i.handles.start.x,i.handles.end.x),m=Math.min(i.handles.start.y,i.handles.end.y),n=(i.handles.start.x+i.handles.end.x)/2,o=(i.handles.start.y+i.handles.end.y)/2,g=a.detail.canvasContext;g.beginPath(),g.strokeStyle="white",g.lineWidth=1/a.detail.viewport.scale,c.drawEllipse(g,l,m,j,k),g.closePath(),g.beginPath(),d.drawHandles(g,a.detail.viewport,i.handles,a.detail.viewport.scale),g.stroke();var q=b.getStoredPixels(a.detail.element,l,m,j,k),r={left:l,top:m,width:j,height:k},s=f(q,r),t=Math.PI*(j*a.detail.image.columnPixelSpacing/2)*(k*a.detail.image.rowPixelSpacing/2),u="Area: "+t.toFixed(2)+" mm^2",v=c.setToFontCoordinateSystem(a.detail.enabledElement,a.detail.canvasContext,15);g.font=""+v.fontSize+"px Arial";var w=g.measureText(t),x=v.lineHeight,y=n<a.detail.image.columns/2?n+j/2:n-j/2-w.width*v.fontScale,z=o<a.detail.image.rows/2?o+k/2:o-k/2,y=y/v.fontScale,z=z/v.fontScale;g.fillStyle="white",g.fillText("Mean: "+s.mean.toFixed(2),y,z-x),g.fillText("StdDev: "+s.stdDev.toFixed(2),y,z),g.fillText(u,y,z+x),g.restore()}}}function l(c){c.addEventListener("CornerstoneImageRendered",k,!1),a(c).unbind("mousedown",i),a(c).unbind("mousemove",j),b.updateImage(c)}function m(c){c.removeEventListener("CornerstoneImageRendered",k),a(c).unbind("mousedown",i),a(c).unbind("mousemove",j),b.updateImage(c)}function n(c,d){c.addEventListener("CornerstoneImageRendered",k,!1),a(c).unbind("mousedown",i),a(c).unbind("mousemove",j);var e={whichMouseButton:d,active:!0};a(c).mousedown(e,i),a(c).mousemove(j),b.updateImage(c)}function o(c){c.addEventListener("CornerstoneImageRendered",k,!1),a(c).unbind("mousedown",i),a(c).unbind("mousemove",j);var d={whichMouseButton:1,active:!1};a(c).mousedown(d,i),a(c).mousemove(j),b.updateImage(c)}void 0===d&&(d={});var p="ellipticalRoi";return d.ellipticalRoi={enable:l,disable:m,activate:n,deactivate:o},d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a,b,d){var e=o/d;for(var f in a){var g=a[f],h=c.distance(b,g);if(e>=h)return g}return void 0}function f(a){for(var b in a){var c=a[b];if(c.active===!0)return c}return void 0}function g(a,b,c){var d=f(a),g=e(a,b,c);return d!=g?(void 0!==g&&(g.active=!0),void 0!=d&&(d.active=!1),!0):!1}function h(a,b,c,e){if(b.visible===!1)return!1;var f=d.findHandleNear(b.handles,c,e);return void 0==f?!1:i(a,f)}function i(c,d){var e=c.currentTarget;return a(document).mousemove(function(a){var c=b.pageToImage(e,a.pageX,a.pageY);d.x=c.x,d.y=c.y,b.updateImage(e)}),a(document).mouseup(function(){d.active=!1,a(document).unbind("mousemove"),a(document).unbind("mouseup"),b.updateImage(e)}),!0}function j(a,b){var c=!1;for(var d in a.handles){var e=a.handles[d];e.highlight!==b&&(e.highlight=b,c=!0)}return c}function k(a,b,c){a.strokeStyle="white";var d=o/b.scale;for(var e in c){var f=c[e];(f.active||f.highlight)&&(a.beginPath(),a.lineWidth=f.active?1/b.scale:.5/b.scale,a.arc(f.x,f.y,d,0,2*Math.PI),a.stroke())}}function l(a,b){return a.x<0||a.x>b.width||a.y<0||a.y>b.height?!0:!1}function m(c,d,e,f){var g=c.currentTarget,h=b.pageToImage(g,c.pageX,c.pageY);return a(document).mousemove(function(a){var c=b.pageToImage(g,a.pageX,a.pageY);for(var e in d.handles){var f=d.handles[e];f.x+=c.x-h.x,f.y+=c.y-h.y}h=c,b.updateImage(g)}),a(document).mouseup(function(){if(d.moving=!1,a(document).unbind("mousemove"),a(document).unbind("mouseup"),f===!0){var c=b.getEnabledElement(g).image,h=!1;for(var i in d.handles){var j=d.handles[i];(l(j,c)||l(d.handles.end,c))&&(h=!0)}if(h){for(var k=-1,m=0;m<e.data.length;m++)e.data[m]===d&&(console.log("found tool"),k=m);-1!==k&&(console.log("deleteing tool"),e.data.splice(k,1))}}b.updateImage(g)}),!0}function n(a){var b=!1;for(var c in a.handles){var d=a.handles[c];d.active&&(d.active=!1,b=!0),d.highlight&&(d.highlight=!1,b=!0)}return b}void 0===d&&(d={});var o=6;return d.findHandleNear=e,d.handleCursorNearHandle=h,d.drawHandles=k,d.activateNearbyHandle=g,d.handleHandle=i,d.setHighlightForAllHandles=j,d.moveAllHandles=m,d.deactivateAndUnhighlightAllHandles=n,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(){function a(a,c,e){var f=b.getEnabledElement(a);0==d.hasOwnProperty(f.ids.imageId)&&(d[f.ids.imageId]={});var g=d[f.ids.imageId];0==g.hasOwnProperty(c)&&(g[c]={data:[]});var h=g[c];h.data.push(e)}function c(a,c){var e=b.getEnabledElement(a);if(0==d.hasOwnProperty(e.ids.imageId))return void 0;var f=d[e.ids.imageId];if(0==f.hasOwnProperty(c))return void 0;var g=f[c];return g}var d={},e={get:c,add:a};return e}void 0===d&&(d={});var f=e();return d.newImageIdSpecificToolStateManager=e,d.globalImageIdSpecificToolStateManager=f,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a,b){var c={visible:!0,handles:{start:{x:b.x,y:b.y,highlight:!0,active:!1},end:{x:b.x,y:b.y,highlight:!0,active:!0}}};d.addToolState(a.currentTarget,r,c),d.handleHandle(a,c.handles.end)}function f(a){var c=a.data;if(a.which==c.whichMouseButton){var f=a.currentTarget,g=b.getViewport(f),h=b.pageToImage(f,a.pageX,a.pageY),i=d.getToolState(a.currentTarget,r);if(void 0!==i)for(var j=0;j<i.data.length;j++){var l=i.data[j];if(1==d.handleCursorNearHandle(a,l,h,g.scale))return void a.stopImmediatePropagation()}if(void 0!==i)for(var j=0;j<i.data.length;j++){var l=i.data[j];if(k(l,h))return d.moveAllHandles(a,l,i,!0),void a.stopImmediatePropagation()}if(c.active===!0)return e(a,h,g.scale),void a.stopImmediatePropagation()}}function g(a){return a*a}function h(a,b){return g(a.x-b.x)+g(a.y-b.y)}function i(a,b,c){var d=h(b,c);if(0==d)return h(a,b);var e=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/d;return 0>e?h(a,b):e>1?h(a,c):h(a,{x:b.x+e*(c.x-b.x),y:b.y+e*(c.y-b.y)})}function j(a,b,c){return Math.sqrt(i(a,b,c))}function k(a,b){var c=j(b,a.handles.start,a.handles.end);return 5>c}function l(a){if(0==a.which){var c=d.getToolState(a.currentTarget,r);if(void 0!==c){for(var e=!1,f=0;f<c.data.length;f++){var g=a.currentTarget,h=b.pageToImage(g,a.pageX,a.pageY),i=b.getViewport(g),j=c.data[f];d.lineHelper.pointNearLineSegment(h,j.handles)===!0?(d.setHighlightForAllHandles(j,!0)&&(e=!0),d.activateNearbyHandle(j.handles,h,i.scale)&&(e=!0)):d.deactivateAndUnhighlightAllHandles(j)&&(e=!0)}e===!0&&b.updateImage(g)}}}function m(a){var b=d.getToolState(a.currentTarget,r);if(void 0!==b){var e=a.detail.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(a.detail.enabledElement,e);for(var f=0;f<b.data.length;f++){e.save();var g=b.data[f];e.beginPath(),e.strokeStyle="white",e.lineWidth=1/a.detail.viewport.scale,e.moveTo(g.handles.start.x,g.handles.start.y),e.lineTo(g.handles.end.x,g.handles.end.y),e.stroke(),e.beginPath(),d.drawHandles(e,a.detail.viewport,g.handles,a.detail.viewport.scale),e.stroke(),e.fillStyle="white";var h=g.handles.start.x-g.handles.end.x*a.detail.image.columnPixelSpacing,i=g.handles.start.y-g.handles.end.y*a.detail.image.rowPixelSpacing,j=Math.sqrt(h*h+i*i),k=""+j.toFixed(2)+" mm",l=c.setToFontCoordinateSystem(a.detail.enabledElement,a.detail.canvasContext,15);e.font=""+l.fontSize+"px Arial";var m=(g.handles.start.x+g.handles.end.x)/2/l.fontScale,n=(g.handles.start.y+g.handles.end.y)/2/l.fontScale;e.fillText(k,m,n),e.restore()}}}function n(c){c.addEventListener("CornerstoneImageRendered",m,!1),a(c).unbind("mousedown",f),a(c).unbind("mousemove",l),b.updateImage(c)}function o(c){c.removeEventListener("CornerstoneImageRendered",m),a(c).unbind("mousedown",f),a(c).unbind("mousemove",l),b.updateImage(c)}function p(c,d){c.addEventListener("CornerstoneImageRendered",m,!1),a(c).unbind("mousedown",f),a(c).unbind("mousemove",l);var e={whichMouseButton:d,active:!0};a(c).mousedown(e,f),a(c).mousemove(l),b.updateImage(c)}function q(c){c.addEventListener("CornerstoneImageRendered",m,!1),a(c).unbind("mousedown",f),a(c).unbind("mousemove",l);var d={whichMouseButton:1,active:!1};a(c).mousedown(d,f),a(c).mousemove(l),b.updateImage(c)}void 0===d&&(d={});var r="length";return d.length={enable:n,disable:o,activate:p,deactivate:q},d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a){return a*a}function f(a,b){return e(a.x-b.x)+e(a.y-b.y)}function g(a,b,c){var d=f(b,c);if(0==d)return f(a,b);var e=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/d;return 0>e?f(a,b):e>1?f(a,c):f(a,{x:b.x+e*(c.x-b.x),y:b.y+e*(c.y-b.y)})}function h(a,b,c){return Math.sqrt(g(a,b,c))}function i(a,b,c){void 0===c&&(c=5);var d=h(a,b.start,b.end);return c>d}function j(a){var b={start:{x:a.left,y:a.top},end:{x:a.left+a.width,y:a.top}},c={start:{x:a.left+a.width,y:a.top},end:{x:a.left+a.width,y:a.top+a.height}},d={start:{x:a.left+a.width,y:a.top+a.height},end:{x:a.left,y:a.top+a.height}},e={start:{x:a.left,y:a.top+a.height},end:{x:a.left,y:a.top}},f=[b,c,d,e];return f}function k(a,b,c){var d=!1,e=j(b);return e.forEach(function(b){i(a,b,c)&&(d=!0)}),d}return void 0===d&&(d={}),d.lineHelper={pointNearLineSegment:i,pointNearRect:k},d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c){var d=c.data,e=c.currentTarget;if(c.which==d.whichMouseButton){var f=c.pageX,g=c.pageY;a(document).mousemove(function(a){var c=a.pageX-f,d=a.pageY-g;f=a.pageX,g=a.pageY;var h=b.getViewport(e);h.centerX+=c/h.scale,h.centerY+=d/h.scale,b.setViewport(e,h)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")})}}function e(b){a(b).unbind("mousedown",d)}function f(b){a(b).unbind("mousedown",d)}function g(b,c){a(b).unbind("mousedown",d);var e={whichMouseButton:c,active:!0};a(b).mousedown(e,d)}function h(b){a(b).unbind("mousedown",d);var c={whichMouseButton:1,active:!1};a(b).mousedown(c,d)}return void 0===c&&(c={}),c.pan={enable:e,disable:f,activate:g,deactivate:h},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a,b){var c={visible:!0,handles:{end:{x:b.x,y:b.y,highlight:!0,active:!0}}};d.addToolState(a.currentTarget,m,c),d.handleHandle(a,c.handles.end)}function f(a){var c=a.data;if(a.which==c.whichMouseButton){var f=a.currentTarget,g=b.getViewport(f),h=b.pageToImage(f,a.pageX,a.pageY),i=d.getToolState(a.currentTarget,m);if(void 0!==i)for(var j=0;j<i.data.length;j++){var k=i.data[j];if(d.handleCursorNearHandle(k.handles,h,g.scale))return void a.stopImmediatePropagation()}if(c.active===!0)return e(a,h,g.scale),void a.stopImmediatePropagation()}}function g(a){if(0==a.which){var c=d.getToolState(a.currentTarget,m);if(void 0!==c){for(var e=!1,f=0;f<c.data.length;f++){var g=a.currentTarget,h=b.pageToImage(g,a.pageX,a.pageY),i=b.getViewport(g),j=c.data[f];1==d.activateNearbyHandle(j.handles,h,i.scale)&&(e=!0)}e===!0&&b.updateImage(g)}}}function h(a){var e=d.getToolState(a.currentTarget,m);if(void 0!==e){var f=a.detail.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(a.detail.enabledElement,f);for(var g=0;g<e.data.length;g++){f.save();var h=e.data[g];f.beginPath(),d.drawHandles(f,a.detail.viewport,h.handles,a.detail.viewport.scale),f.stroke();var i=c.setToFontCoordinateSystem(a.detail.enabledElement,a.detail.canvasContext,15);f.font=""+i.fontSize+"px Arial";var j=Math.round(h.handles.end.x),k=Math.round(h.handles.end.y);l=h.handles.end.x+3,n=h.handles.end.y-3;var l=l/i.fontScale,n=n/i.fontScale;f.fillStyle="white";var o=b.getStoredPixels(a.detail.element,j,k,1,1),p=o[0],q=p*a.detail.image.slope+a.detail.image.intercept;f.fillText(""+j+","+k,l,n),f.fillText("SP: "+p+" MO: "+q,l,n+i.lineHeight),f.restore()}}}function i(c){c.addEventListener("CornerstoneImageRendered",h,!1),b.updateImage(c),a(c).unbind("mousedown",f),a(c).unbind("mousemove",g)}function j(c){l(c),a(c).unbind("mousemove",g),c.removeEventListener("CornerstoneImageRendered",h),b.updateImage(c)}function k(b,c){b.addEventListener("CornerstoneImageRendered",h,!1);var d={whichMouseButton:c,active:!0};a(b).unbind("mousedown",f),a(b).mousedown(d,f),a(b).mousemove(g)}function l(b){var c={whichMouseButton:1,active:!1};b.addEventListener("CornerstoneImageRendered",h,!1),a(b).unbind("mousedown",f),a(b).mousedown(c,f),a(b).mousemove(g)}void 0===d&&(d={});var m="probe";return d.probe={enable:i,disable:j,activate:k,deactivate:l},d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a){if(0==a.length)return{count:0,mean:0,variance:0,stdDev:0};for(var b=0,c=0,d=0;d<a.length;d++)b+=a[d],c+=a[d]*a[d];var e=b/a.length,f=c/a.length-e*e;return{count:a.length,mean:e,variance:f,stdDev:Math.sqrt(f)}}function f(a,b){var c={visible:!0,handles:{start:{x:b.x,y:b.y,highlight:!0,active:!1},end:{x:b.x,y:b.y,highlight:!0,active:!0}}};d.addToolState(a.currentTarget,o,c),d.handleHandle(a,c.handles.end)}function g(a,b){var c={left:Math.min(a.handles.start.x,a.handles.end.x),top:Math.min(a.handles.start.y,a.handles.end.y),width:Math.abs(a.handles.start.x-a.handles.end.x),height:Math.abs(a.handles.start.y-a.handles.end.y)};return d.lineHelper.pointNearRect(b,c)}function h(a){var c=a.data;if(a.which==c.whichMouseButton){var e=a.currentTarget,h=b.getViewport(e),i=b.pageToImage(e,a.pageX,a.pageY),j=d.getToolState(a.currentTarget,o);if(void 0!==j)for(var k=0;k<j.data.length;k++){var l=j.data[k];if(1==d.handleCursorNearHandle(a,l,i,h.scale))return void a.stopImmediatePropagation()}if(void 0!==j)for(var k=0;k<j.data.length;k++){var l=j.data[k];if(g(l,i))return d.moveAllHandles(a,l,j,!0),void a.stopImmediatePropagation()}if(c.active===!0)return f(a,i,h.scale),void a.stopImmediatePropagation()}}function i(a){if(0==a.which){var c=d.getToolState(a.currentTarget,o);if(void 0!==c){for(var e=!1,f=0;f<c.data.length;f++){var h=a.currentTarget,i=b.pageToImage(h,a.pageX,a.pageY),j=b.getViewport(h),k=c.data[f];g(k,i)===!0?(d.setHighlightForAllHandles(k,!0)&&(e=!0),d.activateNearbyHandle(k.handles,i,j.scale)&&(e=!0)):d.deactivateAndUnhighlightAllHandles(k)&&(e=!0)}e===!0&&b.updateImage(h)}}}function j(a){var f=d.getToolState(a.currentTarget,o);if(void 0!==f){var g=a.detail.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(a.detail.enabledElement,g);for(var h=0;h<f.data.length;h++){g.save();var i=f.data[h],j=Math.abs(i.handles.start.x-i.handles.end.x),k=Math.abs(i.handles.start.y-i.handles.end.y),l=Math.min(i.handles.start.x,i.handles.end.x),m=Math.min(i.handles.start.y,i.handles.end.y),n=(i.handles.start.x+i.handles.end.x)/2,p=(i.handles.start.y+i.handles.end.y)/2,g=a.detail.canvasContext;g.beginPath(),g.strokeStyle="white",g.lineWidth=1/a.detail.viewport.scale,g.rect(l,m,j,k),g.stroke(),g.beginPath(),d.drawHandles(g,a.detail.viewport,i.handles,a.detail.viewport.scale),g.stroke();var q=b.getStoredPixels(a.detail.element,l,m,j,k),r=e(q),s=Math.PI*(j*a.detail.image.columnPixelSpacing/2)*(k*a.detail.image.rowPixelSpacing/2),t="Area: "+s.toFixed(2)+" mm^2",u=c.setToFontCoordinateSystem(a.detail.enabledElement,a.detail.canvasContext,15);g.font=""+u.fontSize+"px Arial";var v=g.measureText(s),w=u.lineHeight,x=n<a.detail.image.columns/2?n+j/2:n-j/2-v.width*u.fontScale,y=p<a.detail.image.rows/2?p+k/2:p-k/2,x=x/u.fontScale,y=y/u.fontScale;g.fillStyle="white",g.fillText("Mean: "+r.mean.toFixed(2),x,y-w),g.fillText("StdDev: "+r.stdDev.toFixed(2),x,y),g.fillText(t,x,y+w),g.restore()}}}function k(c){c.addEventListener("CornerstoneImageRendered",j,!1),a(c).unbind("mousedown",h),a(c).unbind("mousemove",i),b.updateImage(c)}function l(c){c.removeEventListener("CornerstoneImageRendered",j),a(c).unbind("mousedown",h),a(c).unbind("mousemove",i),b.updateImage(c)}function m(c,d){c.addEventListener("CornerstoneImageRendered",j,!1),a(c).unbind("mousedown",h),a(c).unbind("mousemove",i);var e={whichMouseButton:d,active:!0};a(c).mousedown(e,h),a(c).mousemove(i),b.updateImage(c)}function n(c){c.addEventListener("CornerstoneImageRendered",j,!1),a(c).unbind("mousedown",h),a(c).unbind("mousemove",i);var d={whichMouseButton:1,active:!1};a(c).mousedown(d,h),a(c).mousemove(i),b.updateImage(c)}void 0===d&&(d={});var o="rectangleRoi";return d.rectangleRoi={enable:k,disable:l,activate:m,deactivate:n},d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(d,e,f){var g=0,h=0,i=[],j=c.getElementToolStateManager(d);void 0===j&&(j=c.globalImageIdSpecificToolStateManager);var k=[];e.forEach(function(){var a=c.newStackSpecificToolStateManager(k,j);i.push(a)}),c.setElementToolStateManager(d,i[0]),0==f&&a(d).on("mousewheel DOMMouseScroll",function(a){var f=e[h];return a.originalEvent.wheelDelta<0||a.originalEvent.detail>0?g<f.imageIds.length-1?(g++,b.newStackImage(d,f.imageIds[g])):h<e.length-1&&(h++,f=e[h],g=0,c.setElementToolStateManager(d,i[h]),b.newStack(d,f.imageIds[g])):g>0?(g--,b.newStackImage(d,f.imageIds[g])):h>0&&(h--,f=e[h],g=f.imageIds.length-1,c.setElementToolStateManager(d,i[h]),b.newStack(d,f.imageIds[g])),!1})}return void 0===c&&(c={}),c.scroll=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(a){var c=a.data,d=c.stack,e=a.currentTarget;return a.originalEvent.wheelDelta<0||a.originalEvent.detail>0?c.currentImageIdIndex<d.imageIds.length-1&&(c.currentImageIdIndex++,b.newStackImage(e,d.imageIds[c.currentImageIdIndex])):c.currentImageIdIndex>0&&(c.currentImageIdIndex--,b.newStackImage(e,d.imageIds[c.currentImageIdIndex])),!1}function e(e,f,g){function h(){var a=f.imageIds[n++],c=b.loadImage(a);c.done(function(){n<f.imageIds.length-1&&setTimeout(h,1)})}var i=[],j={whichMouseButton:1,active:!1,stack:f,currentImageIdIndex:0},k=c.getElementToolStateManager(e);void 0===k&&(k=c.globalImageIdSpecificToolStateManager);var l=[],m=c.newStackSpecificToolStateManager(l,k);i.push(m),c.setElementToolStateManager(e,i[0]),0==g&&a(e).on("mousewheel DOMMouseScroll",j,d);var n=0;h()}function f(b){a(b).unbind("mousewheel DOMMouseScroll",d)}return void 0===c&&(c={}),c.stackScroll={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a,c){function d(d,e,g){if(!(a.indexOf(e)>=0))return c.add(d,e,g);b.getEnabledElement(d);0==f.hasOwnProperty(e)&&(f[e]={data:[]});var h=f[e];h.data.push(g)}function e(b,d){if(a.indexOf(d)>=0){0==f.hasOwnProperty(d)&&(f[d]={data:[]});var e=f[d];return e}return c.get(b,d)}var f={},g={get:e,add:d};return g}return void 0===d&&(d={}),d.newStackSpecificToolStateManager=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a){var c=b.getEnabledElement(a);return void 0===c.toolStateManager&&(c.toolStateManager=d.globalImageIdSpecificToolStateManager),c.toolStateManager}function f(a,b,c){toolStateManager=e(a),toolStateManager.add(a,b,c)}function g(a,b){return toolStateManager=e(a),toolStateManager.get(a,b)}function h(a,c){var d=b.getEnabledElement(a);d.toolStateManager=c}return void 0===d&&(d={}),d.addToolState=f,d.getToolState=g,d.setElementToolStateManager=h,d.getElementToolStateManager=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c){var d=c.data.whichMouseButton,e=c.pageX,f=c.pageY,g=c.which;if(g==d){var h=c.currentTarget;return a(document).mousemove(function(a){var c=a.pageX-e,d=a.pageY-f;e=a.pageX,f=a.pageY;var g=b.getEnabledElement(h),i=g.image.maxPixelValue-g.image.minPixelValue,j=i/1024,k=b.getViewport(h);k.windowWidth+=c*j,k.windowCenter+=d*j,b.setViewport(h,k)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")}),c.stopPropagation&&c.stopPropagation(),c.preventDefault&&c.preventDefault(),c.cancelBubble=!0,c.returnValue=!1,!1}}function e(b){a(b).unbind("mousedown",d)}function f(b){a(b).unbind("mousedown",d)}function g(b,c){a(b).unbind("mousedown",d);var e={whichMouseButton:c,active:!0};a(b).mousedown(e,d)}function h(b){a(b).unbind("mousedown",d);var c={whichMouseButton:1,active:!1};a(b).mousedown(c,d)}return void 0===c&&(c={}),c.wwwc={enable:e,disable:f,activate:g,deactivate:h},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c){var d=c.data,e=c.currentTarget;if(c.which==d.whichMouseButton){var f=c.pageX,g=c.pageY,h=b.pageToImage(e,c.pageX,c.pageY),i=c.pageX,j=c.pageY;a(document).mousemove(function(a){var c=(a.pageX-f,a.pageY-g);f=a.pageX,g=a.pageY;var d=1.7,k=b.getViewport(e),l=c/100,m=Math.log(k.scale)/Math.log(d),n=m+l,o=Math.pow(d,n);k.scale=o;var p=b.getEnabledElement(e);p.viewport.scale=o;var q=b.pageToImage(e,i,j);k.centerX-=h.x-q.x,k.centerY-=h.y-q.y,b.setViewport(e,k)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")})}}function e(b){a(b).unbind("mousedown",d)}function f(b){a(b).unbind("mousedown",d)}function g(b,c){a(b).unbind("mousedown",d);var e={whichMouseButton:c,active:!0};a(b).mousedown(e,d)}function h(b){a(b).unbind("mousedown",d);var c={whichMouseButton:1,active:!1};a(b).mousedown(c,d)}return void 0===c&&(c={}),c.zoom={enable:e,disable:f,activate:g,deactivate:h},c}($,cornerstone,cornerstoneTools);